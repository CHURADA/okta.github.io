<!doctype html>
<!--[if lt IE 7 ]> <html class="ie6 no-flexbox"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7 no-flexbox"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8 no-flexbox"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9 no-flexbox"> <![endif]-->
<!--[if IE 10 ]>    <html class="ie10 no-flexbox"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!--> <html class="modern wf-loading" lang="en"> <!--<![endif]-->
  <head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager
    }
	</script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
 	

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="Get Started with Spring Security 5.0 and OIDC | Okta Developer" />
  <meta class="swiftype" name="summary" data-type="string" content="Spring Security is a powerful and highly customizable authentication and access-control framework. It is the de-facto standard for securing Spring-based appl..." />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-43dc5927557b8154c15ef656cdd0486491b6492bc32fff1149c297de0f054cbe.css">
  
  
  <title>Get Started with Spring Security 5.0 and OIDC | Okta Developer</title>
  <meta name="description" content="Spring Security is a powerful and highly customizable authentication and access-control framework. It is the de-facto standard for securing Spring-based appl...">
  <link rel="canonical" href="https://developer.okta.com/blog/2017/12/18/spring-security-5-oidc"  data-proofer-ignore>
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#21313a">
  <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
</head>

  
    <body id="blog">
	




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first expanded">
          <a href="https://developer.okta.com/product/">Product</a>
          <ul class="menu">
            <li class="first leaf"><a href="https://developer.okta.com/product/">Overview</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authentication/">Authentication</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authorization/">Authorization</a></li>
            <li class="last leaf"><a href="https://developer.okta.com/product/user-management/">User Management</a></li>
          </ul>
        </li>
        <li class="leaf">
          <a href="https://developer.okta.com/pricing/">Pricing</a>
        </li>
        <li class="leaf">
          <a href="/blog/" class="active">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="last leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
            </g>
        </svg>
        <svg class="CloseIcon" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="ALl-Boards" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Desktop" transform="translate(-915.000000, -235.000000)" fill="#FFFFFF">
              <g id="Search-bar-Active" transform="translate(30.000000, 26.000000)">
                <polygon id="Icon/Cross" points="901 210.6 899.4 209 893 215.4 886.6 209 885 210.6 891.4 217 885 223.4 886.6 225 893 218.6 899.4 225 901 223.4 894.6 217"></polygon>
              </g>
            </g>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" rel="noopener noreferrer" href="https://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3Dhttps://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3D" class="Button--redOutline">Login</a>
        <a href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

	<div class="page-content">
		






<section class="Blog is-single">
		
	<div class="Blog-social">
		
		<a href="https://github.com/mraible" target="_blank"><i class="fa fa-github"></i></a>
		
		
		<a href="https://twitter.com/mraible" target="_blank"><i class="fa fa-twitter"></i></a>
		
		
		
		<a href="http://raibledesigns.com" target="_blank"><i class="fa fa-external-link"></i></a>
		
	</div>
	
	

<article class="BlogPost">

    <header class="BlogPost-header">

        <time class="BlogPost-date" datetime="2017-12-18">December 18, 2017</time>

        <h1 class="BlogPost-title">
            
            Get Started with Spring Security 5.0 and OIDC
            
        </h1>

        <div class="BlogPost-attribution">
            
            <img src="/assets/avatar-matt_raible-9974af6192eb1753b7137c8fff0a2c6e6bb9736a2517986cb5cc50bb040e83d4.jpg" alt="avatar-matt_raible.jpg" class="BlogPost-avatar">
            
            <span class="BlogPost-author">Matt Raible</span>
        </div>

    </header>

    <div class="BlogPost-content">
        
	<p>Spring Security is a powerful and highly customizable authentication and access-control framework. It is the de-facto standard for securing Spring-based applications.</p>

<p>I first encountered Spring Security when it was called Acegi Security in 2005. I had implemented standard Java EE in my open source project, AppFuse. Acegi Security offered a lot more, including remember me and password encryption as standard features. I had managed to get “remember me” working with Java EE, but it wasn’t very clean. I first wrote about <a href="https://raibledesigns.com/rd/entry/using_acegi_security_with_appfuse">migrating to Acegi Security</a> in January 2005.</p>

<p>I have to admit; it seemed awful at first. Even though it provided more functionality than Java EE authentication, it required reams of XML to configure everything.</p>

<p>In 2012, I was still using XML when I <a href="http://raibledesigns.com/rd/entry/upgrading_appfuse_to_spring_security">upgraded to Spring Security 3.1</a>. Then Spring Boot came along in 2014 and changed everything.</p>

<p>These days, Spring Security offers <em>much</em> simpler configuration via Spring’s JavaConfig. If you look at the <a href="https://github.com/mraible/jhipster-oidc-example/blob/master/src/main/java/com/okta/developer/config/SecurityConfiguration.java"><code class="highlighter-rouge">SecurityConfiguration.java</code></a> class from the <a href="https://github.com/mraible/jhipster-oidc-example">JHipster OIDC example</a> I <a href="/blog/2017/10/20/oidc-with-jhipster">wrote about</a> recently, you’ll see it’s less than 100 lines of code!</p>

<p><a href="https://spring.io/blog/2017/11/28/spring-security-5-0-0-release-released">Spring Security 5.0</a> resolves 400+ tickets, and has a <a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RELEASE/reference/htmlsingle/#new">plethora of new features</a>:</p>

<ul>
  <li><a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RELEASE/reference/htmlsingle/#jc-oauth2login">OAuth 2.0 Login</a></li>
  <li>Reactive Support: <a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RELEASE/reference/htmlsingle/#jc-webflux">@EnableWebFluxSecurity</a>, <a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RELEASE/reference/htmlsingle/#jc-erms">@EnableReactiveMethodSecurity</a>, and <a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RELEASE/reference/htmlsingle/#test-webflux">WebFlux Testing Support</a></li>
  <li>Modernized <a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RELEASE/reference/htmlsingle/#core-services-password-encoding">Password Encoding</a></li>
</ul>

<p>Today, I’ll be showing you how to utilize the OAuth 2.0 Login support with Okta. I’ll also show you to retrieve a user’s information via OpenID Connect (OIDC).</p>

<p>You know that Okta offers <a href="https://developer.okta.com/pricing/">free developer accounts</a> with up to 7,000 active monthly users, right? That should be enough to get your killer app off the ground.</p>

<p>Spring Security makes authentication with OAuth 2.0 pretty darn easy. It also provides the ability to fetch a user’s information via OIDC. Follow the steps below to learn more!</p>

<blockquote>
  <p><strong>What is OIDC?</strong>
If you’re not familiar with OAuth or OIDC, I recommend you read <a href="/blog/2017/06/21/what-the-heck-is-oauth">What the Heck is OAuth</a>. An Open ID Connect flow involves the following steps:</p>

  <ol>
    <li>Discover OIDC metadata</li>
    <li>Perform OAuth flow to obtain ID token and access tokens</li>
    <li>Get JWT signature keys and optionally dynamically register the Client application</li>
    <li>Validate JWT ID token locally based on built-in dates and signature</li>
    <li>Get additional user attributes as needed with access token</li>
  </ol>

  <p><img src="/assets/blog/oauth/oidc-flow-3f640eb4b5d82151643a1d7bc2d55cfab1c1c6e14b6c2ad501660216c6d227c8.png" alt="OIDC Flow" width="800" class="center-image" /></p>
</blockquote>

<h2 id="create-a-spring-boot-app">Create a Spring Boot App</h2>

<p>Open <a href="https://start.spring.io">start.spring.io</a> in your browser. Spring Initialzr is a site that allows you to create new Spring Boot applications quickly and easily. Set the Spring Boot version (in the top right corner) to <code class="highlighter-rouge">2.0.0.M7</code>. Type in a group and artifact name. As you can see from the screenshot below, I chose <code class="highlighter-rouge">com.okta.developer</code> and <code class="highlighter-rouge">oidc</code>. For dependencies, select <strong>Web</strong>, <strong>Reactive Web</strong>, <strong>Security</strong>, and <strong>Thymeleaf</strong>.</p>

<p><img src="/assets/blog/spring-security-5/start.spring.io-598b672adcf0122a3a26ae6be57f671e99b71b8fd3f4908f6774f1142bd07817.png" alt="start.spring.io" width="800" class="center-image" /></p>

<p>Click <strong>Generate Project</strong>, download the zip, expand it on your hard drive, and open the project in your favorite IDE. Run the app with <code class="highlighter-rouge">./mvnw spring-boot:run</code>, and you’ll be prompted to log in.</p>

<p><img src="/assets/blog/spring-security-5/default-login-956313b1e04f3521da35e38ccd9ef315dfc6a2d6f4c1897d753f010774a09134.png" alt="Default Login" width="700" class="center-image" /></p>

<p>Spring Security 4.x prompts you with basic authentication rather than with a login form, so this is one thing that’s different with Spring Security 5.</p>

<p>The Spring Security starter creates a default user with username “user” and a password that changes every time you start the application. You can find this password in your terminal, similar to the one below.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Using default security password: 103c55b4-2760-4830-9bca-a06a87d384f9
</code></pre>
</div>

<p>In the form, enter “user” for the User and the generated password for Password. The next screen will be a 404 since your app doesn’t have a default route configured for the <code class="highlighter-rouge">/</code> path.</p>

<p><img src="/assets/blog/spring-security-5/post-login-2aaec6635302267e6dce390428f78fc2aba40387e60914c42e926b0a067d4b59.png" alt="Post Login" width="700" class="center-image" /></p>

<p>In Spring Boot 1.x, you could change the user’s password, so it’s the same every time by adding the following to <code class="highlighter-rouge">src/main/resources/application.properties</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>security.user.password=spring security is ph@!
</code></pre>
</div>

<p>However, this is a deprecated feature in Spring Boot 2.0. The good news is this change will <a href="https://github.com/spring-projects/spring-boot/issues/10963">likely be reverted before a GA release</a>.</p>

<p>In the meantime, you can copy the password that’s printed to your console and use it with <a href="https://httpie.org/">HTTPie</a>.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>http --auth user:<span class="s1">'bf91316f-f894-453a-9268-4826cdd7e151'</span> localhost:8080
HTTP/1.1 404
Cache-Control: no-cache, no-store, max-age<span class="o">=</span>0, must-revalidate
Content-Type: application/json;charset<span class="o">=</span>UTF-8
Date: Sun, 03 Dec 2017 19:11:50 GMT
Expires: 0
Pragma: no-cache
Set-Cookie: <span class="nv">JSESSIONID</span><span class="o">=</span>65283FCBDB9E6EF1C0679290AA994B0D; <span class="nv">Path</span><span class="o">=</span>/; HttpOnly
Transfer-Encoding: chunked
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; <span class="nv">mode</span><span class="o">=</span>block
</code></pre>
</div>

<p>The response will be a 404 as well.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not Found"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No message available"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">404</span><span class="p">,</span><span class="w">
   </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-12-03T19:11:50.846+0000"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>You can get rid of the 404 by creating a <code class="highlighter-rouge">MainController.java</code> in the same directory as <code class="highlighter-rouge">OidcApplication.java</code> (<code class="highlighter-rouge">src/main/java/com/okta/developer/oidc</code>). Create a <code class="highlighter-rouge">home()</code> method that maps to <code class="highlighter-rouge">/</code> and returns the user’s name.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">okta</span><span class="o">.</span><span class="na">developer</span><span class="o">.</span><span class="na">oidc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.Principal</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainController</span> <span class="o">{</span>

   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
   <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Principal</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="s">"Hello "</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Restart your server, log in with <code class="highlighter-rouge">user</code> and the generated password and you should see <code class="highlighter-rouge">Hello user</code>.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>http --auth user:<span class="s1">'d7c4138d-a1cc-4cc9-8975-97f37567594a'</span> localhost:8080
HTTP/1.1 200
Cache-Control: no-cache, no-store, max-age<span class="o">=</span>0, must-revalidate
Content-Length: 10
Content-Type: text/plain;charset<span class="o">=</span>UTF-8
Date: Sun, 03 Dec 2017 19:26:54 GMT
Expires: 0
Pragma: no-cache
Set-Cookie: <span class="nv">JSESSIONID</span><span class="o">=</span>22A5A91051B7AFBA1DC8BD30C0B53365; <span class="nv">Path</span><span class="o">=</span>/; HttpOnly
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; <span class="nv">mode</span><span class="o">=</span>block

Hello user
</code></pre>
</div>

<h2 id="add-authentication-with-okta">Add Authentication with Okta</h2>

<p>In a <a href="/blog/2017/03/21/spring-boot-oauth">previous tutorial</a>, I showed you how to use Spring Security OAuth to provide SSO to your apps. You can do the same thing in Spring Security 5, but you can also specify multiple providers now, which you couldn’t do previously. Spring Security 5 has a <a href="https://github.com/spring-projects/spring-security/tree/5.0.0.RELEASE/samples/boot/oauth2login">OAuth 2.0 Login sample</a>, and <a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RELEASE/reference/htmlsingle/#jc-oauth2login">documentation</a> on how everything works.</p>

<h3 id="create-an-openid-connect-app">Create an OpenID Connect App</h3>

<p>To integrate with Okta, you’ll need to <a href="https://developer.okta.com/">sign up for an account on developer.okta.com</a>. After confirming your email and logging in, navigate to <strong>Applications</strong> &gt; <strong>Add Application</strong>. Click <strong>Web</strong> and then click <strong>Next</strong>. Give the app a name you’ll remember, specify <code class="highlighter-rouge">http://localhost:8080</code> as a Base URI, as well as <code class="highlighter-rouge">http://localhost:8080/login/oauth2/code/okta</code> for a Login redirect URI.</p>

<p>Rename <code class="highlighter-rouge">src/main/resources/application.properties</code> to <code class="highlighter-rouge">src/main/resources/application.yml</code> and populate it with the following.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">spring</span><span class="pi">:</span>
 <span class="s">thymeleaf</span><span class="pi">:</span>
   <span class="s">cache</span><span class="pi">:</span> <span class="s">false</span>
 <span class="s">security</span><span class="pi">:</span>
   <span class="s">oauth2</span><span class="pi">:</span>
     <span class="s">client</span><span class="pi">:</span>
       <span class="s">registration</span><span class="pi">:</span>
         <span class="s">okta</span><span class="pi">:</span>
           <span class="s">client-id</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">clientId</span><span class="pi">}</span>
           <span class="s">client-secret</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">clientSecret</span><span class="pi">}</span>
       <span class="s">provider</span><span class="pi">:</span>
         <span class="s">okta</span><span class="pi">:</span>
           <span class="s">authorization-uri</span><span class="pi">:</span> <span class="s"><span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/authorize</span>
           <span class="s">token-uri</span><span class="pi">:</span> <span class="s"><span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/token</span>
           <span class="s">user-info-uri</span><span class="pi">:</span> <span class="s"><span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/userinfo</span>
           <span class="s">jwk-set-uri</span><span class="pi">:</span> <span class="s"><span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/keys</span>
</code></pre>
</div>

<p>Copy the client ID and secret from your OIDC app into your <code class="highlighter-rouge">application.yml</code> file. For <code class="highlighter-rouge"><span class="p">{</span><span class="err">yourOktaDomain</span><span class="p">}</span></code>, use the value of your domain (e.g. <code class="highlighter-rouge">dev-158606.oktapreview.com</code>). Make sure it does <em>not</em> include <code class="highlighter-rouge">-admin</code> in it.</p>

<p>You’ll need to add some dependencies to your <code class="highlighter-rouge">pom.xml</code> for Spring Security 5’s OAuth configuration to initialize correctly.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>spring-security-config<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>spring-security-oauth2-client<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>spring-security-oauth2-jose<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>org.thymeleaf.extras<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>thymeleaf-extras-springsecurity4<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>

<p>Restart your app and navigate to <code class="highlighter-rouge">http://localhost:8080</code> again. You’ll see a link to click on to log in with Okta.</p>

<p><img src="/assets/blog/spring-security-5/login-with-oauth2-a1979692286f6ba2c6ddb77626ea553708f9386a991253bb5b44a7b935f10795.png" alt="Login with OAuth 2.0" width="700" class="center-image" /></p>

<p><strong>NOTE:</strong> If you’d like to learn how to customize the login screen that Spring Security displays, see its <a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RELEASE/reference/htmlsingle/#oauth2login-advanced-login-page">OAuth 2.0 Login Page documentation</a>.</p>

<p>After clicking on the link, you should see a login screen.</p>

<p><img src="/assets/blog/spring-security-5/okta-login-65d1e70e7ddd8a03bf2ba7209551d65aed344469759bd98a30e7210c2d67e348.png" alt="Okta Login" width="800" class="center-image" /></p>

<p>Enter the credentials you used to create your account, and you should see a screen like the following after logging in.</p>

<p><img src="/assets/blog/spring-security-5/post-login-oauth2-f3e37f6f8f9af684430202e1c8832a52b4c2f6aa6b42098a0bd9d73f24934b5b.png" alt="Okta Login" width="700" class="center-image" /></p>

<p><strong>NOTE:</strong> It’s possible to change things so <code class="highlighter-rouge">Principal#getName()</code> returns a different value. However, there is a <a href="https://github.com/spring-projects/spring-boot/pull/10672">bug in Spring Boot 2.0.0.M7</a> that prevents the configuration property from working.</p>

<h3 id="get-user-information-with-oidc">Get User Information with OIDC</h3>

<p>Change your <code class="highlighter-rouge">MainController.java</code> to have the code below. This code adds a <code class="highlighter-rouge">/userinfo</code> mapping that uses Spring WebFlux’s <code class="highlighter-rouge">WebClient</code> to get the user’s information from the user info endpoint. I copied the code below from Spring Security 5’s <a href="https://github.com/spring-projects/spring-security/tree/5.0.0.RELEASE/samples/boot/oauth2login">OAuth 2.0 Login sample</a>.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
* Copyright 2002-2017 the original author or authors.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*      http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">okta</span><span class="o">.</span><span class="na">developer</span><span class="o">.</span><span class="na">oidc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpHeaders</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.client.OAuth2AuthorizedClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.client.OAuth2AuthorizedClientService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.client.authentication.OAuth2AuthenticationToken</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.StringUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.reactive.function.client.ClientRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.reactive.function.client.ExchangeFilterFunction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.reactive.function.client.WebClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">reactor.core.publisher.Mono</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="cm">/**
* @author Joe Grandja
*/</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainController</span> <span class="o">{</span>

   <span class="kd">private</span> <span class="kd">final</span> <span class="n">OAuth2AuthorizedClientService</span> <span class="n">authorizedClientService</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">MainController</span><span class="o">(</span><span class="n">OAuth2AuthorizedClientService</span> <span class="n">authorizedClientService</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">authorizedClientService</span> <span class="o">=</span> <span class="n">authorizedClientService</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="nf">index</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">OAuth2AuthenticationToken</span> <span class="n">authentication</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">OAuth2AuthorizedClient</span> <span class="n">authorizedClient</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getAuthorizedClient</span><span class="o">(</span><span class="n">authentication</span><span class="o">);</span>
       <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"userName"</span><span class="o">,</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
       <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"clientName"</span><span class="o">,</span> <span class="n">authorizedClient</span><span class="o">.</span><span class="na">getClientRegistration</span><span class="o">().</span><span class="na">getClientName</span><span class="o">());</span>
       <span class="k">return</span> <span class="s">"index"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/userinfo"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="nf">userinfo</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">OAuth2AuthenticationToken</span> <span class="n">authentication</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">OAuth2AuthorizedClient</span> <span class="n">authorizedClient</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getAuthorizedClient</span><span class="o">(</span><span class="n">authentication</span><span class="o">);</span>
       <span class="n">Map</span> <span class="n">userAttributes</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyMap</span><span class="o">();</span>
       <span class="n">String</span> <span class="n">userInfoEndpointUri</span> <span class="o">=</span> <span class="n">authorizedClient</span><span class="o">.</span><span class="na">getClientRegistration</span><span class="o">()</span>
               <span class="o">.</span><span class="na">getProviderDetails</span><span class="o">().</span><span class="na">getUserInfoEndpoint</span><span class="o">().</span><span class="na">getUri</span><span class="o">();</span>
       <span class="k">if</span> <span class="o">(!</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">userInfoEndpointUri</span><span class="o">))</span> <span class="o">{</span>    <span class="c1">// userInfoEndpointUri is optional for OIDC Clients</span>
           <span class="n">userAttributes</span> <span class="o">=</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                   <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">oauth2Credentials</span><span class="o">(</span><span class="n">authorizedClient</span><span class="o">)).</span><span class="na">build</span><span class="o">()</span>
                   <span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">uri</span><span class="o">(</span><span class="n">userInfoEndpointUri</span><span class="o">)</span>
                   <span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
                   <span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">block</span><span class="o">();</span>
       <span class="o">}</span>
       <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"userAttributes"</span><span class="o">,</span> <span class="n">userAttributes</span><span class="o">);</span>
       <span class="k">return</span> <span class="s">"userinfo"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">private</span> <span class="n">OAuth2AuthorizedClient</span> <span class="nf">getAuthorizedClient</span><span class="o">(</span><span class="n">OAuth2AuthenticationToken</span> <span class="n">authentication</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">authorizedClientService</span><span class="o">.</span><span class="na">loadAuthorizedClient</span><span class="o">(</span>
               <span class="n">authentication</span><span class="o">.</span><span class="na">getAuthorizedClientRegistrationId</span><span class="o">(),</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
   <span class="o">}</span>

   <span class="kd">private</span> <span class="n">ExchangeFilterFunction</span> <span class="nf">oauth2Credentials</span><span class="o">(</span><span class="n">OAuth2AuthorizedClient</span> <span class="n">authorizedClient</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">ExchangeFilterFunction</span><span class="o">.</span><span class="na">ofRequestProcessor</span><span class="o">(</span>
               <span class="n">clientRequest</span> <span class="o">-&gt;</span> <span class="o">{</span>
                   <span class="n">ClientRequest</span> <span class="n">authorizedRequest</span> <span class="o">=</span> <span class="n">ClientRequest</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">clientRequest</span><span class="o">)</span>
                           <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="n">HttpHeaders</span><span class="o">.</span><span class="na">AUTHORIZATION</span><span class="o">,</span>
                                   <span class="s">"Bearer "</span> <span class="o">+</span> <span class="n">authorizedClient</span><span class="o">.</span><span class="na">getAccessToken</span><span class="o">().</span><span class="na">getTokenValue</span><span class="o">())</span>
                           <span class="o">.</span><span class="na">build</span><span class="o">();</span>
                   <span class="k">return</span> <span class="n">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="n">authorizedRequest</span><span class="o">);</span>
               <span class="o">});</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Create a Thymeleaf index page at <code class="highlighter-rouge">src/main/resources/templates/index.html</code>. You can use Thymeleaf’s support for Spring Security to show/hide different parts of the page based on the user’s authenticated status.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span>
     <span class="na">xmlns:sec=</span><span class="s">"http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
   <span class="nt">&lt;title&gt;</span>Spring Security - OAuth 2.0 Login<span class="nt">&lt;/title&gt;</span>
   <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"float: right"</span> <span class="na">th:fragment=</span><span class="s">"logout"</span> <span class="na">sec:authorize=</span><span class="s">"isAuthenticated()"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"float:left"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"font-weight:bold"</span><span class="nt">&gt;</span>User: <span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">sec:authentication=</span><span class="s">"name"</span><span class="nt">&gt;&lt;/span&gt;</span>
   <span class="nt">&lt;/div&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"float:none"</span><span class="nt">&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/div&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"float:right"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"#"</span> <span class="na">th:action=</span><span class="s">"@{/logout}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Logout"</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;/form&gt;</span>
   <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;h1&gt;</span>OAuth 2.0 Login with Spring Security<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div&gt;</span>
   You are successfully logged in <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"font-weight:bold"</span> <span class="na">th:text=</span><span class="s">"${userName}"</span><span class="nt">&gt;&lt;/span&gt;</span>
   via the OAuth 2.0 Client <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"font-weight:bold"</span> <span class="na">th:text=</span><span class="s">"${clientName}"</span><span class="nt">&gt;&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div&gt;</span>
   <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/userinfo"</span> <span class="na">th:href=</span><span class="s">"@{/userinfo}"</span><span class="nt">&gt;</span>Display User Info<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p>Create another template at <code class="highlighter-rouge">src/main/resources/userinfo.html</code> to display the user’s attributes.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
   <span class="nt">&lt;title&gt;</span>Spring Security - OAuth 2.0 User Info<span class="nt">&lt;/title&gt;</span>
   <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">th:replace=</span><span class="s">"index::logout"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;h1&gt;</span>OAuth 2.0 User Info<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div&gt;</span>
   <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"font-weight:bold"</span><span class="nt">&gt;</span>User Attributes:<span class="nt">&lt;/span&gt;</span>
   <span class="nt">&lt;ul&gt;</span>
       <span class="nt">&lt;li</span> <span class="na">th:each=</span><span class="s">"userAttribute : ${userAttributes}"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"font-weight:bold"</span> <span class="na">th:text=</span><span class="s">"${userAttribute.key}"</span><span class="nt">&gt;&lt;/span&gt;</span>: <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"${userAttribute.value}"</span><span class="nt">&gt;&lt;/span&gt;</span>
       <span class="nt">&lt;/li&gt;</span>
   <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p>Now, when you’re logged in, you’ll see a link to display user info.</p>

<p><img src="/assets/blog/spring-security-5/index-page-9bd00c3e9b61fac8f2e812c5f9896bf086d3a4db2860a9986ef2b647f692405d.png" alt="Index Page" width="800" class="center-image" /></p>

<p>Click on the link, and you’ll see the contents of the ID Token that’s retrieved from the user info endpoint.</p>

<p><img src="/assets/blog/spring-security-5/userinfo-page-947535130b67ae4ef16e647df24155b19c3828e1c57203d1dd33f6d5bb3689c4.png" alt="UserInfo Page" width="800" class="center-image" /></p>

<h2 id="learn-more-about-spring-security-and-oidc">Learn More about Spring Security and OIDC</h2>

<p>This article showed you how to implement login with OAuth 2.0 and Spring Security 5. I also showed you how to use OIDC to retrieve a user’s information. The source code for the application developed in this article can be <a href="https://github.com/oktadeveloper/okta-spring-security-5-example">found on GitHub</a>.</p>

<p>These resources provide additional information about Okta and OIDC:</p>

<ul>
  <li><a href="/documentation/">Okta Developer Documentation</a> and its <a href="/docs/api/resources/oidc.html">OpenID Connect API</a></li>
  <li><a href="/blog/2017/07/25/oidc-primer-part-1">Identity, Claims, &amp; Tokens – An OpenID Connect Primer, Part 1 of 3</a></li>
  <li><a href="/blog/2017/07/25/oidc-primer-part-2">OIDC in Action – An OpenID Connect Primer, Part 2 of 3</a></li>
  <li><a href="/blog/2017/08/01/oidc-primer-part-3">What’s in a Token? – An OpenID Connect Primer, Part 3 of 3</a></li>
  <li><a href="/blog/2017/10/13/okta-groups-spring-security">Add Role-Based Access Control to Your App with Spring Security and Thymeleaf</a></li>
</ul>

<p>If you have any questions about this post, please leave a comment below. You can also post to <a href="https://stackoverflow.com/questions/tagged/okta">Stack Overflow with the okta tag</a> or use our <a href="https://devforum.okta.com/">developer forums</a>.</p>

<p><a href="https://twitter.com/oktadev">Follow @OktaDev on Twitter</a> for more awesome content!</p>


    </div>

    
    <div id="disqus">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_title = 'Get Started with Spring Security 5.0 and OIDC';
            var disqus_url = 'https://developer.okta.com/blog/2017/12/18/spring-security-5-oidc';

            (function () {
                var dsq = document.createElement('script');
                dsq.async = true;
                dsq.type = 'text/javascript';
                dsq.src = '//oktadevblog.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>
              Please enable JavaScript to view the
              <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus</a>.
         </noscript>
    </div>
    
</article>

		
</section>

		
	</div><footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">

                <a class="Logo" href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">
                    <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    Visit okta.com
                </a>

            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">

                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate-with-okta/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/change-log/">Change Log</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notices</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="https://developer.okta.com/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="https://developer.okta.com/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="https://developer.okta.com/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-36874fb206f812b2e337a93ccfa9c4872940f73b7c070bba28ed2ed9dfccc380.js"></script>
    <script type="text/javascript" src="/assets/myOkta-911cbafbbe079b7a5522d9cbe15bd2a5f44e1582531e88393934bec69f97696b.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/blog-6e32dad27404131cc8630a5282264bed2ab4c08c91ac86fa496b75c53aa4f681.js"></script>
    

  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
