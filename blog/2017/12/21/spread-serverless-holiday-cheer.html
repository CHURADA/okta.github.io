<!doctype html>
<!--[if lt IE 7 ]> <html class="ie6 no-flexbox"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7 no-flexbox"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8 no-flexbox"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9 no-flexbox"> <![endif]-->
<!--[if IE 10 ]>    <html class="ie10 no-flexbox"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!--> <html class="modern wf-loading" lang="en"> <!--<![endif]-->
  <head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager
    }
  </script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="Spread Serverless Holiday Cheer with Lambda and API Gateway | Okta Developer">
  <meta class="swiftype" name="summary" data-type="string" content="It’s that time of year again: Christmas music o..." />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-943074870de1efc80ec41db55bc8633148bcc085ddebad595e019ddc461dca51.css">
  
  
  <title>Spread Serverless Holiday Cheer with Lambda and API Gateway | Okta Developer</title>
  <meta name="description" content="It’s that time of year again: Christmas music o...">
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#21313a">
  <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
</head>

  
    <body id="blog">
	




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first expanded">
          <a href="https://developer.okta.com/product/">Product</a>
          <ul class="menu">
            <li class="first leaf"><a href="https://developer.okta.com/product/">Overview</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authentication/">Authentication</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authorization/">Authorization</a></li>
            <li class="last leaf"><a href="https://developer.okta.com/product/user-management/">User Management</a></li>
          </ul>
        </li>
        <li class="leaf">
          <a href="https://developer.okta.com/pricing/">Pricing</a>
        </li>
        <li class="leaf">
          <a href="/blog/" class="active">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="last leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
            </g>
        </svg>
        <svg class="CloseIcon" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="ALl-Boards" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Desktop" transform="translate(-915.000000, -235.000000)" fill="#FFFFFF">
              <g id="Search-bar-Active" transform="translate(30.000000, 26.000000)">
                <polygon id="Icon/Cross" points="901 210.6 899.4 209 893 215.4 886.6 209 885 210.6 891.4 217 885 223.4 886.6 225 893 218.6 899.4 225 901 223.4 894.6 217"></polygon>
              </g>
            </g>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" rel="noopener noreferrer" href="https://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3Dhttps://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3D" class="Button--redOutline">Login</a>
        <a href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

	<div class="page-content">
		






<section class="Blog is-single">
		
	<div class="Blog-social">
		
		<a href="https://github.com/nbarbettini" target="_blank"><i class="fa fa-github"></i></a>
		
		
		<a href="https://twitter.com/nbarbettini" target="_blank"><i class="fa fa-twitter"></i></a>
		
		
		
		<a href="https://www.recaffeinate.co" target="_blank"><i class="fa fa-external-link"></i></a>
		
	</div>
	
	

<article class="BlogPost">

    <header class="BlogPost-header">

        <time class="BlogPost-date" datetime="2017-12-21">December 21, 2017</time>

        <h1 class="BlogPost-title">
            
            Spread Serverless Holiday Cheer with Lambda and API Gateway
            
        </h1>

        <div class="BlogPost-attribution">
            
            <img src="/assets/avatar-nbarbettini-04840721946d0ed1aac5fdec3b87212e7d2656ec4482ba24df3a21d8306de85b.jpg" alt="avatar-nbarbettini.jpg" class="BlogPost-avatar">
            
            <span class="BlogPost-author">Nate Barbettini</span>
        </div>

    </header>

    <div class="BlogPost-content">
        
	<p>It’s that time of year again: Christmas music on the radio, festive decorations in the workplace, and a chill in the air. Except in the Southern Hemisphere, where it’s warm and balmy. And on the International Space Station, where the temperature is strictly regulated. But I digress.</p>

<p>It’s a season for reconnecting with loved ones, exchanging gifts, and eating delicious food. And, if you’re like me, a little downtime to work on fun projects.</p>

<p>Looking for something to work on for a few minutes? Why not build an API to spread some holiday cheer? Even if you’re an API or coding newbie, you can follow along with this simple project.</p>

<h2 id="cheer-as-a-service">Cheer as a Service</h2>

<p>The API will be simple: it will have one route called <code class="highlighter-rouge">/cheer</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /cheer
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">200</span><span class="w"> </span><span class="err">OK</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"holidaySeason"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"greeting"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Happy holidays!"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The API will determine whether it’s currently the holiday season using the precise, ultra-scientific method that supermarkets in the USA use to decide whether to start playing Christmas music: is today’s date after Thanksgiving, but before the end of the year?</p>

<p>If it’s the holidays, the API will return an randomly-selected greeting. If you want to personalize it, you can POST your name:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /cheer
{
  "name": "Nate"
}
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">200</span><span class="w"> </span><span class="err">OK</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"holidaySeason"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"greeting"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Merry Christmas, Nate!"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Use it in your IFTTT recipes, mail merges, and Twitter bots. Cheer-as-a-service is limited only by your imagination!</p>

<h2 id="create-a-lambda-function">Create a Lambda Function</h2>

<p>For such a simple API, there’s no need to use a web framework, or even set up a server. The whole API can be written in a few lines of JavaScript code and hosted on AWS Lambda for cheap.</p>

<p>If you don’t have an AWS account, go <a href="https://aws.amazon.com/account/">sign up</a> for free. Then, open the <a href="https://console.aws.amazon.com/lambda/home?region=us-east-1#/functions">Lambda console</a> and create a new function from scratch.</p>

<p>Name the new function <code class="highlighter-rouge">CheerAsAService</code> and pick Node 6.10 (or higher) as the runtime. If you’ve never created a Lambda function before, pick <strong>Custom role</strong> from the Role dropdown and create an IAM Role called <code class="highlighter-rouge">lambda_basic_execution</code> (the default) in the popup window. The role controls what permissions your API code has, and this code just needs the basics (permission to execute and create log messages). Click <strong>Create function</strong>.</p>

<p><img src="/assets/blog/serverless-holiday-cheer/create-function-2c57f65a7b158bb3b474729d4f5a3b1fe230167b8ac1269c8cc429e86b2f085d.png" alt="Create a new Lambda function" width="700" class="center-image" /></p>

<p>Time to write some code! Use the browser code editor to add code above the <code class="highlighter-rouge">exports.handler</code> line:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">isHolidaySeason</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
  <span class="kd">let</span> <span class="nx">dayOfThanksgiving</span> <span class="o">=</span> <span class="mi">22</span> <span class="o">+</span> <span class="p">(</span><span class="mi">11</span> <span class="o">-</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">(),</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">getDay</span><span class="p">())</span> <span class="o">%</span> <span class="mi">7</span><span class="p">;</span>

  <span class="kd">let</span> <span class="nx">isAfterThanksgiving</span> <span class="o">=</span> <span class="nx">now</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">||</span>
    <span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">===</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="nx">now</span><span class="p">.</span><span class="nx">getDay</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">dayOfThanksgiving</span><span class="p">);</span>
  
  <span class="k">return</span> <span class="nx">isAfterThanksgiving</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">isHolidaySeason()</code> function uses some date math to find Thanksgiving Day (in the USA, the fourth Thursday in November) and compares that to today’s date. (If the months look off, remember that JavaScript counts from January at 0.)</p>

<p>Next, add some more code above <code class="highlighter-rouge">exports.handler</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">phrases</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'Happy holidays'</span><span class="p">,</span>
  <span class="s1">'Merry Christmas'</span><span class="p">,</span>
  <span class="s1">'Ho ho ho'</span><span class="p">,</span>
  <span class="s1">'Feliz Navidad'</span><span class="p">,</span>
  <span class="s1">'Happy Hanukkah'</span><span class="p">,</span>
  <span class="s1">'Season</span><span class="se">\'</span><span class="s1">s greetings'</span>
<span class="p">];</span>

<span class="kd">function</span> <span class="nx">createCheerfulResponse</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">holidaySeason</span><span class="p">:</span> <span class="nx">isHolidaySeason</span><span class="p">()</span>
  <span class="p">};</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">holidaySeason</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">let</span> <span class="nx">randomPick</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">phrases</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">phrase</span> <span class="o">=</span> <span class="nx">phrases</span><span class="p">[</span><span class="nx">randomPick</span><span class="p">];</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">phrase</span> <span class="o">+=</span> <span class="s1">', '</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">phrase</span> <span class="o">+=</span> <span class="s1">'!'</span><span class="p">;</span>
  
  <span class="nx">response</span><span class="p">.</span><span class="nx">greeting</span> <span class="o">=</span> <span class="nx">phrase</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This function generates the JSON response that will be returned to the client. If a name is supplied, it’s used to personalize the response. Feel free to add your own greetings and phrases to the list!</p>

<p>With these functions in place, you can update the main handler at the bottom. This code runs when Lambda executes your function, so you’ll want to check for a <code class="highlighter-rouge">name</code> parameter (if it’s a POST), and return the API response:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">name</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">httpMethod</span> <span class="o">===</span> <span class="s1">'POST'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
      <span class="nx">name</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="s1">''</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Leave name blank</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">let</span> <span class="nx">responseBody</span> <span class="o">=</span> <span class="nx">createCheerfulResponse</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
  
  <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">statusCode</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">responseBody</span><span class="p">)</span>
  <span class="p">};</span>
  
  <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>That’s all the code you need! Make sure you click <strong>Save</strong> at the top-right of the Lambda console.</p>

<p>You can test the function by creating a test event. Click <strong>Test</strong> and use this JSON as the test event data:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">Frosty the Snowman</span><span class="se">\"</span><span class="s2">}"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"requestContext"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"httpMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"POST"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"stage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"prod"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"httpMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"POST"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><img src="/assets/blog/serverless-holiday-cheer/test-function-a2c003a810b2537f8fba84dab8309529717db81375621e78851ba2d0669e310e.png" alt="Successful function test" width="700" class="center-image" /></p>

<p>The function returns the correct response, but it’s not accessible on the public internet yet. To share it with the world, you’ll need to publish it (freeze the code), and then use API Gateway to map the function to a public URL.</p>

<p>To publish the function, choose <strong>Publish new version</strong> from the Actions button. The title of the function will update to <code class="highlighter-rouge">CheerAsAService:1</code>. You’ll need this name in a minute, when you link this function to the API Gateway rule you’ll create.</p>

<h2 id="create-the-api-in-api-gateway">Create the API in API Gateway</h2>

<p>Switch over to the <a href="https://console.aws.amazon.com/apigateway/home?region=us-east-1#/apis">API Gateway console</a> and create a new API called <code class="highlighter-rouge">CheerAsAServiceApi</code>.</p>

<p><img src="/assets/blog/serverless-holiday-cheer/new-api-gateway-19e8d118924e09d49d7e8dfc31f5d015d0b78cade90db425095fee009eb9a4b6.png" alt="Create a new API Gateway API" width="700" class="center-image" /></p>

<p>The API will have one path (or “resource”), called <code class="highlighter-rouge">/cheer</code>. From the Actions button, click <strong>Create Resource</strong>. Enter <code class="highlighter-rouge">Cheer</code> as the Resource Name, and the path will be automatically filled in.</p>

<p>Both the <code class="highlighter-rouge">GET</code> and <code class="highlighter-rouge">POST</code> methods will be supported. Instead of defining these separately, you can add a single rule that handles any method. With the <code class="highlighter-rouge">/cheer</code> resource selected, choose <strong>Create Method</strong> from the Actions button. Pick ANY and click the checkmark to add the method.</p>

<p>Choose <strong>Lambda Function</strong> as the integration type, and check <strong>Use Lambda Proxy Integration</strong>. Choose the region you created your Lambda function in (us-east-1, unless you changed the default), and enter the Lambda function name plus version: <code class="highlighter-rouge">CheerAsAService:1</code></p>

<p><img src="/assets/blog/serverless-holiday-cheer/cheer-method-setup-34c916012dcb546a0f4e046aba50822f700865dc65b53ae7e0c92a66a585a280.png" alt="Define a method for the /cheer resource" width="700" class="center-image" /></p>

<p>Click <strong>Save</strong> to create the method definition. On the Method Execution screen, click <strong>Test</strong> and pick a method (GET or POST) to send to your function. If everything is configured correctly, you’ll see the JSON response on the right.</p>

<p>You’re almost there! From the Actions button, choose <strong>Deploy API</strong>. Create a new stage called <code class="highlighter-rouge">production</code> and click <strong>Deploy</strong>. When the API is deployed, you’ll get an Invoke URL like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://blah.execute-api.us-east-1.amazonaws.com/production
</code></pre></div></div>

<p>You can see your live API in action by adding <code class="highlighter-rouge">/cheer</code> to that URL and requesting it in your browser. Sweet!</p>

<h2 id="add-a-domain-name">Add a Domain Name</h2>

<p>Right now, your API URL is long and a little boring. Before you share it with the world, you can add a custom domain name to make it more exciting (bonus points for using a trendy TLD like <code class="highlighter-rouge">.xyz</code> or <code class="highlighter-rouge">.io</code>). I registered <a href="https://www.holidaycheer.xyz">holidaycheer.xyz</a> with my favorite domain registrar so I could use <code class="highlighter-rouge">api.holidaycheer.xyz</code> as my API URL.</p>

<p>To map a custom domain name to your API in API Gateway, you’ll need to get an SSL/TLS certificate for your domain using <a href="https://console.aws.amazon.com/acm/home?region=us-east-1">AWS Certificate Manager</a> (ACM). No API is too simple for HTTPS!</p>

<p>Using ACM to get a certificate is easy. Simply click <strong>Request a certificate</strong>, enter the domain name (I used a wildcard: <code class="highlighter-rouge">*.holidaycheer.xyz</code>) and verify that you are the owner of the domain.</p>

<p>Then, in the API Gateway console, click on <strong>Custom Domain Names</strong> and create a new custom name. Pick the certificate you just created, and map the path <code class="highlighter-rouge">/</code> to your API’s <code class="highlighter-rouge">production</code> stage.</p>

<p><img src="/assets/blog/serverless-holiday-cheer/add-custom-domain-name-42c17244a67fbdbf0975579c234ac76be558c4afd961aae48735357f9ecc3070.png" alt="Add a custom domain name" width="500" class="center-image" /></p>

<p>When you click Save, AWS will start setting up a CloudFront distribution for your API. You can see the CloudFront domain name immediately (like <code class="highlighter-rouge">dz123.cloudfront.net</code>). You’ll need to log into your domain registrar and update the DNS settings for your domain name. I added a CNAME record from <code class="highlighter-rouge">api.holidaycheer.xyz</code> to the domain generated by CloudFront.</p>

<p><img src="/assets/blog/serverless-holiday-cheer/cname-record-890ee45cda7a6cf07c31f250426327e4d705822cc46d010792355cadbec17026.png" alt="Add a custom domain name" width="700" class="center-image" /></p>

<p>Go grab a cup of coffee (or eggnog), because you’ll be waiting a while. Deploying the CloudFront distribution (and propagating the DNS record changes) can take half an hour or more. Come back when you’ve had enough to drink!</p>

<p>When everything is deployed, you’ll be able to use a tool like Postman (or any browser) to make requests to your public API:</p>

<p><img src="/assets/blog/serverless-holiday-cheer/post-with-postman-2eb7be684f232408a5d618d1c1a869e32af29a2ec38fdf3ac426950d2a84380a.png" alt="Add a custom domain name" width="700" class="center-image" /></p>

<h2 id="eat-drink-and-code-merrily">Eat, Drink, and Code Merrily</h2>
<p>That’s it! You’ve built a real, working API with a few lines of code and some useful AWS services. The full source code (all 63 lines) is available <a href="https://github.com/nbarbettini/holidaycheer.xyz">on GitHub</a>.</p>

<p>You can try the API out live: <a href="https://api.holidaycheer.xyz/cheer">api.holidaycheer.xyz/cheer</a></p>

<p>When you find yourself working on more complicated projects, check out <a href="https://developer.okta.com/">Okta’s APIs</a>. We make it easy to add user identity and authorization to your apps and APIs without a ton of code. How’s that for cheerful?</p>

<p>From everyone here at Okta, may you and your loved ones have a wonderful (and nerdy) holiday season.</p>

<p>Stay warm! &lt;3</p>


    </div>

    
    <div id="disqus">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_title = 'Spread Serverless Holiday Cheer with Lambda and API Gateway';
            var disqus_url = 'https://developer.okta.com/blog/2017/12/21/spread-serverless-holiday-cheer';

            (function () {
                var dsq = document.createElement('script');
                dsq.async = true;
                dsq.type = 'text/javascript';
                dsq.src = '//oktadevblog.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>
              Please enable JavaScript to view the
              <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus</a>.
         </noscript>
    </div>
    
</article>

		
</section>

		
	</div><footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">

                <a class="Logo" href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">
                    <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    Visit okta.com
                </a>

            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">

                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate-with-okta/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/change-log/">Change Log</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notices</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="https://developer.okta.com/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="https://developer.okta.com/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="https://developer.okta.com/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-aa397c892d9083236c5cb20732dde679021b9236c8142ce78177b8b184567a02.js"></script>
    <script type="text/javascript" src="/assets/myOkta-911cbafbbe079b7a5522d9cbe15bd2a5f44e1582531e88393934bec69f97696b.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/blog-6e32dad27404131cc8630a5282264bed2ab4c08c91ac86fa496b75c53aa4f681.js"></script>
    

  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
