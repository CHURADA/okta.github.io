<!doctype html>
<!--[if lt IE 7 ]> <html class="ie6 no-flexbox"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7 no-flexbox"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8 no-flexbox"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9 no-flexbox"> <![endif]-->
<!--[if IE 10 ]>    <html class="ie10 no-flexbox"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!--> <html class="modern wf-loading" lang="en"> <!--<![endif]-->
  <head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager

      // Start Heap Analytics
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load("3356162945");
      // End Heap Analytics
    }
  </script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="Develop a Microservices Architecture with OAuth 2.0 and JHipster | Okta Developer">
  <meta class="swiftype" name="summary" data-type="string" content="This post shows you how to use JHipster to create a microservices architecture based on Spring Boot, Spring Security, and OAuth." />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-914cad2dd6d069302444327ce911da52da68a3c68755f66cf5a4e92b9a38f3eb.css">
  
  
  <title>Develop a Microservices Architecture with OAuth 2.0 and JHipster | Okta Developer</title>
  <meta name="description" content="This post shows you how to use JHipster to create a microservices architecture based on Spring Boot, Spring Security, and OAuth.">
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#21313a">
  <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
</head>

  
    <body id="blog">
	




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first expanded">
          <a href="https://developer.okta.com/product/">Product</a>
          <ul class="menu">
            <li class="first leaf"><a href="https://developer.okta.com/product/">Overview</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authentication/">Authentication</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authorization/">Authorization</a></li>
            <li class="last leaf"><a href="https://developer.okta.com/product/user-management/">User Management</a></li>
          </ul>
        </li>
        <li class="leaf">
          <a href="https://developer.okta.com/pricing/">Pricing</a>
        </li>
        <li class="leaf">
          <a href="/blog/" class="active">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="last leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
            </g>
        </svg>
        <svg class="CloseIcon" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="ALl-Boards" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Desktop" transform="translate(-915.000000, -235.000000)" fill="#FFFFFF">
              <g id="Search-bar-Active" transform="translate(30.000000, 26.000000)">
                <polygon id="Icon/Cross" points="901 210.6 899.4 209 893 215.4 886.6 209 885 210.6 891.4 217 885 223.4 886.6 225 893 218.6 899.4 225 901 223.4 894.6 217"></polygon>
              </g>
            </g>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" rel="noopener noreferrer" href="https://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3Dhttps://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3D" class="Button--redOutline">Login</a>
        <a href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

	<div class="page-content">
		
		






<section class="Blog is-single">
		
	<div class="Blog-social">
		
		<a href="https://github.com/mraible" target="_blank"><i class="fa fa-github"></i></a>
		
		
		<a href="https://twitter.com/mraible" target="_blank"><i class="fa fa-twitter"></i></a>
		
		
		
		<a href="http://raibledesigns.com" target="_blank"><i class="fa fa-external-link"></i></a>
		
	</div>
	
	

<article class="BlogPost">

    <header class="BlogPost-header">

        <time class="BlogPost-date" datetime="2018-03-01">March 1, 2018</time>

        <h1 class="BlogPost-title">
            
            Develop a Microservices Architecture with OAuth 2.0 and JHipster
            
        </h1>

        <div class="BlogPost-attribution">
            
            <img src="/assets/avatar-matt_raible-9974af6192eb1753b7137c8fff0a2c6e6bb9736a2517986cb5cc50bb040e83d4.jpg" alt="avatar-matt_raible.jpg" class="BlogPost-avatar">
            
            <span class="BlogPost-author">Matt Raible</span>
        </div>

    </header>

    <div class="BlogPost-content">
        
	<p>JHipster is a development platform to generate, develop, and deploy Spring Boot + Angular web applications and Spring microservices. It supports using many types of authentication: JWT, session-based, and OAuth 2.0. In its 5.0 release, it’ll also add React as a UI option. The 5.0 version is under active development and will likely be released in the next few months.</p>

<p><img src="/assets/blog/microservices-jhipster-oauth/what-is-jhipster-800981d8ce6a437997c930dd6fe3bdddcbb0df902d044e9577fa1e36609f7b4f.png" alt="Spring Boot + Angular = JHipster" width="800" class="center-image" /></p>

<p>In addition to having two popular UI frameworks, JHipster also has modules that support generating mobile applications. If you like Ionic, which currently leverages Angular, you can use <a href="/blog/2018/01/30/jhipster-ionic-with-oidc-authentication">Ionic for JHipster</a>. If you’re a React aficionado, you can use <a href="https://github.com/ruddell/ignite-jhipster">Ignite JHipster</a>.</p>

<p><a href="http://www.jhipster.tech">JHipster</a> is 🔥, and so are microservices! Follow the instructions in this tutorial to create an API gateway, a blog microservice, and a companion store microservice.</p>

<h2 id="install-jhipster">Install JHipster</h2>

<p>There are six different ways to <a href="http://www.jhipster.tech/installation/">install JHipster</a>. The first way, <a href="https://start.jhipster.tech/">JHipster Online</a>, doesn’t even require you to install anything. It’ll generate the application and push it to a GitHub repository for you. While this works nicely, I like to have my example apps in a single repository for easier discoverability.</p>

<p>A local installation with Yarn or npm are other options, as is using a package manager (Homebrew on Mac, Chocalatey on Windows), using a Vagrant-based developer box, or using a Docker container. Since I’m on a Mac, I like to use Homebrew because it allows me to use JHipster with multiple Node versions without installing JHipster again. You can install JHipster on a Mac using the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install jhipster
</code></pre></div></div>

<p>On Windows, it’s as simple as:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>choco install jhipster
</code></pre></div></div>

<p>Or you can use the standard npm installation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install <span class="nt">-g</span> yo generator-jhipster
</code></pre></div></div>

<p>Create an <code class="highlighter-rouge">okta-jhipster-microservices-oauth-example</code> directory on your hard drive, or simply <code class="highlighter-rouge">apps</code> if you don’t want to spell it all out.</p>

<blockquote>
  <p>One of the most common things to happen with JHipster 4.x app is you’ll start it, and there will be a blank page when you navigate to it in your browser. If that happens to you, you need to rebuild the front end. You can do this by running <code class="highlighter-rouge">npm run webpack:build</code> and restarting your server, or by running <code class="highlighter-rouge">yarn start</code> (which will start an auto-reloading webpack dev server on port 9000).</p>
</blockquote>

<h2 id="generate-an-api-gateway">Generate an API Gateway</h2>

<p>To generate an API Gateway with JHipster, open a terminal window, navigate to <code class="highlighter-rouge">okta-jhipster-microservices-oauth-example</code>, create a <code class="highlighter-rouge">gateway</code> directory, and run <code class="highlighter-rouge">jhipster</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir gateway &amp;&amp; cd gateway &amp;&amp; jhipster
</code></pre></div></div>

<p>JHipster asks a multitude of questions about the application you want to create and what features you’d like to include. Use the following answers to generate a gateway with OAuth 2.0 support.</p>

<table>
  <thead>
    <tr>
      <th>Question</th>
      <th>Answer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Type of application?</td>
      <td><code class="highlighter-rouge">Microservice gateway</code></td>
    </tr>
    <tr>
      <td>Name?</td>
      <td><code class="highlighter-rouge">gateway</code></td>
    </tr>
    <tr>
      <td>Port?</td>
      <td><code class="highlighter-rouge">8080</code></td>
    </tr>
    <tr>
      <td>Java package name?</td>
      <td><code class="highlighter-rouge">com.okta.developer.gateway</code></td>
    </tr>
    <tr>
      <td>Which service discovery server?</td>
      <td><code class="highlighter-rouge">JHipster Registry</code></td>
    </tr>
    <tr>
      <td>Type of authentication?</td>
      <td><code class="highlighter-rouge">OAuth 2.0 / OIDC</code></td>
    </tr>
    <tr>
      <td>Type of database?</td>
      <td><code class="highlighter-rouge">SQL</code></td>
    </tr>
    <tr>
      <td>Production database?</td>
      <td><code class="highlighter-rouge">PostgreSQL</code></td>
    </tr>
    <tr>
      <td>Development database?</td>
      <td><code class="highlighter-rouge">H2 with disk-based persistence</code></td>
    </tr>
    <tr>
      <td>Use Hibernate 2nd level cache?</td>
      <td><code class="highlighter-rouge">Yes</code></td>
    </tr>
    <tr>
      <td>Maven or Gradle?</td>
      <td><code class="highlighter-rouge">Maven</code></td>
    </tr>
    <tr>
      <td>Other technologies?</td>
      <td><code class="highlighter-rouge">&lt;blank&gt;</code></td>
    </tr>
    <tr>
      <td>Client framework?</td>
      <td><code class="highlighter-rouge">Angular 5</code></td>
    </tr>
    <tr>
      <td>Enable SASS support?</td>
      <td><code class="highlighter-rouge">No</code></td>
    </tr>
    <tr>
      <td>Enable i18n?</td>
      <td><code class="highlighter-rouge">Yes</code></td>
    </tr>
    <tr>
      <td>Native language of application?</td>
      <td><code class="highlighter-rouge">English</code></td>
    </tr>
    <tr>
      <td>Additional languages?</td>
      <td><code class="highlighter-rouge">&lt;blank&gt;</code></td>
    </tr>
    <tr>
      <td>Additional testing frameworks?</td>
      <td><code class="highlighter-rouge">Protractor</code></td>
    </tr>
    <tr>
      <td>Install other generators?</td>
      <td><code class="highlighter-rouge">No</code></td>
    </tr>
  </tbody>
</table>

<p>The project generation process will take several minutes to run, depending on your internet connection speed.</p>

<p>While you’re waiting, you can get started with setting up OAuth with Okta.</p>

<h3 id="what-is-oauth-20">What is OAuth 2.0?</h3>

<p>The OAuth implementation in JHipster leverages Spring Boot and its OAuth 2.0 support (an <code class="highlighter-rouge">@EnableOAuthSso</code> annotation). If you’re not sure what OAuth and OpenID Connect (OIDC) are, please see <a href="/blog/2017/06/21/what-the-heck-is-oauth">What the Heck is OAuth?</a>. It provides single sign-on (SSO) to JHipster applications. <a href="/blog/2018/02/13/secure-spring-microservices-with-oauth">Secure a Spring Microservices Architecture with Spring Security and OAuth 2.0</a> shows a bare-bones Spring microservices architecture using OAuth. JHipster uses the same setup internally.</p>

<p>JHipster ships with <a href="https://keycloak.org">Keycloak</a> configured for OAuth by default. To configure your apps to work with Okta, you’ll first need to <a href="https://developer.okta.com/signup/">create a free developer account</a>. After doing so, you’ll get your own Okta domain, which has a name like <code class="highlighter-rouge">https://dev-123456.oktapreview.com</code>.</p>

<h3 id="create-an-openid-connect-application-on-okta">Create an OpenID Connect Application on Okta</h3>

<p>Create an OpenID Connect (OIDC) app in Okta to get a client ID and secret. This basically means you’re “registering” your application with Okta. Log in to your Okta Developer account and navigate to <strong>Applications</strong> &gt; <strong>Add Application</strong>. Click <strong>Web</strong> and click the <strong>Next</strong> . Give the app a name you’ll remember (e.g., <code class="highlighter-rouge">JHipster Microservices</code>), and specify <code class="highlighter-rouge">http://localhost:8080</code> as a Base URI and <code class="highlighter-rouge">http://localhost:8080/login</code> as a Login Redirect URI. Click <strong>Done</strong> and make a note of your client ID and client secret values.</p>

<p>For the roles coming from Okta to match the default roles in JHipster, you’ll need to create them. Create a <code class="highlighter-rouge">ROLE_ADMIN</code> and <code class="highlighter-rouge">ROLE_USER</code> group (<strong>Users</strong> &gt; <strong>Groups</strong> &gt; <strong>Add Group</strong>) and add users to them. You can use the account you signed up with, or create a new user (<strong>Users</strong> &gt; <strong>Add Person</strong>). Navigate to <strong>API</strong> &gt; <strong>Authorization Servers</strong>, click the <strong>Authorization Servers</strong> tab and edit the default one. Click the <strong>Claims</strong> tab and <strong>Add Claim</strong>. Name it <code class="highlighter-rouge">roles</code>, and include it in the ID Token. Set the value type to <code class="highlighter-rouge">Groups</code> and set the filter to be a Regex of <code class="highlighter-rouge">.*</code>.</p>

<p>Modify <code class="highlighter-rouge">gateway/src/main/resources/config/application.yml</code> to have the following values:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">security</span><span class="pi">:</span>
    <span class="na">basic</span><span class="pi">:</span>
        <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">oauth2</span><span class="pi">:</span>
        <span class="na">client</span><span class="pi">:</span>
            <span class="na">access-token-uri</span><span class="pi">:</span> <span class="s"><span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/token</span>
            <span class="na">user-authorization-uri</span><span class="pi">:</span> <span class="s"><span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/authorize</span>
            <span class="na">client-id</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">clientId</span><span class="pi">}</span>
            <span class="na">client-secret</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">clientSecret</span><span class="pi">}</span>
            <span class="na">client-authentication-scheme</span><span class="pi">:</span> <span class="s">form</span>
            <span class="na">scope</span><span class="pi">:</span> <span class="s">openid profile email</span>
        <span class="na">resource</span><span class="pi">:</span>
            <span class="na">filter-order</span><span class="pi">:</span> <span class="s">3</span>
            <span class="na">user-info-uri</span><span class="pi">:</span> <span class="s"><span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/userinfo</span>
            <span class="na">token-info-uri</span><span class="pi">:</span> <span class="s"><span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/introspect</span>
            <span class="na">prefer-token-info</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div>

<p><strong>NOTE:</strong> Make sure to remove the <code class="highlighter-rouge">security.oauth2.resource.jwt.key-uri</code> key and value. This property causes Spring Security to retrieve a public key from Keycloak, and Okta doesn’t have this same functionality. I <a href="https://github.com/jhipster/generator-jhipster/issues/7116">entered an issue</a> to fix this in JHipster.</p>

<p>You can also use environment variables to override the default values. Using this technique is recommend because 1) You don’t need to modify the values in each microservice application and 2) it prevents you from leaking your client secret in a source code repository.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">SECURITY_OAUTH2_CLIENT_ACCESS_TOKEN_URI</span><span class="o">=</span><span class="s2">"<span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/token"</span>
<span class="nb">export </span><span class="nv">SECURITY_OAUTH2_CLIENT_USER_AUTHORIZATION_URI</span><span class="o">=</span><span class="s2">"<span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/authorize"</span>
<span class="nb">export </span><span class="nv">SECURITY_OAUTH2_RESOURCE_USER_INFO_URI</span><span class="o">=</span><span class="s2">"<span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/userinfo"</span>
<span class="nb">export </span><span class="nv">SECURITY_OAUTH2_RESOURCE_TOKEN_INFO_URI</span><span class="o">=</span><span class="s2">"<span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default/v1/introspect"</span>
<span class="nb">export </span><span class="nv">SECURITY_OAUTH2_CLIENT_CLIENT_ID</span><span class="o">=</span><span class="s2">"{clientId}"</span>
<span class="nb">export </span><span class="nv">SECURITY_OAUTH2_CLIENT_CLIENT_SECRET</span><span class="o">=</span><span class="s2">"{clientSecret}"</span>
</code></pre></div></div>

<p><strong>TIP:</strong> If you’re using JHipster’s Protractor support, you’ll want to add a user to the <code class="highlighter-rouge">ROLE_ADMIN</code> group on Okta and change the credentials in <code class="highlighter-rouge">src/test/javascript/e2e/account/account.spec.ts</code> and <code class="highlighter-rouge">src/test/javascript/e2e/admin/administration.spec.ts</code>.</p>

<h2 id="install-the-jhipster-registry">Install the JHipster Registry</h2>

<p>You’ll need a service discovery server installed before you can start the gateway. In a browser, go to the <a href="https://github.com/jhipster/jhipster-registry/releases">JHipster Registry release page</a> and download the latest release. At the time of this writing, it was v3.2.4.</p>

<p>Download the WAR and put it alongside your <code class="highlighter-rouge">gateway</code> application. Start it so your apps can register with it.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="n">jhipster</span><span class="o">-</span><span class="n">registry</span><span class="o">-</span><span class="mf">3.2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="na">war</span>
</code></pre></div></div>

<p>Start the <code class="highlighter-rouge">gateway</code> app by navigating to its directory in a terminal and running:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">./</span><span class="n">mvnw</span>
</code></pre></div></div>

<p><strong>TIP:</strong> If you already have Maven installed, you can just use <code class="highlighter-rouge">mvn</code>.</p>

<p>Open your browser and go to <code class="highlighter-rouge">http://localhost:8761</code>. Log in with <code class="highlighter-rouge">admin/admin</code>, and you should see a welcome page that shows the gateway has registered.</p>

<p><img src="/assets/blog/microservices-jhipster-oauth/jhipster-registry-with-gateway-1f6ab845196ceb237d0d67262890e9f7a93227be586f518f5656f7c43da0b010.png" alt="JHipster Registry with Gateway registered" width="800" class="center-image" /></p>

<h2 id="generate-a-blog-microservice-application">Generate a Blog Microservice Application</h2>

<p>In <code class="highlighter-rouge">okta-jhipster-microservices-oauth-example</code>, create a <code class="highlighter-rouge">blog</code> directory, and run <code class="highlighter-rouge">jhipster</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir blog &amp;&amp; cd blog &amp;&amp; jhipster
</code></pre></div></div>

<p>Use the following answers to generate a blog microservice with OAuth 2.0 support.</p>

<table>
  <thead>
    <tr>
      <th>Question</th>
      <th>Answer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Type of application?</td>
      <td><code class="highlighter-rouge">Microservice application</code></td>
    </tr>
    <tr>
      <td>Name?</td>
      <td><code class="highlighter-rouge">blog</code></td>
    </tr>
    <tr>
      <td>Port?</td>
      <td><code class="highlighter-rouge">8081</code></td>
    </tr>
    <tr>
      <td>Java package name?</td>
      <td><code class="highlighter-rouge">com.okta.developer.blog</code></td>
    </tr>
    <tr>
      <td>Which service discovery server?</td>
      <td><code class="highlighter-rouge">JHipster Registry</code></td>
    </tr>
    <tr>
      <td>Type of authentication?</td>
      <td><code class="highlighter-rouge">OAuth 2.0 / OIDC</code></td>
    </tr>
    <tr>
      <td>Type of database?</td>
      <td><code class="highlighter-rouge">SQL</code></td>
    </tr>
    <tr>
      <td>Production database?</td>
      <td><code class="highlighter-rouge">PostgreSQL</code></td>
    </tr>
    <tr>
      <td>Development database?</td>
      <td><code class="highlighter-rouge">H2 with disk-based persistence</code></td>
    </tr>
    <tr>
      <td>Spring cache?</td>
      <td><code class="highlighter-rouge">Yes, with Hazelcast</code></td>
    </tr>
    <tr>
      <td>Use Hibernate 2nd level cache?</td>
      <td><code class="highlighter-rouge">Yes</code></td>
    </tr>
    <tr>
      <td>Maven or Gradle?</td>
      <td><code class="highlighter-rouge">Maven</code></td>
    </tr>
    <tr>
      <td>Other technologies?</td>
      <td><code class="highlighter-rouge">Search engine using Elasticsearch</code></td>
    </tr>
    <tr>
      <td>Enable i18n?</td>
      <td><code class="highlighter-rouge">Yes</code></td>
    </tr>
    <tr>
      <td>Native language of application?</td>
      <td><code class="highlighter-rouge">English</code></td>
    </tr>
    <tr>
      <td>Additional languages?</td>
      <td><code class="highlighter-rouge">&lt;blank&gt;</code></td>
    </tr>
    <tr>
      <td>Additional testing frameworks?</td>
      <td><code class="highlighter-rouge">&lt;blank&gt;</code></td>
    </tr>
    <tr>
      <td>Install other generators?</td>
      <td><code class="highlighter-rouge">No</code></td>
    </tr>
  </tbody>
</table>

<p>Create a <code class="highlighter-rouge">blog/blog.jh</code> file and fill it with the following JDL (JHipster Domain Language).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>entity Blog {
    name String required minlength(3),
    handle String required minlength(2)
}

entity Entry {
    title String required,
    content TextBlob required,
    date ZonedDateTime required
}

entity Tag {
    name String required minlength(2)
}

relationship ManyToOne {
    Entry{blog(name)} to Blog
}

relationship ManyToMany {
    Entry{tag(name)} to Tag{entry}
}
</code></pre></div></div>

<p><strong>NOTE:</strong> This schema does not have a many-to-one relationship from <code class="highlighter-rouge">Blog</code> to <code class="highlighter-rouge">User</code> because JHipster’s microservices support for OAuth doesn’t currently have a <code class="highlighter-rouge">User</code> entity. I’m <a href="https://github.com/jhipster/generator-jhipster/issues/7065">currently working to improve that</a>.</p>

<p>Run <code class="highlighter-rouge">jhipster import-jdl blog.jh</code> to create the backend API to power this schema. Answer <code class="highlighter-rouge">a</code> when prompted to overwrite <code class="highlighter-rouge">src/main/resources/config/liquibase/master.xml</code>.</p>

<p>Change directories into the <code class="highlighter-rouge">gateway</code> application and run <code class="highlighter-rouge">jhipster entity blog</code>. Specify <code class="highlighter-rouge">Y</code> when prompted to generate from an existing microservice. Enter <code class="highlighter-rouge">../blog</code> as the path to the root directory. Select <code class="highlighter-rouge">Yes, re-generate the entity</code> and type <code class="highlighter-rouge">a</code> when prompted to overwrite <code class="highlighter-rouge">src/main/webapp/app/entities/entity.module.ts</code>.</p>

<p>Run the following commands to generate the UI for <code class="highlighter-rouge">entry</code> and <code class="highlighter-rouge">tag</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jhipster entity entry
jhipster entity tag
</code></pre></div></div>

<h2 id="generate-a-store-microservice-application">Generate a Store Microservice Application</h2>

<p>In <code class="highlighter-rouge">okta-jhipster-microservices-oauth-example</code>, create a <code class="highlighter-rouge">store</code> directory, then run <code class="highlighter-rouge">jhipster</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir store &amp;&amp; cd store &amp;&amp; jhipster
</code></pre></div></div>

<p>Use the following answers to generate a store microservice with OAuth 2.0 and MongoDB.</p>

<table>
  <thead>
    <tr>
      <th>Question</th>
      <th>Answer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Type of application?</td>
      <td><code class="highlighter-rouge">Microservice application</code></td>
    </tr>
    <tr>
      <td>Name?</td>
      <td><code class="highlighter-rouge">store</code></td>
    </tr>
    <tr>
      <td>Port?</td>
      <td><code class="highlighter-rouge">8082</code></td>
    </tr>
    <tr>
      <td>Java package name?</td>
      <td><code class="highlighter-rouge">com.okta.developer.store</code></td>
    </tr>
    <tr>
      <td>Which service discovery server?</td>
      <td><code class="highlighter-rouge">JHipster Registry</code></td>
    </tr>
    <tr>
      <td>Type of authentication?</td>
      <td><code class="highlighter-rouge">OAuth 2.0 / OIDC</code></td>
    </tr>
    <tr>
      <td>Type of database?</td>
      <td><code class="highlighter-rouge">MongoDB</code></td>
    </tr>
    <tr>
      <td>Spring cache?</td>
      <td><code class="highlighter-rouge">Yes, with Hazelcast</code></td>
    </tr>
    <tr>
      <td>Use Hibernate 2nd level cache?</td>
      <td><code class="highlighter-rouge">Yes</code></td>
    </tr>
    <tr>
      <td>Maven or Gradle?</td>
      <td><code class="highlighter-rouge">Maven</code></td>
    </tr>
    <tr>
      <td>Other technologies?</td>
      <td><code class="highlighter-rouge">Search engine using Elasticsearch</code></td>
    </tr>
    <tr>
      <td>Enable i18n?</td>
      <td><code class="highlighter-rouge">Yes</code></td>
    </tr>
    <tr>
      <td>Native language of application?</td>
      <td><code class="highlighter-rouge">English</code></td>
    </tr>
    <tr>
      <td>Additional languages?</td>
      <td><code class="highlighter-rouge">&lt;blank&gt;</code></td>
    </tr>
    <tr>
      <td>Additional testing frameworks?</td>
      <td><code class="highlighter-rouge">&lt;blank&gt;</code></td>
    </tr>
    <tr>
      <td>Install other generators?</td>
      <td><code class="highlighter-rouge">No</code></td>
    </tr>
  </tbody>
</table>

<p>You have an empty microservice, but it needs some entities to manage! Run <code class="highlighter-rouge">jhipster entity product</code> to create a product entity.</p>

<table>
  <thead>
    <tr>
      <th>Question</th>
      <th>Answer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Add a field?</td>
      <td><code class="highlighter-rouge">Y</code></td>
    </tr>
    <tr>
      <td>Field name?</td>
      <td><code class="highlighter-rouge">name</code></td>
    </tr>
    <tr>
      <td>Field type?</td>
      <td><code class="highlighter-rouge">String</code></td>
    </tr>
    <tr>
      <td>Field validation rules?</td>
      <td><code class="highlighter-rouge">Y</code></td>
    </tr>
    <tr>
      <td>Which validation rules?</td>
      <td><code class="highlighter-rouge">Required</code></td>
    </tr>
    <tr>
      <td>Add a field?</td>
      <td><code class="highlighter-rouge">Y</code></td>
    </tr>
    <tr>
      <td>Field name?</td>
      <td><code class="highlighter-rouge">price</code></td>
    </tr>
    <tr>
      <td>Field type?</td>
      <td><code class="highlighter-rouge">Double</code></td>
    </tr>
    <tr>
      <td>Field validation rules?</td>
      <td><code class="highlighter-rouge">Y</code></td>
    </tr>
    <tr>
      <td>Which validation rules?</td>
      <td><code class="highlighter-rouge">Required</code> and <code class="highlighter-rouge">Minimum</code></td>
    </tr>
    <tr>
      <td>Field minimum?</td>
      <td><code class="highlighter-rouge">0</code></td>
    </tr>
    <tr>
      <td>Add a field?</td>
      <td><code class="highlighter-rouge">Y</code></td>
    </tr>
    <tr>
      <td>Field name?</td>
      <td><code class="highlighter-rouge">image</code></td>
    </tr>
    <tr>
      <td>Field type?</td>
      <td><code class="highlighter-rouge">[BETA] Blob</code></td>
    </tr>
    <tr>
      <td>What is the content of the blob field?</td>
      <td><code class="highlighter-rouge">An image</code></td>
    </tr>
    <tr>
      <td>Field validation rules?</td>
      <td><code class="highlighter-rouge">N</code></td>
    </tr>
    <tr>
      <td>Add a field?</td>
      <td><code class="highlighter-rouge">N</code></td>
    </tr>
    <tr>
      <td>Separate service class?</td>
      <td><code class="highlighter-rouge">No</code></td>
    </tr>
    <tr>
      <td>Pagination on entity?</td>
      <td><code class="highlighter-rouge">Yes, with pagination links</code></td>
    </tr>
  </tbody>
</table>

<p>Change directories into the <code class="highlighter-rouge">gateway</code> application and run <code class="highlighter-rouge">jhipster entity product</code>. Specify <code class="highlighter-rouge">Y</code> when prompted to generate from an existing microservice. Enter <code class="highlighter-rouge">../store</code> as the path to the root directory. Select <code class="highlighter-rouge">Yes, re-generate the entity</code> and type <code class="highlighter-rouge">a</code> when prompted to overwrite <code class="highlighter-rouge">src/main/webapp/app/entities/entity.module.ts</code>.</p>

<h2 id="run-your-microservices-architecture">Run Your Microservices Architecture</h2>

<p>There’s a lot of services to start if you want to see all your applications running. The blog application depends on Elasticsearch and PostgreSQL, but only when running in production mode. The store app, however, needs MongoDB running. Luckily, JHipster creates Docker Compose files you can use to start MongoDB.</p>

<p><strong>NOTE:</strong> Make sure to remove the <code class="highlighter-rouge">security.oauth2.resource.jwt.key-uri</code> key and value from <code class="highlighter-rouge">src/main/resources/config/application.yml</code> in the gateway, blog, and store apps before you try to run them.</p>

<ol>
  <li>Restart the gateway app since you added new entity management pages to it.</li>
  <li>Start the blog app from the <code class="highlighter-rouge">blog</code> directory by running <code class="highlighter-rouge">mvn</code>.</li>
  <li>
    <p>Start a Docker container for MongoDB from the <code class="highlighter-rouge">store</code> directory by running:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> docker-compose -f src/main/docker/mongodb.yml up
</code></pre></div>    </div>
  </li>
  <li>Start the store app from the <code class="highlighter-rouge">store</code> directory by running <code class="highlighter-rouge">mvn</code>.</li>
</ol>

<p>Once everything finishes starting, open a browser to <code class="highlighter-rouge">http://localhost:8080</code> and click <strong>sign in</strong>. You should be redirected to your Okta org to sign-in, then back to the gateway once you’ve entered valid credentials.</p>

<p><img src="/assets/blog/microservices-jhipster-oauth/welcome-jhipster-4673a7e3117a0567d95e71b2b7bf7f7941f90247619e948f407c444ef0485e2e.png" alt="Welcome, JHipster" width="800" class="center-image" /></p>

<p><img src="/assets/blog/microservices-jhipster-oauth/okta-sign-in-432ed89dd9228f47ad1e62fac9d3c5bacf3f2c54fe6f998e4f8353947d7f6648.png" alt="Okta Sign-In" width="800" class="center-image" /></p>

<p><img src="/assets/blog/microservices-jhipster-oauth/jhipster-logged-in-ceea5b498efbf586719f709a722655bb32622aa60d0a4cfd7d35a1e19eb987cd.png" alt="JHipster after Okta SSO" width="800" class="center-image" /></p>

<p>You should be able to navigate to <strong>Entities</strong> &gt; <strong>Blog</strong> and add a new blog record to your blog microservice.</p>

<p><img src="/assets/blog/microservices-jhipster-oauth/new-blog-12cbac80fd545b75fd13848bb374d19b5501db025f5f55ee6ff91abf2f4463a1.png" alt="New Blog" width="800" class="center-image" /></p>

<p>Navigate to <strong>Entities</strong> &gt; <strong>Product</strong> to prove your product microservice is working. Since you added an image as a property, you’ll be prompted to upload one when creating a new record.</p>

<p><img src="/assets/blog/microservices-jhipster-oauth/add-product-dialog-c3928931cf309bb6e0ab5b9c326e7bc32c753f5032c9c7ebbb1a74ae75c403d0.png" alt="Add Product Dialog" width="800" class="center-image" /></p>

<p>Click <strong>Save</strong> and you’ll know it’s correctly using MongoDB based on the generated ID.</p>

<p><img src="/assets/blog/microservices-jhipster-oauth/new-product-3b2076c0586a39d31aeee804a850546561df99fa19376d75eee9d8e5a86c07b5.png" alt="New Product" width="800" class="center-image" /></p>

<h3 id="use-docker-compose-to-run-everything">Use Docker Compose to Run Everything</h3>

<p>Rather than starting all your services individually, you can also start them all using <a href="https://docs.docker.com/compose/">Docker Compose</a>.</p>

<blockquote>
  <p>If you’d like to learn more about Docker Compose, see <a href="/blog/2017/10/11/developers-guide-to-docker-part-3">A Developer’s Guide To Docker - Docker Compose</a>.</p>
</blockquote>

<p>Create a <code class="highlighter-rouge">docker-compose</code> directory in the root directory (<code class="highlighter-rouge">okta-jhipster-microservices-oauth-example</code>) of your applications and run JHipster’s Docker Compose sub-generator.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir docker-compose &amp;&amp; cd docker-compose &amp;&amp; jhipster docker-compose
</code></pre></div></div>

<p>Answer as follows when prompted:</p>

<table>
  <thead>
    <tr>
      <th>Question</th>
      <th>Answer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Type of application?</td>
      <td><code class="highlighter-rouge">Microservice application</code></td>
    </tr>
    <tr>
      <td>Type of gateway?</td>
      <td><code class="highlighter-rouge">JHipster gateway</code></td>
    </tr>
    <tr>
      <td>Directory location?</td>
      <td><code class="highlighter-rouge">../</code></td>
    </tr>
    <tr>
      <td>Applications to include?</td>
      <td><code class="highlighter-rouge">&lt;select all&gt;</code></td>
    </tr>
    <tr>
      <td>Applications with clustered databases?</td>
      <td><code class="highlighter-rouge">&lt;blank&gt;</code></td>
    </tr>
    <tr>
      <td>Setup monitoring?</td>
      <td><code class="highlighter-rouge">Yes, with JHipster Console</code></td>
    </tr>
    <tr>
      <td>Additional technologies?</td>
      <td><code class="highlighter-rouge">Zipkin</code></td>
    </tr>
    <tr>
      <td>Admin password</td>
      <td><code class="highlighter-rouge">&lt;choose your own&gt;</code></td>
    </tr>
  </tbody>
</table>

<p>You’ll get a warning saying you need to generate Docker images by running the following command in the <code class="highlighter-rouge">blog</code>, <code class="highlighter-rouge">gateway</code>, and <code class="highlighter-rouge">store</code> directories. Stop all your running processes and build your Docker images before proceeding.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./mvnw verify -Pprod dockerfile:build
</code></pre></div></div>

<p><strong>NOTE:</strong> Building the gateway will likely fail because of <a href="https://github.com/jhipster/generator-jhipster/issues/7114">an issue with JavaScript tests</a>. To workaround this issue, skip the tests with <code class="highlighter-rouge">mvn package -Pprod -DskipTests dockerfile:build</code>.</p>

<p>While you’re waiting for things to build, edit <code class="highlighter-rouge">docker-compose/docker-compose.yml</code> and change the Spring Security settings from being hard-coded to being environment variables. Make this change for all applications and make sure to add the client ID and secret default settings don’t include those.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="s">SECURITY_OAUTH2_CLIENT_ACCESS_TOKEN_URI=${SECURITY_OAUTH2_CLIENT_ACCESS_TOKEN_URI}</span>
<span class="pi">-</span> <span class="s">SECURITY_OAUTH2_CLIENT_CLIENT_ID=${SECURITY_OAUTH2_CLIENT_CLIENT_ID}</span>
<span class="pi">-</span> <span class="s">SECURITY_OAUTH2_CLIENT_CLIENT_SECRET=${SECURITY_OAUTH2_CLIENT_CLIENT_SECRET}</span>
<span class="pi">-</span> <span class="s">SECURITY_OAUTH2_CLIENT_USER_AUTHORIZATION_URI=${SECURITY_OAUTH2_CLIENT_USER_AUTHORIZATION_URI}</span>
<span class="pi">-</span> <span class="s">SECURITY_OAUTH2_RESOURCE_USER_INFO_URI=${SECURITY_OAUTH2_RESOURCE_USER_INFO_URI}</span>
<span class="pi">-</span> <span class="s">SECURITY_OAUTH2_RESOURCE_TOKEN_INFO_URI=${SECURITY_OAUTH2_RESOURCE_TOKEN_INFO_URI}</span>
</code></pre></div></div>

<p><strong>TIP:</strong> You can run <code class="highlighter-rouge">docker-compose config</code> to verify the environment variables are correctly substituted.</p>

<p>When everything has finished building, run <code class="highlighter-rouge">docker-compose up -d</code> from the <code class="highlighter-rouge">docker-compose</code> directory. It can take a while to start all 14 containers, so now might be a good time to take a break, or go on a run. You can use Docker’s Kitematic to watch the status of your images as they start.</p>

<p><strong>TIP:</strong> Before you start everything, make sure you’ve provided adequate CPUs and Memory to Docker. It defaults to one CPU and 2 GB of memory. Not quite enough for 14 containers!</p>

<p><img src="/assets/blog/microservices-jhipster-oauth/kitematic-244f4ceacbc4061f764b2d90780636f46d7087030f9eca6012b7051fe7634ce5.png" alt="Kitematic" width="800" class="center-image" /></p>

<p>After you’ve verified everything works, you can stop all your Docker containers using the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker stop <span class="k">$(</span>docker ps <span class="nt">-a</span> <span class="nt">-q</span><span class="k">)</span>
</code></pre></div></div>

<p>If you’d like to remove the images too, you can run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker rm <span class="k">$(</span>docker ps <span class="nt">-a</span> <span class="nt">-q</span><span class="k">)</span>
</code></pre></div></div>

<h2 id="deploy-to-heroku">Deploy to Heroku</h2>

<p>The founder of JHipster, <a href="https://twitter.com/juliendubois">Julien Dubois</a>, wrote a blog post on the Heroku blog titled <a href="https://blog.heroku.com/bootstrapping_your_microservices_architecture_with_jhipster_and_spring">Bootstrapping Your Microservices Architecture with JHipster and Spring</a>. Here’s an abbreviated set of steps to deploy all your apps to Heroku.</p>

<h3 id="deploy-the-jhipster-registry">Deploy the JHipster Registry</h3>

<p>Heroku and JHipster have configured a JHipster Registry for you, so you just need to click on the button below to start your own JHipster Registry:</p>

<p><a href="https://dashboard.heroku.com/new?&amp;template=https%3A%2F%2Fgithub.com%2Fjhipster%2Fjhipster-registry"><img src="https://heroku-blog-files.s3.amazonaws.com/posts/1473343846-68747470733a2f2f7777772e6865726f6b7563646e2e636f6d2f6465706c6f792f627574746f6e2e706e67" alt="Deploy to Heroku" /></a></p>

<h3 id="deploy-your-gateway-and-apps">Deploy Your Gateway and Apps</h3>

<p>Edit <code class="highlighter-rouge">src/main/resources/config/application-prod.yml</code> in your gateway and apps. Remove <code class="highlighter-rouge">appname</code> and <code class="highlighter-rouge">instanceId</code> and add the following <code class="highlighter-rouge">eureka.instance</code> properties:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">eureka</span><span class="pi">:</span>
    <span class="na">instance</span><span class="pi">:</span>
        <span class="na">hostname</span><span class="pi">:</span> <span class="s">&lt;unique-prefix&gt;-&lt;app-name&gt;.herokuapp.com</span>
        <span class="na">non-secure-port</span><span class="pi">:</span> <span class="s">80</span>
        <span class="na">prefer-ip-address</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div>

<p>In the gateway, you’ll also need to specify the registry’s password in <code class="highlighter-rouge">src/main/resources/config/bootstrap-prod.yml</code>.</p>

<p>In each project, run <code class="highlighter-rouge">jhipster heroku</code> and answer the questions as follows:</p>

<table>
  <thead>
    <tr>
      <th>Question</th>
      <th>Answer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Name to deploy as?</td>
      <td><code class="highlighter-rouge">&lt;unique-prefix&gt;-&lt;app-name&gt;</code> (e.g., okta-gateway)</td>
    </tr>
    <tr>
      <td>Which region?</td>
      <td><code class="highlighter-rouge">us</code></td>
    </tr>
    <tr>
      <td>Type of deployment?</td>
      <td><code class="highlighter-rouge">Git</code></td>
    </tr>
    <tr>
      <td>JHipster Registry URL?</td>
      <td><code class="highlighter-rouge">https://user:pass@app.herokuapp.com/</code></td>
    </tr>
  </tbody>
</table>

<p>After each has deployed, you’ll want to run the following so they use Okta for authentication.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku config:set <span class="se">\</span>
  <span class="nv">SECURITY_OAUTH2_CLIENT_ACCESS_TOKEN_URI</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SECURITY_OAUTH2_CLIENT_ACCESS_TOKEN_URI</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nv">SECURITY_OAUTH2_CLIENT_USER_AUTHORIZATION_URI</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SECURITY_OAUTH2_CLIENT_USER_AUTHORIZATION_URI</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nv">SECURITY_OAUTH2_RESOURCE_USER_INFO_URI</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SECURITY_OAUTH2_RESOURCE_USER_INFO_URI</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nv">SECURITY_OAUTH2_RESOURCE_TOKEN_INFO_URI</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SECURITY_OAUTH2_RESOURCE_TOKEN_INFO_URI</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nv">SECURITY_OAUTH2_CLIENT_CLIENT_ID</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SECURITY_OAUTH2_CLIENT_CLIENT_ID</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nv">SECURITY_OAUTH2_CLIENT_CLIENT_SECRET</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SECURITY_OAUTH2_CLIENT_CLIENT_SECRET</span><span class="s2">"</span>
</code></pre></div></div>

<p>To set the JHipster Registry password on your gateway app, run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku config:set <span class="nv">JHIPSTER_REGISTRY_PASSWORD</span><span class="o">=</span><span class="s2">"</span><span class="nv">$JHIPSTER_REGISTRY_PASSWORD</span><span class="s2">"</span>
</code></pre></div></div>

<p>Then update your Okta app to have a <strong>Login redirect URI</strong> that matches your Heroku app (e.g., <code class="highlighter-rouge">https://okta-gateway.herokuapp.com/</code>). To do this, log in to your Okta account, go to <strong>Applications</strong> &gt; <strong>JHipster Microservices</strong> &gt; <strong>General</strong> &gt; <strong>Edit</strong>. You’ll also need to add this as a trusted origin in <strong>API</strong> &gt; <strong>Trusted Origins</strong> &gt; <strong>Add Origin</strong>.</p>

<p>If you chose Elasticsearch like I did, you’ll need to configure it to be in-memory and use <a href="http://stackoverflow.com/questions/12416738/how-to-use-herokus-ephemeral-filesystem">Heroku’s ephemeral filesystem</a>. Add the following Elasticsearch properties to <code class="highlighter-rouge">src/main/resources/config/application-heroku.yml</code> and redeploy your apps using <code class="highlighter-rouge">jhipster heroku</code>. You could also try adding and configuring Heroku’s <a href="https://elements.heroku.com/addons/searchbox">Searchbox Elasticsearch add-on</a>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring:
    data:
        elasticsearch:
            cluster-name:
            cluster-nodes:
            properties:
                path:
                    logs: target/elasticsearch/log
                    data: target/elasticsearch/data
</code></pre></div></div>

<p>To see if your apps have started correctly, you can run <code class="highlighter-rouge">heroku logs --tail</code> in each app’s directory. You may see a timeout error:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error R10 (Boot timeout) -&gt; Web process failed to bind to $PORT within 90 seconds of launch
</code></pre></div></div>

<p>If this happens, go to <a href="https://help.heroku.com/">https://help.heroku.com/</a> and click <strong>Create a ticket</strong> at the top. Click <strong>Running Applications</strong> &gt; <strong>Java</strong>, scroll to the bottom, and click <strong>Create a ticket</strong>. Enter something like the following for the subject and description, select one of your apps, then submit it.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Subject: JHipster Apps Startup Timeout

Description: Hello, I have three JHipster apps that have the following error on startup:

Error R10 (Boot timeout) -&gt; Web process failed to bind to $PORT within 90 seconds of launch

Their URLs are as follows:

* https://&lt;your-prefix&gt;-gateway.herokuapp.com/
* https://&lt;your-prefix&gt;-blog.herokuapp.com/
* https://&lt;your-prefix&gt;-store.herokuapp.com/

Can you please increase the timeouts on these apps?

Thanks!
</code></pre></div></div>

<p>Below are screenshots to prove everything worked after I got my timeouts increased. 😊</p>

<table>
  <tbody>
    <tr>
      <td><img src="/assets/blog/microservices-jhipster-oauth/heroku-welcome-fe193656c26bbce138bc35cd8d68716f8e4b1b3f2f888085b191139c73293842.png" alt="Gateway on Heroku" width="400" /></td>
      <td><img src="/assets/blog/microservices-jhipster-oauth/heroku-gateway-routes-126508a6a3b3536986ad791cd347056b4e8cbeb3712542fa286eed69bdd49dae.png" alt="Heroku Gateway Routes" width="400" /></td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td><img src="/assets/blog/microservices-jhipster-oauth/heroku-blog-4e2b7aedba56ae8660e31da97bf7dbc2893312da42004e88079374b500d0be27.png" alt="Blog on Heroku" width="400" /></td>
      <td><img src="/assets/blog/microservices-jhipster-oauth/heroku-store-aef8aeb4efb9e59e922fe222d68dfe7db0902e87acf9e57a99aa8b02a9bb8857.png" alt="Store on Heroku" width="400" /></td>
    </tr>
  </tbody>
</table>

<p>You can find the source code for this example at https://github.com/oktadeveloper/okta-jhipster-microservices-oauth-example.</p>

<h2 id="learn-more-about-microservices-oauth-20-and-jhipster">Learn More about Microservices, OAuth 2.0, and JHipster</h2>

<p>I hope you’ve enjoyed this whirlwind tour of how to create a microservices architecture with JHipster. Just because JHipster makes microservices easy doesn’t mean you should use them. In the wise words of <a href="https://martinfowler.com/articles/microservices.html">Martin Fowler</a> (March 2014):</p>

<blockquote>
  <p>“You shouldn’t start with a microservices architecture. Instead begin with a monolith, keep it modular, and split it into microservices once the monolith becomes a problem.”</p>
</blockquote>

<p>Using a microservices architecture is a great way to scale development teams. However, if you don’t have a large team, a <a href="https://m.signalvnoise.com/the-majestic-monolith-29166d022228">Majestic Monolith</a> might work better.</p>

<p>To learn more about microservices, authentication, and JHipster, see the following resources.</p>

<ul>
  <li><a href="/blog/2017/06/15/build-microservices-architecture-spring-boot">Build a Microservices Architecture for Microbrews with Spring Boot</a></li>
  <li><a href="/blog/2017/06/15/build-microservices-architecture-spring-boot">Secure a Spring Microservices Architecture with Spring Security, JWTs, Juiser, and Okta</a></li>
  <li><a href="/blog/2018/02/13/secure-spring-microservices-with-oauth">Secure a Spring Microservices Architecture with Spring Security and OAuth 2.0</a></li>
  <li><a href="/blog/2017/10/20/oidc-with-jhipster">Use OpenID Connect Support with JHipster</a></li>
  <li><a href="http://www.jhipster.tech/security/">JHipster Security Documentation</a></li>
</ul>

<p>If you have any feedback, I’d love to hear it! Please leave a comment below, hit me up on Twitter <a href="https://twitter.com/mraible">@mraible</a>, or post a question in our <a href="https://devforum.okta.com/">Developer Forums</a>.</p>



    </div>

    
    <div id="disqus">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_title = "Develop a Microservices Architecture with OAuth 2.0 and JHipster";
            var disqus_url = 'https://developer.okta.com/blog/2018/03/01/develop-microservices-jhipster-oauth';

            (function () {
                var dsq = document.createElement('script');
                dsq.async = true;
                dsq.type = 'text/javascript';
                dsq.src = '//oktadevblog.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>
              Please enable JavaScript to view the
              <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus</a>.
         </noscript>
    </div>
    
</article>

		
</section>

		
	</div>
	<footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">
                <a href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">
                    <div class="Logo">
                        <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    </div>
                    <p>Visit okta.com</p>
                </a>
            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">
                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate-with-okta/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/change-log/">Change Log</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notices</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="https://developer.okta.com/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="https://developer.okta.com/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="https://developer.okta.com/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-aa397c892d9083236c5cb20732dde679021b9236c8142ce78177b8b184567a02.js"></script>
    <script type="text/javascript" src="/assets/myOkta-911cbafbbe079b7a5522d9cbe15bd2a5f44e1582531e88393934bec69f97696b.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/blog-6e32dad27404131cc8630a5282264bed2ab4c08c91ac86fa496b75c53aa4f681.js"></script>
    

  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
