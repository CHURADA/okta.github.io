<!doctype html>
<!--[if lt IE 7 ]> <html class="ie6 no-flexbox"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7 no-flexbox"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8 no-flexbox"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9 no-flexbox"> <![endif]-->
<!--[if IE 10 ]>    <html class="ie10 no-flexbox"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!--> <html class="modern wf-loading" lang="en"> <!--<![endif]-->
  <head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager

      // Start Heap Analytics
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load("3356162945");
      // End Heap Analytics
    }
  </script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="Add Single Sign-on to Your Dropwizard Server in 15 Minutes  | Okta Developer">
  <meta class="swiftype" name="summary" data-type="string" content="This post will guide you through setting up an a new Dropwizard project and securing it with OAuth!" />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-914cad2dd6d069302444327ce911da52da68a3c68755f66cf5a4e92b9a38f3eb.css">
  
  
  <title>Add Single Sign-on to Your Dropwizard Server in 15 Minutes  | Okta Developer</title>
  <meta name="description" content="This post will guide you through setting up an a new Dropwizard project and securing it with OAuth!">
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#21313a">
  <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
</head>

  
    <body id="blog">
	




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first expanded">
          <a href="https://developer.okta.com/product/">Product</a>
          <ul class="menu">
            <li class="first leaf"><a href="https://developer.okta.com/product/">Overview</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authentication/">Authentication</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authorization/">Authorization</a></li>
            <li class="last leaf"><a href="https://developer.okta.com/product/user-management/">User Management</a></li>
          </ul>
        </li>
        <li class="leaf">
          <a href="https://developer.okta.com/pricing/">Pricing</a>
        </li>
        <li class="leaf">
          <a href="/blog/" class="active">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="last leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
            </g>
        </svg>
        <svg class="CloseIcon" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="ALl-Boards" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Desktop" transform="translate(-915.000000, -235.000000)" fill="#FFFFFF">
              <g id="Search-bar-Active" transform="translate(30.000000, 26.000000)">
                <polygon id="Icon/Cross" points="901 210.6 899.4 209 893 215.4 886.6 209 885 210.6 891.4 217 885 223.4 886.6 225 893 218.6 899.4 225 901 223.4 894.6 217"></polygon>
              </g>
            </g>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" rel="noopener noreferrer" href="https://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3Dhttps://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3D" class="Button--redOutline">Login</a>
        <a href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

	<div class="page-content">
		
		






<section class="Blog is-single">
		
	<div class="Blog-social">
		
		<a href="https://github.com/silas-b" target="_blank"><i class="fa fa-github"></i></a>
		
		
		
		
		<a href="https://www.linkedin.com/in/silas-brazil" target="_blank"><i class="fa fa-external-link"></i></a>
		
	</div>
	
	

<article class="BlogPost">

    <header class="BlogPost-header">

        <time class="BlogPost-date" datetime="2018-03-21">March 21, 2018</time>

        <h1 class="BlogPost-title">
            
            Add Single Sign-on to Your Dropwizard Server in 15 Minutes 
            
        </h1>

        <div class="BlogPost-attribution">
            
            <img src="/assets/avatar-silas-b-ac2053909daa981dc720a8b5ea7b2b39b71a7ae6e771f94a341be1ec0fad99e3.jpg" alt="avatar-silas-b.jpg" class="BlogPost-avatar">
            
            <span class="BlogPost-author">Silas Brazil</span>
        </div>

    </header>

    <div class="BlogPost-content">
        
	<p>Dropwizard is recognized as the pioneer in turn-key Java API frameworks, and rivals Spring Boot for ease of adoption. Whether you’re interested in trying it out for the first time, or already have a mature platform built on top of Dropwizard, you can add secure authentication to your site in a matter of minutes. By combining Dropwizard’s production-ready essential libraries and Okta’s identity platform, you can construct a fully secured internet-facing web service with little effort. Read on to see how!</p>

<p>This tutorial assumes familiarity with Java, Maven, and basic web service and web security concepts. The first section sets up a new Dropwizard server from scratch, so if you already have one up and running, feel free to skip ahead and integrate With Okta]. You can also find the completed code example on <a href="https://github.com/oktadeveloper/okta-dropwizard-oauth-example">GitHub</a>.</p>

<h2 id="dropwizard-vs-spring-boot">Dropwizard vs. Spring Boot</h2>

<p>A number of excellent articles and blog posts (notably <a href="https://blog.takipi.com/java-bootstrap-dropwizard-vs-spring-boot/">Takipi</a> and <a href="https://www.schibsted.pl/blog/spring-boot-and-dropwizard-in-microservices-development/">Schibsted</a>) provide thorough comparisons of the two frameworks on both a feature-set level and from an architectural perspective. While Spring Boot has been eclipsing Dropwizard lately in popularity, Dropwizard still provides a compelling out-of-the-box distribution.</p>

<p>Most of the differences boil down to what is included by default vs. offered as an add-on library. With no other setup needed, Dropwizard gives you exhaustive API metrics, logging, and a handful of useful libraries and tools such as Jackson, Liquibase, Hibernate, and a few page-templating frameworks. Spring Boot requires that you specify most of these extras, which adds a little more thought, planning, and effort to new server creation. The benefit, however, is greater flexibility and a wider variety of options (such as multiple HTTP server alternatives and less coupling to specific libraries).</p>

<p>Both frameworks provide a well-integrated, mature, production-ready insta-server, and the choice between the two usually falls according to preference of one system’s libraries over the other. If you need the Swiss Army knife, or prefer to leave more options open, Spring Boot may be the way to go. If you’re a fan of Jetty, Hibernate, Jersey, et al. and just want to start coding immediately, Dropwizard is hard to beat.</p>

<h2 id="generate-a-new-dropwizard-server">Generate a New Dropwizard Server</h2>

<p>First things first, you’ll need a running server. The Dropwizard Maven archetype is a convenient way to create a new project. You can execute the following command to start in interactive mode:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn archetype:generate \
    -DarchetypeGroupId=io.dropwizard.archetypes \
    -DarchetypeArtifactId=java-simple
</code></pre></div></div>

<p>When prompted for various project names, this example used <strong>com.example</strong> for the <code class="highlighter-rouge">groupId</code>, <strong>demo</strong> for <code class="highlighter-rouge">artifactId</code>, and <strong>Demo</strong> for the <code class="highlighter-rouge">name</code>. The rest were given default values.</p>

<p><img src="/assets/blog/dropwizard-oauth/maven-archetype-bb12f64c4880b4493594009eb123d25cfffdaf64e598a40cfcdbc886b6ccf70f.png" alt="Maven archetype output" width="800" class="center-image" /></p>

<p>Almost like a TODO list, Dropwizard outlines the fundamental components of your server by creating a bunch of empty directories. Most of those can be left alone for now.</p>

<p><img src="/assets/blog/dropwizard-oauth/project-tree-a79ca1b2cbc30f470d068fb44ec2b7a51abe4236593a10b6a305848cdf2ad250.png" alt="Directory structure" width="800" class="center-image" /></p>

<p>To start penciling in the new server, create a <code class="highlighter-rouge">HomePageResource.java</code> class in the <code class="highlighter-rouge">com.example.resources</code> package. This will serve as the “Hello world” entry point for testing, and can be enhanced later on with one of Dropwizard’s built-in HTML templating libraries. Two key annotations are needed: one <code class="highlighter-rouge">@Path("/")</code> annotation at the class level, indicating that this resource will handle requests to your server’s root URI, and one JAX-RS <code class="highlighter-rouge">@GET</code> annotation applied to a simple function that returns a test string.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomePageResource</span> <span class="o">{</span>
    <span class="nd">@GET</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">handleGetRequest</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">"Hello from Dropwizard!"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now back in <code class="highlighter-rouge">com.example.DemoApplication</code>, register this new resource with Jersey in the provided <code class="highlighter-rouge">run()</code> method:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">DemoConfiguration</span> <span class="n">configuration</span><span class="o">,</span>
                <span class="kd">final</span> <span class="n">Environment</span> <span class="n">environment</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">environment</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">HomePageResource</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p>With that, it’s time to give the server a quick run and make sure all is working as expected. The following two commands will build and start the server on its default port of 8080:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn package
java -jar target/demo-1.0-SNAPSHOT.jar server
</code></pre></div></div>

<p>Once it’s running, visiting <code class="highlighter-rouge">http://localhost:8080</code> in your browser should relay your Hello world message:</p>

<p><img src="/assets/blog/dropwizard-oauth/hello-world-016d34e2f54236e846d76b232996f14c531594b2ea22ee7910f86e3715216ba4.png" alt="Basic hello world response" width="800" class="center-image" /></p>

<p>Before getting too fancy with the UI, now is a great opportunity to enable single sign-on for your server. The next section will walk you through the process!</p>

<h2 id="integrate-with-okta-for-oauth-20">Integrate With Okta for OAuth 2.0</h2>

<p>Since one of Dropwizard’s goals is to make it easy to create RESTful applications, it provides support for creating OAuth 2.0 Resource Server. However, the actual implementation is just a stub and requires you to implement the actual handling of the access token. Okta has created an access token validation library (okta-jwt-verifier) to make it easy to plug this logic into any application.</p>

<h3 id="create-an-okta-account-and-gather-credentials">Create an Okta Account and Gather Credentials</h3>

<p>If you don’t already have a free Okta account, you can follow <a href="/blog/2017/10/27/secure-spa-spring-boot-oauth#get-your-oauth-info-ready">these instructions</a> to create one and set up your first Okta application. There are four important values you will want to take note of:</p>

<ul>
  <li>Client ID - e.g.: <strong><em>oot9wrjjararhfaa</em></strong></li>
  <li>Client secret - e.g.: <strong><em>(Your Client Secret)</em></strong></li>
  <li>Issuer - e.g.: <strong><em>https://dev-123123.oktapreview.com/oauth2/default</em></strong> …be sure to include the <strong><em>/oauth2/default</em></strong> path!</li>
  <li>Login redirect URI - this will be <strong><em>http://localhost:8080/login</em></strong> if you followed the instructions above.</li>
</ul>

<h3 id="use-dropwizard-configuration-to-store-your-oauth-settings">Use Dropwizard Configuration to Store Your OAuth Settings</h3>

<p>Dropwizard’s configuration mechanism is quite easy to work with. All that’s needed is a YAML file with some config values defined, and a matching POJO to access the values at runtime (in this case, that POJO is the <code class="highlighter-rouge">DemoConfiguration</code> class). You should already have a <code class="highlighter-rouge">config.yml</code> in the root of the example directory. Create a new <code class="highlighter-rouge">oktaOAuth</code> section and add your OAuth connection details as follows:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">oktaOAuth</span><span class="pi">:</span>
  <span class="na">baseUrl</span><span class="pi">:</span> <span class="s"><span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span></span>
  <span class="na">issuer</span><span class="pi">:</span> <span class="s2">"</span><span class="s"><span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default"</span>
  <span class="na">clientId</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{yourClientId}"</span>
  <span class="na">audience</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{yourAudience}"</span>  <span class="c1"># defaults to ‘api://default’</span>
</code></pre></div></div>

<p>To cut down on boilerplate, this example just adds these fields as publicly accessible members. You may prefer adding getters and setters, or even using <a href="ttps://projectlombok.org">Lombok</a> to do that for you.</p>

<p>Create a new class <code class="highlighter-rouge">com.example.models.OktaOAuthConfig</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OktaOAuthConfig</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">baseUrl</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">clientId</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">issuer</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">audience</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now add our new model to the <code class="highlighter-rouge">com.example.DemoConfiguration</code> class..</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoConfiguration</span> <span class="kd">extends</span> <span class="n">Configuration</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">OktaOAuthConfig</span> <span class="n">oktaOAuth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OktaOAuthConfig</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now these config values can be easily retrieved in the <code class="highlighter-rouge">DemoApplication</code> class via its inherited <code class="highlighter-rouge">configuration</code> member.</p>

<h3 id="handle-the-oauth-20-access-token">Handle the OAuth 2.0 Access Token</h3>

<p>As I mentioned above Dropwizard’s OAuth support still requires you to handle the access token yourself. No worries though, you can do that in a few lines of code with the Okta JWT Verifier.</p>

<p>First up, add the <code class="highlighter-rouge">dropwizard-auth</code> and <code class="highlighter-rouge">okta-jwt-verifier</code> dependencies to your <code class="highlighter-rouge">pom.xml</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.dropwizard<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>dropwizard-auth<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.okta.jwt<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>okta-jwt-verifier<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.3.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h4 id="create-a-principal-implementation">Create a Principal Implementation</h4>

<p>Next up, I need to create a class to hold the user’s information.  Dropwizard expects class to implement <code class="highlighter-rouge">java.security.Principal</code>. Create a new class <code class="highlighter-rouge">com.example.auth.AccessTokenPrincipal</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccessTokenPrincipal</span> <span class="kd">implements</span> <span class="n">Principal</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Jwt</span> <span class="n">accessToken</span><span class="o">;</span>

    <span class="n">AccessTokenPrincipal</span><span class="o">(</span><span class="n">Jwt</span> <span class="n">accessToken</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">accessToken</span> <span class="o">=</span> <span class="n">accessToken</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// the 'sub' claim in the access token will be the email address</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">accessToken</span><span class="o">.</span><span class="na">getClaims</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"sub"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The above class basically just wraps an <code class="highlighter-rouge">com.okta.jwt.Jwt</code> and exposes it as a <code class="highlighter-rouge">Principal</code> and uses the email address in the <code class="highlighter-rouge">sub</code> claim for the name.</p>

<h4 id="dropwizard-authentication">Dropwizard Authentication</h4>

<p>So far so good, next, create a new class <code class="highlighter-rouge">com.example.auth.OktaOAuthAuthenticator</code>.  This is where the magic happens!  This class will implement <code class="highlighter-rouge">io.dropwizard.auth.Authenticator</code> and validate the access token:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OktaOAuthAuthenticator</span> <span class="kd">implements</span> <span class="n">Authenticator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AccessTokenPrincipal</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">JwtVerifier</span> <span class="n">jwtVerifier</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">OktaOAuthAuthenticator</span><span class="o">(</span><span class="n">JwtVerifier</span> <span class="n">jwtVerifier</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jwtVerifier</span> <span class="o">=</span> <span class="n">jwtVerifier</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">AccessTokenPrincipal</span><span class="o">&gt;</span> <span class="nf">authenticate</span><span class="o">(</span><span class="n">String</span> <span class="n">accessToken</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">AuthenticationException</span> <span class="o">{</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Jwt</span> <span class="n">jwt</span> <span class="o">=</span> <span class="n">jwtVerifier</span><span class="o">.</span><span class="na">decodeAccessToken</span><span class="o">(</span><span class="n">accessToken</span><span class="o">);</span>
            <span class="c1">// if we made it this far we have a valid jwt</span>
            <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="k">new</span> <span class="n">AccessTokenPrincipal</span><span class="o">(</span><span class="n">jwt</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JoseException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">AuthenticationException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>That is it, basically two lines of code, one to validate the token another to return our custom principal type!</p>

<h4 id="wire-it-up">Wire it up!</h4>

<p>The last step is to wire this all up in our application class, edit <code class="highlighter-rouge">DemoApplication</code> and create a new method <code class="highlighter-rouge">configureOAuth()</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">configureOAuth</span><span class="o">(</span><span class="kd">final</span> <span class="n">DemoConfiguration</span> <span class="n">configuration</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Environment</span> <span class="n">environment</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">OktaOAuthConfig</span> <span class="n">widgetConfig</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="na">oktaOAuth</span><span class="o">;</span>
        <span class="c1">// Configure the JWT Validator, it will validate Okta's JWT access tokens</span>
        <span class="n">JwtHelper</span> <span class="n">helper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JwtHelper</span><span class="o">()</span>
                <span class="o">.</span><span class="na">setIssuerUrl</span><span class="o">(</span><span class="n">widgetConfig</span><span class="o">.</span><span class="na">issuer</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setClientId</span><span class="o">(</span><span class="n">widgetConfig</span><span class="o">.</span><span class="na">clientId</span><span class="o">);</span>

        <span class="c1">// set the audience only if set, otherwise the default is: api://default</span>
        <span class="n">String</span> <span class="n">audience</span> <span class="o">=</span> <span class="n">widgetConfig</span><span class="o">.</span><span class="na">audience</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">audience</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">helper</span><span class="o">.</span><span class="na">setAudience</span><span class="o">(</span><span class="n">audience</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// register the OktaOAuthAuthenticator</span>
        <span class="n">environment</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">AuthDynamicFeature</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">OAuthCredentialAuthFilter</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">AccessTokenPrincipal</span><span class="o">&gt;()</span>
                <span class="o">.</span><span class="na">setAuthenticator</span><span class="o">(</span><span class="k">new</span> <span class="n">OktaOAuthAuthenticator</span><span class="o">(</span><span class="n">helper</span><span class="o">.</span><span class="na">build</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="s">"Bearer"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">buildAuthFilter</span><span class="o">()));</span>

        <span class="c1">// Bind our custom principal to the @Auth annotation</span>
        <span class="n">environment</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">AuthValueFactoryProvider</span><span class="o">.</span><span class="na">Binder</span><span class="o">&lt;&gt;(</span><span class="n">AccessTokenPrincipal</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"Failed to configure JwtVerifier"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This method does a couple things: creates a <code class="highlighter-rouge">JwtVerifier</code> based on the properties in our configuration file, registers the new <code class="highlighter-rouge">OktaOAuthAuthenticator</code> class, and finally binds the <code class="highlighter-rouge">@Auth</code> annotation to our new <code class="highlighter-rouge">AccessTokenPrincipal</code> class.</p>

<p>Don’t forget to update the <code class="highlighter-rouge">run()</code> method with a call to our new <code class="highlighter-rouge">configureOAuth()</code> method.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">DemoConfiguration</span> <span class="n">configuration</span><span class="o">,</span>
                <span class="kd">final</span> <span class="n">Environment</span> <span class="n">environment</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// configure OAuth</span>
    <span class="n">configureOAuth</span><span class="o">(</span><span class="n">configuration</span><span class="o">,</span> <span class="n">environment</span><span class="o">);</span>

    <span class="c1">// add resources</span>
    <span class="n">environment</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">HomePageResource</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Finally, update the <code class="highlighter-rouge">HomePageResource</code> to require authentication and add bit more personalization using the <code class="highlighter-rouge">@Auth</code> annotation.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomePageResource</span> <span class="o">{</span>

    <span class="nd">@GET</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">handleGetRequest</span><span class="o">(</span><span class="nd">@Auth</span> <span class="n">AccessTokenPrincipal</span> <span class="n">tokenPrincipal</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Hello! We'll be contacting you at: "</span> <span class="o">+</span> <span class="n">tokenPrincipal</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>You could restart the server and start handling requests!  But… you of course need to get an access token from some place. If you were handling class from another OAuth capable application you could stop here. However, since this is an example I’m going to add simple login page using the Okta Sign-In Widget.</p>

<h3 id="add-the-okta-sign-in-widget">Add the Okta Sign-In Widget</h3>

<p>Adding a login page to our RESTful application does mix concerns a little.  I’m going to do this to simplify the example and at the same time show you a few more cool things with Dropwizard.</p>

<h4 id="expose-the-oauth-configuration-via-rest">Expose the OAuth Configuration via REST</h4>

<p>Since there is nothing secret in our OAuth configuration (access tokens to not require a <em>client secret</em> to be validated) we can expose our <code class="highlighter-rouge">OktaOAuthConfig</code> with a new JAX-RS resource.  Create a new class <code class="highlighter-rouge">com.example.resources.LoginWidgetConfigResource</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/signInConfig"</span><span class="o">)</span>
<span class="nd">@Produces</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginWidgetConfigResource</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">OktaOAuthConfig</span> <span class="n">config</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">LoginWidgetConfigResource</span><span class="o">(</span><span class="n">OktaOAuthConfig</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GET</span>
    <span class="kd">public</span> <span class="n">OktaOAuthConfig</span> <span class="nf">getConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">config</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Pretty simple, it’s just a getter with a <code class="highlighter-rouge">@GET</code> annotation!</p>

<p>Back in our <code class="highlighter-rouge">DemoApplication</code> class you need to register the new resource in the <code class="highlighter-rouge">run</code> method:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">environment</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">LoginWidgetConfigResource</span><span class="o">(</span><span class="n">configuration</span><span class="o">.</span><span class="na">oktaOAuth</span><span class="o">));</span>
</code></pre></div></div>

<h4 id="add-a-login-page">Add a Login Page</h4>

<p>Before creating a login page I need to configure Dropwizard to serve static assets using the concept of an <code class="highlighter-rouge">AssetsBundle</code>, this will require another dependency in your <code class="highlighter-rouge">pom.xml</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.dropwizard<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>dropwizard-assets<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>In your <code class="highlighter-rouge">DemoApplicaiton</code> class you can register this bundle in the <code class="highlighter-rouge">initialize</code> method:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="kd">final</span> <span class="n">Bootstrap</span><span class="o">&lt;</span><span class="n">DemoConfiguration</span><span class="o">&gt;</span> <span class="n">bootstrap</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">bootstrap</span><span class="o">.</span><span class="na">addBundle</span><span class="o">(</span><span class="k">new</span> <span class="n">AssetsBundle</span><span class="o">(</span><span class="s">"/assets/"</span><span class="o">,</span> <span class="s">"/"</span><span class="o">,</span> <span class="s">"index.html"</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This configures the application to serve all of the files in <code class="highlighter-rouge">src/main/resources/assets</code> at the root (<code class="highlighter-rouge">/</code>) of your application.  It also defines <code class="highlighter-rouge">index.html</code> as the default welcome file.</p>

<p>This creates a small issue.  If you restart your application now it would throw an exception.  Both our static assets and our resources are being service from the root context.  The easy fix is to serve your API resources at <code class="highlighter-rouge">/api/*</code> with a single line in your application’s <code class="highlighter-rouge">run</code> method, the whole method should now look like:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">DemoConfiguration</span> <span class="n">configuration</span><span class="o">,</span>
                <span class="kd">final</span> <span class="n">Environment</span> <span class="n">environment</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// base url for our resources</span>
    <span class="n">environment</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">setUrlPattern</span><span class="o">(</span><span class="s">"/api/*"</span><span class="o">);</span>

    <span class="c1">// configure OAuth</span>
    <span class="n">configureOAuth</span><span class="o">(</span><span class="n">configuration</span><span class="o">,</span> <span class="n">environment</span><span class="o">);</span>

    <span class="c1">// add resources</span>
    <span class="n">environment</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">HomePageResource</span><span class="o">());</span>
    <span class="n">environment</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">LoginWidgetConfigResource</span><span class="o">(</span><span class="n">configuration</span><span class="o">.</span><span class="na">oktaOAuth</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The only thing left to do create a login page.  I’m actually going to create a simple SPA app with a single <code class="highlighter-rouge">index.html</code> file.  This page will load the widget configuration from <code class="highlighter-rouge">/api/signInConfig</code>, prompt the user to login, and then display the results from a call to <code class="highlighter-rouge">/api/message</code>.  I’m not going to dig into the contents of the HTML, if you are interested you should be able to follow the comments.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1, shrink-to-fit=no"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Dropwizard OAuth 2.0 Example<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;base</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.6.0/js/okta-sign-in.min.js"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.6.0/css/okta-sign-in.min.css"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.6.0/css/okta-theme.css"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;!-- Render the login widget here --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"okta-login-container"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Render the REST response here --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"api-message"</span><span class="nt">&gt;&lt;/div&gt;</span>

    <span class="c">&lt;!-- And a logout button, hidden by default --&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"logout"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-danger"</span> <span class="na">style=</span><span class="s">"display:none"</span><span class="nt">&gt;</span>Logout<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="s2">"/api/signInConfig"</span><span class="p">,</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// we are priming our config object with data retrieved from the server in order to make this example easier to run</span>
      <span class="c1">// You could statically define your config like if you wanted too:</span>
      <span class="cm">/*
      let config = {
        baseUrl: 'https://dev-123456.oktapreview.com',
        clientId: '00icu81200icu812w0h7',
        redirectUri: 'http://localhost:8080',
        authParams: {
          issuer: 'https://dev-123456.oktapreview.com/oauth2/default',
          responseType: ['id_token', 'token']
        }
      }; */</span>

      <span class="nb">window</span><span class="p">.</span><span class="nx">oktaSignIn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OktaSignIn</span><span class="p">({</span>
        <span class="na">baseUrl</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">baseUrl</span><span class="p">,</span>
        <span class="na">clientId</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">clientId</span><span class="p">,</span>
        <span class="na">redirectUri</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
        <span class="na">authParams</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">issuer</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">issuer</span><span class="p">,</span>
          <span class="na">responseType</span><span class="p">:</span> <span class="p">[</span><span class="s1">'id_token'</span><span class="p">,</span> <span class="s1">'token'</span><span class="p">],</span>
          <span class="na">scopes</span><span class="p">:</span> <span class="p">[</span><span class="s2">"openid"</span><span class="p">,</span> <span class="s2">"profile"</span><span class="p">,</span> <span class="s2">"email"</span><span class="p">]</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="c1">// handle the rest of the page</span>
      <span class="nx">doInit</span><span class="p">();</span>
    <span class="p">});</span>

  <span class="cm">/**
   * Makes a request to a REST resource and displays a simple message to the page.
   * @param accessToken The access token used for the auth header
   */</span>
  <span class="kd">function</span> <span class="nx">renderApiMessage</span><span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// include the Bearer token in the request</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="s2">"/api/message"</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'Authorization'</span><span class="p">:</span> <span class="s2">"Bearer "</span> <span class="o">+</span> <span class="nx">accessToken</span>
      <span class="p">},</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Render the message of the day</span>
      <span class="kd">let</span> <span class="nx">htmlToRender</span> <span class="o">=</span> <span class="s2">`
            &lt;h1&gt;Message:
              &lt;small&gt;/api/message&lt;/small&gt;
            &lt;/h1&gt;
            &lt;p&gt;</span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">&lt;/p&gt;`</span><span class="p">;</span>

      <span class="nx">$</span><span class="p">(</span><span class="s1">'#api-message'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">htmlToRender</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// handle any errors</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">'#api-message'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">"ERROR, check your browsers console log!"</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"ERROR!!"</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">// show the logout button</span>
    <span class="nx">$</span><span class="p">(</span> <span class="s2">"#logout"</span> <span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">'block'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">doInit</span><span class="p">()</span> <span class="p">{</span>

    <span class="nx">$</span><span class="p">(</span> <span class="s2">"#logout"</span> <span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">signOut</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
        <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">});</span>

    <span class="c1">// Check if we already have an access token</span>
    <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">tokenManager</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'my_access_token'</span><span class="p">);</span>

    <span class="c1">// if we do great, just go with it!</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">renderApiMessage</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

      <span class="c1">// otherwise show the login widget</span>
      <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">renderEl</span><span class="p">(</span>
        <span class="p">{</span><span class="na">el</span><span class="p">:</span> <span class="s1">'#okta-login-container'</span><span class="p">},</span>
        <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

          <span class="c1">// check if success</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">'SUCCESS'</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// for our example we have the id token and the access token</span>
            <span class="c1">// oktaSignIn.tokenManager.add('my_id_token', response[0]);</span>
            <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'my_access_token'</span><span class="p">,</span> <span class="nx">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

            <span class="c1">// hide the widget</span>
            <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>

            <span class="c1">// now for the fun part!</span>
            <span class="nx">renderApiMessage</span><span class="p">(</span><span class="nx">response</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">accessToken</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// handle any errors</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Whew! You’ve emerged from the jungle of hand-rolled OIDC clients, and now have authorization in your Dropwizard server! There were quite a few code examples above, so if you need to verify anything you built along the way, you can always access the <a href="https://github.com/oktadeveloper/okta-dropwizard-oauth-example">complete source for this project</a> on GitHub.</p>

<p>Ok… time to see it in action! You can once again build the project with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean package
</code></pre></div></div>

<p>…but this time, you’ll also need to specify the location of the <code class="highlighter-rouge">config.yml</code> as a command line argument when starting the server. It needs to include the path relative to the current working directory:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-jar</span> target/demo-1.0-SNAPSHOT.jar server config.yml
</code></pre></div></div>

<p>Visiting <code class="highlighter-rouge">http:/localhost:8080</code> in your browser should now redirect you to sign in on Okta’s domain, and following that, should present a message with your email address. If so, congratulations! If you’ve had difficulty at any point along the way, try running the <a href="https://github.com/oktadeveloper/okta-dropwizard-oauth-example">example</a> as is.</p>

<p><img src="/assets/blog/dropwizard-oauth/spa-message-success-ae818d973152cdd869c462cecdd6969bca0d6cc34b110bf0178bd42ef2105b37.png" alt="Post login message showing API response" width="800" class="center-image" /></p>

<h2 id="extra-credit-health-checks">Extra Credit: Health Checks</h2>

<p>You probably have noticed the console warnings when starting your application:</p>

<pre><code class="language-txt">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!    THIS APPLICATION HAS NO HEALTHCHECKS. THIS MEANS YOU WILL NEVER KNOW      !
!     IF IT DIES IN PRODUCTION, WHICH MEANS YOU WILL NEVER KNOW IF YOU'RE      !
!    LETTING YOUR USERS DOWN. YOU SHOULD ADD A HEALTHCHECK FOR EACH OF YOUR    !
!         APPLICATION'S DEPENDENCIES WHICH FULLY (BUT LIGHTLY) TESTS IT.       !
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</code></pre>

<p>Dropwizard makes it really easy to add existing health checks or create your own. I’ll leave that as an exercise for you!</p>

<h2 id="learn-more">Learn More</h2>

<p>In this post I’ve created a self contained Dropwizard application with a couple JAX-RS resources and a simple HTML page. Take a look at Dropwizard’s getting started guide or these resources for more info.</p>

<ul>
  <li><a href="http://www.dropwizard.io/">Dropwizard Homepage</a></li>
  <li><a href="/blog/2017/08/09/jax-rs-vs-spring-rest-endpoints">Let’s Compare: JAX-RS vs Spring for REST Endpoints</a></li>
  <li><a href="/blog/2017/06/21/what-the-heck-is-oauth">What the Heck is OAuth?</a></li>
</ul>

<p>We hope you’ve enjoyed this post, and are always eager to hear from you. Leave a comment below, or hit us up on Twitter <a href="https://twitter.com/oktadev">@oktadev</a>!</p>


    </div>

    
    <div id="disqus">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_title = "Add Single Sign-on to Your Dropwizard Server in 15 Minutes ";
            var disqus_url = 'https://developer.okta.com/blog/2018/03/21/dropwizard-oauth';

            (function () {
                var dsq = document.createElement('script');
                dsq.async = true;
                dsq.type = 'text/javascript';
                dsq.src = '//oktadevblog.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>
              Please enable JavaScript to view the
              <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus</a>.
         </noscript>
    </div>
    
</article>

		
</section>

		
	</div>
	<footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">
                <a href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">
                    <div class="Logo">
                        <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    </div>
                    <p>Visit okta.com</p>
                </a>
            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">
                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate-with-okta/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/change-log/">Change Log</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notices</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="https://developer.okta.com/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="https://developer.okta.com/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="https://developer.okta.com/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-aa397c892d9083236c5cb20732dde679021b9236c8142ce78177b8b184567a02.js"></script>
    <script type="text/javascript" src="/assets/myOkta-911cbafbbe079b7a5522d9cbe15bd2a5f44e1582531e88393934bec69f97696b.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/blog-6e32dad27404131cc8630a5282264bed2ab4c08c91ac86fa496b75c53aa4f681.js"></script>
    

  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
