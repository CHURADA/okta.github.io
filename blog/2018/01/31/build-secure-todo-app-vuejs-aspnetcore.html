<!doctype html>
<!--[if lt IE 7 ]> <html class="ie6 no-flexbox"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7 no-flexbox"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8 no-flexbox"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9 no-flexbox"> <![endif]-->
<!--[if IE 10 ]>    <html class="ie10 no-flexbox"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!--> <html class="modern wf-loading" lang="en"> <!--<![endif]-->
  <head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager
    }
  </script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="Build a Secure To-Do App with Vue, ASP.NET Core, and Okta | Okta Developer">
  <meta class="swiftype" name="summary" data-type="string" content="I love lists. I keep everything I need to do (t..." />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-c091452949c4482c10ed8588a1694c9d5a4abaf6be7a029294a28a91489036aa.css">
  
  
  <title>Build a Secure To-Do App with Vue, ASP.NET Core, and Okta | Okta Developer</title>
  <meta name="description" content="I love lists. I keep everything I need to do (t...">
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#21313a">
  <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
</head>

  
    <body id="blog">
	




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first expanded">
          <a href="https://developer.okta.com/product/">Product</a>
          <ul class="menu">
            <li class="first leaf"><a href="https://developer.okta.com/product/">Overview</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authentication/">Authentication</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authorization/">Authorization</a></li>
            <li class="last leaf"><a href="https://developer.okta.com/product/user-management/">User Management</a></li>
          </ul>
        </li>
        <li class="leaf">
          <a href="https://developer.okta.com/pricing/">Pricing</a>
        </li>
        <li class="leaf">
          <a href="/blog/" class="active">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="last leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
            </g>
        </svg>
        <svg class="CloseIcon" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="ALl-Boards" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Desktop" transform="translate(-915.000000, -235.000000)" fill="#FFFFFF">
              <g id="Search-bar-Active" transform="translate(30.000000, 26.000000)">
                <polygon id="Icon/Cross" points="901 210.6 899.4 209 893 215.4 886.6 209 885 210.6 891.4 217 885 223.4 886.6 225 893 218.6 899.4 225 901 223.4 894.6 217"></polygon>
              </g>
            </g>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" rel="noopener noreferrer" href="https://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3Dhttps://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3D" class="Button--redOutline">Login</a>
        <a href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

	<div class="page-content">
		






<section class="Blog is-single">
		
	<div class="Blog-social">
		
		<a href="https://github.com/nbarbettini" target="_blank"><i class="fa fa-github"></i></a>
		
		
		<a href="https://twitter.com/nbarbettini" target="_blank"><i class="fa fa-twitter"></i></a>
		
		
		
		<a href="https://www.recaffeinate.co" target="_blank"><i class="fa fa-external-link"></i></a>
		
	</div>
	
	

<article class="BlogPost">

    <header class="BlogPost-header">

        <time class="BlogPost-date" datetime="2018-01-31">January 31, 2018</time>

        <h1 class="BlogPost-title">
            
            Build a Secure To-Do App with Vue, ASP.NET Core, and Okta
            
        </h1>

        <div class="BlogPost-attribution">
            
            <img src="/assets/avatar-nbarbettini-04840721946d0ed1aac5fdec3b87212e7d2656ec4482ba24df3a21d8306de85b.jpg" alt="avatar-nbarbettini.jpg" class="BlogPost-avatar">
            
            <span class="BlogPost-author">Nate Barbettini</span>
        </div>

    </header>

    <div class="BlogPost-content">
        
	<p>I love lists. I keep everything I need to do (too many things, usually) in a big to-do list, and the list helps keep me sane throughout the day. It’s like having a second brain!</p>

<p>There are hundreds of to-do apps out there, but today I’ll show you how to build your own from scratch. Why? It’s the perfect exercise for learning a new language or framework! A to-do app is more complex than “Hello World”, but simple enough to build in an afternoon or on the weekend. Building a simple app is a great way to stretch your legs and try a language or framework you haven’t used before.</p>

<h2 id="why-vuejs-and-aspnet-core">Why Vue.js and ASP.NET Core?</h2>
<p>In this article, I’ll show you how to build a lightweight, secure to-do app with a Vue.js frontend and an ASP.NET Core backend. Not familiar with these frameworks? That’s fine! You’ll learn everything as you go. Here’s a short introduction to both:</p>

<p><a href="https://vuejs.org">Vue.js</a> is a JavaScript framework for building applications that run in the browser. It borrows some good ideas from both Angular and React, and has been gaining popularity recently. I like Vue because it’s easy to pick up and get started. Compared to both Angular and React, the learning curve doesn’t feel as steep. Plus, it has great documentation! For this tutorial, I’ve borrowed from Matt Raible’s excellent article <a href="https://developer.okta.com/blog/2017/09/14/lazy-developers-guide-to-auth-with-vue">The Lazy Developer’s Guide to Authentication with Vue.js</a>.</p>

<p><a href="https://docs.microsoft.com/en-us/aspnet/core/">ASP.NET Core</a> is Microsoft’s new open-source framework for building web apps and APIs. I like ASP.NET Core on the backend because it’s type-safe, super fast, and has a large ecosystem of packages available. If you want to learn the basics, I wrote a <a href="http://littleasp.net/book">free ebook</a> about version 2.0, which was released earlier this year.</p>

<p>Ready to build an app? Let’s get started!</p>

<h2 id="install-the-tools">Install the tools</h2>
<p>You’ll need Node and npm installed for this tutorial, which you can install from the <a href="https://nodejs.org">Node.js official site</a>.</p>

<p>You’ll also need <code class="highlighter-rouge">dotnet</code> installed, which you can install from the <a href="https://dot.net/core">Microsoft .NET site</a>.</p>

<p>To double check that everything is installed correctly, run these commands in your terminal or shell:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nt">-v</span>

dotnet <span class="nt">--version</span>
</code></pre></div></div>

<p><img src="/assets/blog/build-secure-todo-app-vuejs-aspnetcore/check-versions-5342204f15988d8eb213dbce1e47c59b626d533c82a70d87082bf0e4555e4949.gif" alt="Check tool versions in the terminal" width="900" class="center-image" /></p>

<p>I’m using <a href="https://code.visualstudio.com/">Visual Studio Code</a> for this project, but you can use whatever code editor you feel comfortable in. If you’re on Windows, you can also use Visual Studio 2017 or later.</p>

<h2 id="set-up-the-project">Set up the project</h2>
<p>Instead of starting from absolute zero, you can use a template to help you scaffold a basic, working application. Mark Pieszak has an excellent <a href="https://github.com/MarkPieszak/aspnetcore-Vue-starter">ASP.NET Core Vue SPA starter kit</a>, which we’ll use as a starting point.</p>

<p>Download or clone the project from GitHub, and then open the folder in your code editor.</p>

<p><img src="/assets/blog/build-secure-todo-app-vuejs-aspnetcore/project-b0536b5b22b43ab5094e01234286ab796f7c8af5360bf9e71c3f6b0b1f8aa3f2.png" alt="Initial project structure" width="300" class="center-image" /></p>

<p>Run <code class="highlighter-rouge">npm install</code> to restore and install all of the JavaScript packages (including Vue.js).</p>

<h3 id="configure-the-environment-and-run-the-app">Configure the environment and run the app</h3>
<p>You’ll need to make sure the <code class="highlighter-rouge">ASPNETCORE_ENVIRONMENT</code> variable is set on your machine. ASP.NET Core looks at this environment variable to determine whether it’s running in a development or production environment.</p>

<ul>
  <li>If you’re on Windows, use PowerShell to execute <code class="highlighter-rouge">$Env:ASPNETCORE_ENVIRONMENT = "Development"</code></li>
  <li>If you’re on Mac or Linux, execute <code class="highlighter-rouge">export ASPNETCORE_ENVIRONMENT=Development</code></li>
</ul>

<p>In Visual Studio Code, you can open the Integrated Terminal from the View menu to run the above commands.</p>

<p>Now you’re ready to run the app for the first time! Execute <code class="highlighter-rouge">dotnet run</code> in the terminal. After the app compiles, it should report that it’s running on <code class="highlighter-rouge">localhost:5000</code>.</p>

<p><img src="/assets/blog/build-secure-todo-app-vuejs-aspnetcore/dotnet-run-localhost-ade158a006dbf280973154dd2c57eba915c28e15d24ec522aa37c17c973959a1.png" alt="Execute dotnet run in terminal" width="800" class="center-image" /></p>

<p>Open up a browser and navigate to <code class="highlighter-rouge">http://localhost:5000</code>:</p>

<p><img src="/assets/blog/build-secure-todo-app-vuejs-aspnetcore/vue-starter-821a0056b0da2578fa66d940e01ebf76c0b67b332d5517daf8fd64a0d39174c2.png" alt="Vue.js starter template app" width="800" class="center-image" /></p>

<h3 id="optional-install-vue-devtools">Optional: Install Vue Devtools</h3>
<p>If Chrome is your preferred browser, I’d highly recommend the <a href="https://github.com/vuejs/vue-devtools">Vue Devtools</a> extension. It adds some great debugging and inspection features to Chrome that are super useful when you’re building Vue.js applications.</p>

<h2 id="build-the-vuejs-app">Build the Vue.js app</h2>
<p>It’s time to start writing some real code. If <code class="highlighter-rouge">dotnet run</code> is still running in your terminal, press Ctrl-C to stop it.</p>

<p>Delete all the files and folders under the ClientApp folder, and create a new file called <code class="highlighter-rouge">boot-app.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="s1">'vue'</span>
<span class="k">import</span> <span class="nx">App</span> <span class="k">from</span> <span class="s1">'./components/App'</span>
<span class="k">import</span> <span class="nx">router</span> <span class="k">from</span> <span class="s1">'./router'</span>
<span class="k">import</span> <span class="nx">store</span> <span class="k">from</span> <span class="s1">'./store'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">sync</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'vuex-router-sync'</span>

<span class="c1">// Sync Vue router and the Vuex store</span>
<span class="nx">sync</span><span class="p">(</span><span class="nx">store</span><span class="p">,</span> <span class="nx">router</span><span class="p">)</span>

<span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
  <span class="na">el</span><span class="p">:</span> <span class="s1">'#app'</span><span class="p">,</span>
  <span class="nx">store</span><span class="p">,</span>
  <span class="nx">router</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s1">'&lt;App/&gt;'</span><span class="p">,</span>
  <span class="na">components</span><span class="p">:</span> <span class="p">{</span> <span class="nx">App</span> <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>This file sets up Vue, and serves as the main entry point (or starting point) for the whole JavaScript application.</p>

<p>Next, create <code class="highlighter-rouge">router.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="s1">'vue'</span>
<span class="k">import</span> <span class="nx">Router</span> <span class="k">from</span> <span class="s1">'vue-router'</span>
<span class="k">import</span> <span class="nx">store</span> <span class="k">from</span> <span class="s1">'./store'</span>
<span class="k">import</span> <span class="nx">Dashboard</span> <span class="k">from</span> <span class="s1">'./components/Dashboard'</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Router</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">({</span>
  <span class="na">mode</span><span class="p">:</span> <span class="s1">'history'</span><span class="p">,</span>
  <span class="na">base</span><span class="p">:</span> <span class="nx">__dirname</span><span class="p">,</span>
  <span class="na">routes</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="na">component</span><span class="p">:</span> <span class="nx">Dashboard</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">})</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">router</span>
</code></pre></div></div>

<p>The <a href="https://router.vuejs.org/en/">Vue router</a> keeps track of what page the user is currently viewing, and handles navigating between pages or sections of your app. For now, this file sets up the router with only one path <code class="highlighter-rouge">/</code> and associates it with a component called Dashboard.</p>

<p>You might be wondering what <code class="highlighter-rouge">store</code> and <code class="highlighter-rouge">Dashboard</code> are. Don’t worry, you’ll add them next!</p>

<h3 id="add-components">Add components</h3>
<p>Components are how Vue.js organizes pieces of your application. A component wraps up some functionality, from a simple button or UI element to entire pages and sections. Components can contain HTML, JavaScript, and CSS styles.</p>

<p>In the ClientApp folder, create a new folder called <code class="highlighter-rouge">components</code>. Inside the new folder, create a file called <code class="highlighter-rouge">Dashboard.vue</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;template&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dashboard"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;template</span> <span class="na">v-if=</span><span class="s">"!this.$parent.authenticated"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>Welcome!<span class="nt">&lt;/h2&gt;</span>
      <span class="nt">&lt;p&gt;</span>Log in to view your to-do list.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/template&gt;</span>

    <span class="nt">&lt;template</span> <span class="na">v-if=</span><span class="s">"this.$parent.authenticated"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>{{name}}, here's your to-do list<span class="nt">&lt;/h2&gt;</span>

      <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"new-todo"</span>
          <span class="na">autofocus</span>
          <span class="na">autocomplete=</span><span class="s">"off"</span>
          <span class="na">placeholder=</span><span class="s">"What needs to be done?"</span>
          <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter=</span><span class="s">"addTodo"</span><span class="nt">&gt;</span>

      <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"todo-list"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;todo-item</span> <span class="na">v-for=</span><span class="s">"(todo, index) in todos"</span> <span class="na">:key=</span><span class="s">"index"</span> <span class="na">:item=</span><span class="s">"todo"</span><span class="nt">&gt;&lt;/todo-item&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
      
      <span class="nt">&lt;p&gt;</span>{{ remaining }} remaining<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/template&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="k">import</span> <span class="nx">TodoItem</span> <span class="k">from</span> <span class="s1">'./TodoItem'</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">components</span><span class="p">:</span> <span class="p">{</span> <span class="nx">TodoItem</span> <span class="p">},</span>
  <span class="na">computed</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$parent</span><span class="p">.</span><span class="nx">userInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$parent</span><span class="p">.</span><span class="nx">userInfo</span><span class="p">.</span><span class="nx">given_name</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'Hello'</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">todos</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">todos</span>
    <span class="p">},</span>
    <span class="nx">complete</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">todo</span> <span class="o">=&gt;</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">completed</span><span class="p">).</span><span class="nx">length</span>
    <span class="p">},</span>
    <span class="nx">remaining</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">todo</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">todo</span><span class="p">.</span><span class="nx">completed</span><span class="p">).</span><span class="nx">length</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">addTodo</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="o">||</span> <span class="s1">''</span>
      <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'addTodo'</span><span class="p">,</span> <span class="p">{</span> <span class="na">$auth</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$auth</span><span class="p">,</span> <span class="nx">text</span> <span class="p">})</span>
      <span class="p">}</span>
      
      <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="p">},</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;style&gt;</span>
<span class="nc">.new-todo</span> <span class="p">{</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">18px</span><span class="p">;</span>
  <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">15px</span><span class="p">;</span>
  <span class="nl">border-top-width</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">border-left-width</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">border-right-width</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">border-bottom</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0.2</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
</code></pre></div></div>

<p>The Dashboard component is responsible for displaying all the user’s to-do items, and rendering an input field that lets the user add a new item. In <code class="highlighter-rouge">router.js</code>, you told the Vue router to render this component on the <code class="highlighter-rouge">/</code> path, or the root route of the application.</p>

<p>This component has HTML in the <code class="highlighter-rouge">&lt;template&gt;</code> section, JavaScript in the <code class="highlighter-rouge">&lt;script&gt;</code> section, and CSS in the <code class="highlighter-rouge">&lt;style&gt;</code> section, all stored in one <code class="highlighter-rouge">.vue</code> file. If your Vue components become too large or unwieldy, you can choose to split them into separate HTML, JS, and CSS files as needed.</p>

<p>When you use <code class="highlighter-rouge">{{moustaches}}</code> or attributes like <code class="highlighter-rouge">v-for</code> in the component’s HTML, Vue.js automatically inserts (or <strong>binds</strong>) data that’s available to the component. In this case, you’ve defined a handful of JavaScript methods in the <code class="highlighter-rouge">computed</code> section that retrieve things like the user’s name and the user’s to-do list from the data store. That data is then automatically rendered by Vue. Don’t worry about <code class="highlighter-rouge">$store</code> and <code class="highlighter-rouge">$auth</code> yet. You’ll add these pieces in a few minutes.</p>

<p>Notice the <code class="highlighter-rouge">components: { TodoItem }</code> line? The Dashboard component relies on another component called TodoItem. Create a file called <code class="highlighter-rouge">TodoItem.vue</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;template&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"todo"</span> <span class="na">:class=</span><span class="s">"{ completed: item.completed }"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"toggle"</span>
      <span class="na">type=</span><span class="s">"checkbox"</span>
      <span class="na">:checked=</span><span class="s">"item.completed"</span>
      <span class="err">@</span><span class="na">change=</span><span class="s">"toggleTodo({ id: item.id, completed: !item.completed })"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;label</span> <span class="na">v-text=</span><span class="s">"item.text"</span><span class="nt">&gt;&lt;/label&gt;</span>

    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"delete"</span> <span class="err">@</span><span class="na">click=</span><span class="s">"deleteTodo({ id: item.id })"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"glyphicon glyphicon-trash"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/template&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">props</span><span class="p">:</span> <span class="p">[</span><span class="s1">'item'</span><span class="p">],</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">toggleTodo</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$auth</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'toggleTodo'</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">deleteTodo</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$auth</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'deleteTodo'</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;style&gt;</span>
  <span class="nc">.todo</span> <span class="p">{</span>
    <span class="nl">list-style-type</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nc">.todo.completed</span> <span class="p">{</span>
    <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.5</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nc">.todo.completed</span> <span class="nt">label</span> <span class="p">{</span>
    <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">line-through</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nt">button</span><span class="nc">.delete</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="no">red</span><span class="p">;</span>
    <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.5</span><span class="p">;</span>
    <span class="nl">-webkit-appearance</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
    <span class="nl">-moz-appearance</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
    <span class="nl">outline</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
    <span class="nl">border</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="nl">background</span><span class="p">:</span> <span class="nb">transparent</span><span class="p">;</span>
  <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
</code></pre></div></div>

<p>The TodoItem component is only responsible for rendering a single to-do item. The <code class="highlighter-rouge">props: ['item']</code> line declares that this component receives a <strong>prop</strong> or parameter called <code class="highlighter-rouge">item</code>, which contains the data about one to-do item (the text, whether it’s completed, and so on).</p>

<p>In the Dashboard component, this line creates a TodoItem component for each to-do item:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;todo-item</span> <span class="na">v-for=</span><span class="s">"(todo, index) in todos"</span> <span class="na">:key=</span><span class="s">"index"</span> <span class="na">:item=</span><span class="s">"todo"</span><span class="nt">&gt;&lt;/todo-item&gt;</span>
</code></pre></div></div>

<p>There’s a lot going on in this syntax, but the important bits are:</p>

<ul>
  <li>The <code class="highlighter-rouge">&lt;todo-item&gt;</code> tag, which refers to the new TodoItem component.</li>
  <li>
    <p>The <code class="highlighter-rouge">v-for</code> directive, which tells Vue to loop through all the items in the <code class="highlighter-rouge">todos</code> array and render a <code class="highlighter-rouge">&lt;todo-item&gt;</code> for each one.</p>
  </li>
  <li>The <code class="highlighter-rouge">:item="todo"</code> attribute, which binds the value of <code class="highlighter-rouge">todo</code> (a single item from the <code class="highlighter-rouge">todos</code> array) to an attribute called <code class="highlighter-rouge">item</code>. This data is passed into the TodoItem component as the <code class="highlighter-rouge">item</code> prop.</li>
</ul>

<p>Using components to split your app into small pieces makes it easier to organize and maintain your code. If you need to change how to-do items are rendered in the future, you just need to make changes to the TodoItem component.</p>

<p>The Dashboard and TodoItem components (and the router configuration) refer to something called <code class="highlighter-rouge">store</code> or <code class="highlighter-rouge">$store</code>. I’ll explain what the store is, and how to build it, in the next section. Later, you’ll also add <code class="highlighter-rouge">$auth</code>, which is a plugin that keeps track of whether a user is currently logged in. Before you get there, you need to build one more component.</p>

<p>Create a file called <code class="highlighter-rouge">App.vue</code> in the <code class="highlighter-rouge">components</code> folder:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;template&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-view"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;router-view</span> <span class="nt">/&gt;</span>

      <span class="nt">&lt;template</span> <span class="na">v-if=</span><span class="s">"authenticated"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">v-on:click=</span><span class="s">'logout'</span><span class="nt">&gt;</span>Log out<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/template&gt;</span>

      <span class="nt">&lt;template</span> <span class="na">v-else</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">v-on:click=</span><span class="s">'$auth.loginRedirect'</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/template&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'app'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">authenticated</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">userInfo</span><span class="p">:</span> <span class="kc">null</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">created</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">checkAuthentication</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="na">watch</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// Every time the route changes, check the auth status</span>
    <span class="s1">'$route'</span><span class="p">:</span> <span class="s1">'checkAuthentication'</span>
  <span class="p">},</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="k">async</span> <span class="nx">checkAuthentication</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">previouslyLoggedIn</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">authenticated</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">authenticated</span> <span class="o">=</span> <span class="kr">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$auth</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">()</span>

      <span class="kd">let</span> <span class="nx">justLoggedIn</span> <span class="o">=</span> <span class="o">!</span><span class="nx">previouslyLoggedIn</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">authenticated</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">justLoggedIn</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">,</span> <span class="p">{</span> <span class="na">$auth</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$auth</span> <span class="p">})</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">userInfo</span> <span class="o">=</span> <span class="kr">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$auth</span><span class="p">.</span><span class="nx">getUser</span><span class="p">()</span>
      <span class="p">}</span>

      <span class="kd">let</span> <span class="nx">justLoggedOut</span> <span class="o">=</span> <span class="nx">previouslyLoggedIn</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">authenticated</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">justLoggedOut</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">userInfo</span> <span class="o">=</span> <span class="kc">null</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">'clearTodos'</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="k">async</span> <span class="nx">logout</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kr">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$auth</span><span class="p">.</span><span class="nx">logout</span><span class="p">()</span>
      <span class="kr">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">checkAuthentication</span><span class="p">()</span>

      <span class="c1">// Navigate back to home</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">path</span><span class="p">:</span> <span class="s1">'/'</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;style&gt;</span>
<span class="nt">html</span><span class="o">,</span> <span class="nt">body</span> <span class="p">{</span>
	<span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
	<span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span> <span class="p">{</span>
	<span class="nl">font</span><span class="p">:</span> <span class="m">14px</span> <span class="n">-apple-system</span><span class="p">,</span> <span class="n">BlinkMacSystemFont</span><span class="p">,</span> <span class="n">Helvetica</span><span class="p">,</span> <span class="n">Arial</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
	<span class="nl">line-height</span><span class="p">:</span> <span class="m">1.4em</span><span class="p">;</span>
	<span class="nl">background</span><span class="p">:</span> <span class="m">#F3F5F6</span><span class="p">;</span>
	<span class="nl">color</span><span class="p">:</span> <span class="m">#4d4d4d</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">ul</span> <span class="p">{</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span> <span class="p">{</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.app-container</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.app-view</span> <span class="p">{</span>
  <span class="nl">background</span><span class="p">:</span> <span class="m">#fff</span><span class="p">;</span>
  <span class="nl">min-width</span><span class="p">:</span> <span class="m">400px</span><span class="p">;</span>
  <span class="nl">min-height</span><span class="p">:</span> <span class="m">200px</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">20px</span> <span class="m">25px</span> <span class="m">15px</span> <span class="m">25px</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
	<span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
	<span class="nl">box-shadow</span><span class="p">:</span> <span class="m">0</span> <span class="m">2px</span> <span class="m">4px</span> <span class="m">0</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0.2</span><span class="p">),</span>
	            <span class="m">0</span> <span class="m">5px</span> <span class="m">10px</span> <span class="m">0</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
</code></pre></div></div>

<p>The App component is responsible for two things:</p>
<ul>
  <li>Providing the base HTML and CSS used by the app.</li>
  <li>Keeping track of whether the user is logged in, using the <code class="highlighter-rouge">$auth</code> plugin. (This will be covered a little later.)</li>
</ul>

<p>The <code class="highlighter-rouge">&lt;router-view&gt;</code> element provides a place to render the Vue router’s active route. Right now, there’s only one route: <code class="highlighter-rouge">/</code> which will render the Dashboard component in the <code class="highlighter-rouge">&lt;router-view&gt;</code>.</p>

<p>Navbars and other UI elements that should exist outside of the current router view can be placed in this component. For now, the component will just show a simple button to log in or out, depending on the value of the <code class="highlighter-rouge">authenticated</code> variable in the component code.</p>

<p>How does Vue know that the App component should be used as the “base” HTML and CSS for the app? If you look back at <code class="highlighter-rouge">boot-app.js</code>, you’ll see this line:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">App</span> <span class="k">from</span> <span class="s1">'./components/App'</span>
</code></pre></div></div>

<p>This statement loads the App component, which is then passed to Vue in <code class="highlighter-rouge">new Vue(...)</code>. This tells Vue that it should load the App component first.</p>

<p>You’re all done building components! It’s time to add some state management and authentication. First, I’ll explain what state management is and why it’s useful.</p>

<h3 id="add-vuex-for-state-management">Add Vuex for state management</h3>
<p>Components are a great way to break up your app into manageable pieces, but when you start passing data between many components, it becomes hard to keep all of that data in sync.</p>

<p>The <a href="https://vuex.vuejs.org/">Vuex</a> library helps solve this problem by creating a <strong>store</strong> that holds data in a central place. Then, any of your components can get the data they need from the store. Bonus: if the data in the store changes, all your components get the updated data immediately!</p>

<p>If you’ve used Flux or Redux, you’ll find Vuex familiar: it’s a state management library with strict rules around how state can be mutated (modified) inside your app.</p>

<p>The template you started with already has Vuex installed. To keep things tidy, create a new folder under <code class="highlighter-rouge">ClientApp</code> called <code class="highlighter-rouge">store</code>. Then, create a file inside called <code class="highlighter-rouge">index.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="s1">'vue'</span>
<span class="k">import</span> <span class="nx">Vuex</span> <span class="k">from</span> <span class="s1">'vuex'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">mutations</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./mutations'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">actions</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./actions'</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Vuex</span><span class="p">)</span>

<span class="k">export</span> <span class="k">default</span> <span class="k">new</span> <span class="nx">Vuex</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span>
  <span class="nx">state</span><span class="p">,</span>
  <span class="nx">mutations</span><span class="p">,</span>
  <span class="nx">actions</span>
<span class="p">})</span>
</code></pre></div></div>

<p>This file initializes Vuex and makes it available to your Vue components. The real meat of Vuex is in <strong>mutations</strong> and <strong>actions</strong>, but you’ll write those in separate files to keep everything organized.</p>

<p>Create a file called <code class="highlighter-rouge">mutations.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">todos</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">mutations</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">loadTodos</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">todos</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">todos</span> <span class="o">=</span> <span class="nx">todos</span> <span class="o">||</span> <span class="p">[];</span>
  <span class="p">},</span>

  <span class="nx">clearTodos</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">todos</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This file defines two things: the <code class="highlighter-rouge">state</code> or data that’s shared across the app, and mutations that change that state. Vuex follows a few simple rules:</p>

<ul>
  <li>State is immutable – it can’t be changed except by a mutation.</li>
  <li>Mutations can change state, but they must be synchronous. Async code (like API calls) must run in an action instead.</li>
  <li>Actions run asynchronous code, then commit mutations, which change state.</li>
</ul>

<p>Enforcing this hierarchy of rules makes it easier to understand how data and changes flow through your app. If some piece of state changes, you know that a mutation caused the change.</p>

<p>This app uses the Vuex store to keep track of the to-do list (the <code class="highlighter-rouge">state.todos</code> array). The Dashboard component accesses this data with computed properties like:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">todos</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">todos</span>
<span class="p">},</span>
</code></pre></div></div>

<p>The mutations defined here are only half the story, because they only handle updating the state <em>after</em> an action has run. Create another file called <code class="highlighter-rouge">actions.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="s1">'axios'</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="k">async</span> <span class="nx">getAllTodos</span><span class="p">({</span> <span class="nx">commit</span> <span class="p">},</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Todo: get the user's to-do items</span>
    <span class="kd">let</span> <span class="nx">fakeTodoItem</span> <span class="o">=</span> <span class="p">{</span> <span class="na">text</span><span class="p">:</span> <span class="s1">'Fake to-do item'</span> <span class="p">}</span>
    <span class="nx">commit</span><span class="p">(</span><span class="s1">'loadTodos'</span><span class="p">,</span> <span class="p">[</span><span class="nx">fakeTodoItem</span><span class="p">])</span>
  <span class="p">},</span>

  <span class="k">async</span> <span class="nx">addTodo</span><span class="p">({</span> <span class="nx">dispatch</span> <span class="p">},</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Todo: save a new to-do item</span>
    <span class="kr">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="k">async</span> <span class="nx">toggleTodo</span><span class="p">({</span> <span class="nx">dispatch</span> <span class="p">},</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Todo: toggle to-do item completed/not completed</span>
    <span class="kr">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="k">async</span> <span class="nx">deleteTodo</span><span class="p">({</span> <span class="nx">dispatch</span> <span class="p">},</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Todo: delete to-do item</span>
    <span class="kr">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Most of these actions are marked with <code class="highlighter-rouge">// Todo</code> (no pun intended), because you’ll need to revisit them after you have the backend API in place. For now, the <code class="highlighter-rouge">getAllTodos</code> action commits the <code class="highlighter-rouge">loadTodos</code> mutation with a fake to-do item. Later, this action will call your API to retrieve the user’s to-do items and then commit the mutation with the real items returned from the API.</p>

<h2 id="add-identity-and-security-with-okta">Add identity and security with Okta</h2>

<p><a href="https://developer.okta.com">Okta</a> is a cloud-hosted identity API that makes it easy to add authentication, authorization, and user management to your web and mobile apps. You’ll use it in this project to:</p>

<ul>
  <li>Add login to the Vue app</li>
  <li>Require authentication on the backend API</li>
  <li>Store each user’s to-do items securely</li>
</ul>

<p>To get started, sign up for a free <a href="https://developer.okta.com/signup/">Okta Developer account</a>. After you activate your new account (called an Okta organization, or org), click Applications at the top of the screen. Choose Single-Page App and click Next. Change the base URI to <code class="highlighter-rouge">http://localhost:5000</code>, and the login redirect URI to <code class="highlighter-rouge">http://localhost:5000/implicit/callback</code>:</p>

<p><img src="/assets/blog/build-secure-todo-app-vuejs-aspnetcore/okta-app-settings-ad0b56e7fff8e5c8caf070d3a81e8172f107944343fe464c14e6bafdc58c8d64.png" alt="Okta application settings" width="700" class="center-image" /></p>

<p>After you click Done, you’ll be redirected to the new application’s details. Scroll down and copy the Client ID. You’ll need it in a minute.</p>

<h3 id="add-a-custom-user-profile-field">Add a custom user profile field</h3>
<p>By default, Okta stores basic information about your users: first name, last name, email, and so on. If you want to store more, Okta supports custom profile fields that can store any type of user data you need. You can use this to store the to-do items for each user right on the user profile - no extra database needed!</p>

<p>To add a custom field, open the Users menu at the top of the screen and click on Profile Editor. On the first row (Okta User), click Profile to edit the default user profile. Add a string attribute called <code class="highlighter-rouge">todos</code>:</p>

<p><img src="/assets/blog/build-secure-todo-app-vuejs-aspnetcore/add-todos-profile-field-f38374e9f49a22229ef633e2a1e1b8edaeb07357bd1e1633b644c2835a5421a6.png" alt="Add custom field in Okta profile" width="700" class="center-image" /></p>

<p>Next, you’ll connect your frontend code (the Vue app) to Okta.</p>

<h3 id="add-the-okta-vue-sdk">Add the Okta Vue SDK</h3>

<p>The <a href="https://www.npmjs.com/package/@okta/okta-vue">Okta Vue SDK</a> makes it easy to add Okta authentication to your Vue app. Add it with <code class="highlighter-rouge">npm</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install <span class="nt">--save</span> @okta/okta-vue
</code></pre></div></div>

<p>Once it’s installed, update <code class="highlighter-rouge">router.js</code> and some new code (highlighted here with comments):</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="s1">'vue'</span>
<span class="k">import</span> <span class="nx">Router</span> <span class="k">from</span> <span class="s1">'vue-router'</span>
<span class="k">import</span> <span class="nx">store</span> <span class="k">from</span> <span class="s1">'./store'</span>
<span class="k">import</span> <span class="nx">Dashboard</span> <span class="k">from</span> <span class="s1">'./components/Dashboard'</span>
<span class="c1">// Import the Okta Vue SDK</span>
<span class="k">import</span> <span class="nx">Auth</span> <span class="k">from</span> <span class="s1">'@okta/okta-vue'</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Router</span><span class="p">)</span>

<span class="c1">// Add the $auth plugin from the Okta Vue SDK to the Vue instance</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Auth</span><span class="p">,</span> <span class="p">{</span>
  <span class="c1">// Replace this with your Okta domain:</span>
  <span class="na">issuer</span><span class="p">:</span> <span class="s1">'<span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default'</span><span class="p">,</span>
  <span class="c1">// Replace this with the client ID of the Okta app you just created:</span>
  <span class="na">client_id</span><span class="p">:</span> <span class="s1">'{clientId}'</span><span class="p">,</span>
  <span class="na">redirect_uri</span><span class="p">:</span> <span class="s1">'http://localhost:5000/implicit/callback'</span><span class="p">,</span>
  <span class="na">scope</span><span class="p">:</span> <span class="s1">'openid profile email'</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">({</span>
  <span class="na">mode</span><span class="p">:</span> <span class="s1">'history'</span><span class="p">,</span>
  <span class="na">base</span><span class="p">:</span> <span class="nx">__dirname</span><span class="p">,</span>
  <span class="na">routes</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="na">component</span><span class="p">:</span> <span class="nx">Dashboard</span> <span class="p">},</span>
    <span class="c1">// Handle the redirect from Okta using the Okta Vue SDK</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="s1">'/implicit/callback'</span><span class="p">,</span> <span class="na">component</span><span class="p">:</span> <span class="nx">Auth</span><span class="p">.</span><span class="nx">handleCallback</span><span class="p">()</span> <span class="p">},</span>
  <span class="p">]</span>
<span class="p">})</span>

<span class="c1">// Check the authentication status before router transitions</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">beforeEach</span><span class="p">(</span><span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$auth</span><span class="p">.</span><span class="nx">authRedirectGuard</span><span class="p">())</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">router</span>
</code></pre></div></div>

<p>Replace <code class="highlighter-rouge">{yourOktaDomain}</code> with your Okta Org URL, which usually looks like this: <code class="highlighter-rouge">https://dev-12345.oktapreview.com</code>. You can find it in the top right corner of the Okta developer dashboard page.</p>

<p>Next, paste the Client ID you copied from the application you created a minute ago into the <code class="highlighter-rouge">client_id</code> property.</p>

<p>Try it out: run the server with <code class="highlighter-rouge">dotnet run</code> and try logging in with the email and password you used to sign up for Okta:</p>

<p><img src="/assets/blog/build-secure-todo-app-vuejs-aspnetcore/logged-in-2b4d0bdd5def8f1e277bc6bbbdc6b16ea29d2a21e562bbd59c9d55776424db11.png" alt="Logged in via Okta" width="450" class="center-image" /></p>

<p>The Log in button uses the Okta Vue SDK to redirect to your Okta organization’s hosted login screen, which then redirects back to your app with tokens that identify the user. The <code class="highlighter-rouge">/implicit/callback</code> route you added to the router handles this redirect from Okta and calls the <code class="highlighter-rouge">Auth.handleCallback()</code> function in the Okta Vue SDK. This function takes care of parsing the tokens and letting your app know that the user logged in.</p>

<p>Tip: If you need to fix bugs or make changes in your JavaScript code, you don’t need to stop and restart the server with <code class="highlighter-rouge">dotnet run</code> again. As soon as you modify any of your Vue or JavaScript files, the frontend app will be recompiled automatically. If you make a change to the Dashboard component (for example), it’ll appear instantly in the browser (almost like magic).</p>

<p>Try logging in, refreshing the page (you should still be logged in!), and logging out. That takes care of authenticating the user on the frontend! Later, you’ll update the store to make secure, authenticated calls to your backend API using the same tokens you just obtained.</p>

<p>Great job so far! You’ve set up Vue.js, built components and routing, added state management with Vuex, and added Okta for authentication. The next step is adding the backend API with ASP.NET Core. Grab a refill of coffee and let’s dive in!</p>

<h2 id="build-an-api-with-aspnet-core">Build an API with ASP.NET Core</h2>
<p>The user’s to-do items will be stored in the cloud (via Okta) so they can be accessed anywhere. Your frontend app won’t access this data directly. Instead, the Vuex actions will call your backend API, which will retrieve the data and return it to the frontend.</p>

<p>This pattern (JavaScript code calling a backend API) is a common way to architect modern apps. The API can be written in any language you prefer. In this tutorial, you’ll write the API in C# using the ASP.NET Core framework.</p>

<p>If you want an introduction to ASP.NET Core from the ground up, check out my free <a href="http://littleasp.net/book">Little ASP.NET Core Book</a>!</p>

<p>The template you started from already includes the scaffolding you need for a basic ASP.NET Core project:</p>
<ul>
  <li>The <code class="highlighter-rouge">Startup.cs</code> file, which configures the project and defines the middleware pipeline.</li>
  <li>A pair of controllers in the aptly-named Controllers folder.</li>
</ul>

<p>In ASP.NET Core, Controllers handle requests to specific routes in your backend application or API. The <code class="highlighter-rouge">HomeController</code> contains boilerplate code that handles the root route <code class="highlighter-rouge">/</code> and renders your frontend app. You won’t need to modify it. The <code class="highlighter-rouge">SampleDataController</code>, on the other hand, can be deleted. Time to write a new controller!</p>

<p>Create a new file in the Controllers folder called <code class="highlighter-rouge">TodoController.cs</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Authorization</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Vue2Spa.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"api/[controller]"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">TodoController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
        <span class="c1">// Handles GET /api/todo</span>
        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">GetAllTodos</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// TODO: Get to-do items and return to frontend</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">Route</code> attribute at the top of the controller with a value of <code class="highlighter-rouge">"api/[controller]"</code> tells ASP.NET Core that this controller will be handling the route <code class="highlighter-rouge">http://yourdomain/api/todo</code>. Inside the controller, the <code class="highlighter-rouge">GetAllTodos</code> method is decorated with the <code class="highlighter-rouge">HttpGet</code> attribute to indicate that it should handle an HTTP GET. When your frontend code makes a GET to <code class="highlighter-rouge">/api/todo</code>, the <code class="highlighter-rouge">GetAllTodos</code> method will run.</p>

<h3 id="define-a-model">Define a model</h3>
<p>Before you return to-do items from the method, you need to define the structure of the object, or <strong>model</strong>, you’ll return. Since C# is a statically-typed language (as opposed to a dynamic language like JavaScript), it’s typical to define these types in advance.</p>

<p>Create a new folder at the root of the project (next to to the Controllers folder) called Models. Inside, create a file called <code class="highlighter-rouge">TodoItemModel.cs</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Vue2Spa.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">TodoItemModel</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Guid</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">string</span> <span class="n">Text</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="n">Completed</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This model defines a few simple properties for all to-do items: an ID, some text, and a boolean indicating whether the to-do is complete. When you fill this model with data and return it from your controller, ASP.NET Core will automatically serialize these properties to JSON that your frontend code can easily consume.</p>

<h3 id="define-a-service">Define a service</h3>
<p>You could return a model directly from the <code class="highlighter-rouge">GetAllTodos</code> method, but it’s common to add another layer. In the next section, you’ll add code to look up the user’s profile in Okta and retrieve their to-do items. To keep everything organized, you can create a <strong>service</strong> that will wrap up the code that retrieves the user’s to-do items.</p>

<p>Create one more folder in the project root called Services, and add a file called <code class="highlighter-rouge">ITodoItemService.cs</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Vue2Spa.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Vue2Spa.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">ITodoItemService</span>
    <span class="p">{</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TodoItemModel</span><span class="p">&gt;&gt;</span> <span class="nf">GetItems</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">);</span>

        <span class="n">Task</span> <span class="nf">AddItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">text</span><span class="p">);</span>

        <span class="n">Task</span> <span class="nf">UpdateItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">,</span> <span class="n">TodoItemModel</span> <span class="n">updatedData</span><span class="p">);</span>

        <span class="n">Task</span> <span class="nf">DeleteItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This file describes an <strong>interface</strong> – a feature in C# (and many other languages) that defines the methods available in a particular class without providing the “concrete” implementation. This makes it easy to test and swap out implementations during development.</p>

<p>Create a new file called <code class="highlighter-rouge">FakeTodoItemService.cs</code> that will be a temporary implementation until you add the connection to Okta in the next section:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Vue2Spa.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Vue2Spa.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">FakeTodoItemService</span> <span class="p">:</span> <span class="n">ITodoItemService</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TodoItemModel</span><span class="p">&gt;&gt;</span> <span class="nf">GetItems</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">todos</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span>
            <span class="p">{</span>
                <span class="k">new</span> <span class="n">TodoItemModel</span> <span class="p">{</span> <span class="n">Text</span> <span class="p">=</span> <span class="s">"Learn Vue.js"</span><span class="p">,</span> <span class="n">Completed</span> <span class="p">=</span> <span class="k">true</span> <span class="p">},</span>
                <span class="k">new</span> <span class="n">TodoItemModel</span> <span class="p">{</span> <span class="n">Text</span> <span class="p">=</span> <span class="s">"Learn ASP.NET Core"</span> <span class="p">}</span>
            <span class="p">};</span>

            <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="n">todos</span><span class="p">.</span><span class="nf">AsEnumerable</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span> <span class="nf">AddItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">text</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span> <span class="nf">DeleteItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span> <span class="nf">UpdateItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">,</span> <span class="n">TodoItemModel</span> <span class="n">updatedData</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This dummy service will always return the same to-do items. You’ll replace it soon, but it will let you test the app and make sure everything is working.</p>

<h3 id="use-the-service">Use the service</h3>
<p>With the controller, model, and service all in place, all you need to do is connect them together. First, open up the <code class="highlighter-rouge">Startup.cs</code> file and add this line anywhere in the <code class="highlighter-rouge">ConfigureServices</code> method:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">ITodoItemService</span><span class="p">,</span> <span class="n">FakeTodoItemService</span><span class="p">&gt;();</span>
</code></pre></div></div>

<p>You’ll also need to add this <code class="highlighter-rouge">using</code> statement to the top of the file:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Vue2Spa.Services</span><span class="p">;</span>
</code></pre></div></div>

<p>Adding the new service to the <code class="highlighter-rouge">ConfigureServices</code> method makes it available to your controllers. In your <code class="highlighter-rouge">TodoController</code>, add this code at the top of the class:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">TodoController</span> <span class="p">:</span> <span class="n">Controller</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">ITodoItemService</span> <span class="n">_todoItemService</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">TodoController</span><span class="p">(</span><span class="n">ITodoItemService</span> <span class="n">todoItemService</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_todoItemService</span> <span class="p">=</span> <span class="n">todoItemService</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Existing code...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Adding this code causes ASP.NET Core to inject an <code class="highlighter-rouge">ITodoItemService</code> object into the controller. Because you’re using the interface here, your controller doesn’t know (or care) which implementation of the <code class="highlighter-rouge">ITodoItemService</code> it receives. It’s currently the <code class="highlighter-rouge">FakeTodoItemService</code>, but later it’ll be a more interesting (and real) implementation.</p>

<p>Add this <code class="highlighter-rouge">using</code> statement at the top of the file:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Vue2Spa.Services</span><span class="p">;</span>
</code></pre></div></div>

<p>Finally, add this code to the <code class="highlighter-rouge">GetAllTodos</code> method:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="s">"123"</span><span class="p">;</span> <span class="c1">// TODO: Get actual user ID</span>
<span class="kt">var</span> <span class="n">todos</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_todoItemService</span><span class="p">.</span><span class="nf">GetItems</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

<span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">todos</span><span class="p">);</span>
</code></pre></div></div>

<p>When a request comes into the <code class="highlighter-rouge">GetAllTodos</code> method, the controller calls the <code class="highlighter-rouge">ITodoItemService</code> to get the to-do items for the current user, and then returns HTTP OK (200) with the to-do items.</p>

<p>That takes care of the backend API (for now). The frontend now needs to be updated to call the <code class="highlighter-rouge">/api/todo</code> route to get the user’s to-do items. In <code class="highlighter-rouge">actions.js</code>, update the <code class="highlighter-rouge">getAllTodos</code> function:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nx">getAllTodos</span><span class="p">({</span> <span class="nx">commit</span> <span class="p">},</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/api/todo'</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">response</span> <span class="o">&amp;&amp;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">updatedTodos</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span>
    <span class="nx">commit</span><span class="p">(</span><span class="s1">'loadTodos'</span><span class="p">,</span> <span class="nx">updatedTodos</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">},</span>
</code></pre></div></div>

<p>The new action code uses the <a href="https://github.com/axios/axios">axios library</a> to make a request to the backend on the <code class="highlighter-rouge">/api/todo</code> route, which will be handled by the <code class="highlighter-rouge">GetAllTodos</code> method on the backend <code class="highlighter-rouge">TodoController</code>. If data is returned, the <code class="highlighter-rouge">loadTodos</code> mutation is committed and the Vuex store is updated with the user’s to-do items. The Dashboard view will automatically see the updated data in the store and render the items in the browser.</p>

<p>Ready to test it out? Run the project with <code class="highlighter-rouge">dotnet run</code> and browse to <code class="highlighter-rouge">http://localhost:5000</code>:</p>

<p><img src="/assets/blog/build-secure-todo-app-vuejs-aspnetcore/logged-in-fake-items-via-backend-cef12f8335e1d404741195dec09b25eaf193fe66a7816d03958df337324899c5.png" alt="Retrieved fake items from the backend API" width="500" class="center-image" /></p>

<p>The data may be fake, but you’ve successfully connected the backend and frontend! The final step is to add data storage and token authentication to the app. You’re almost there!</p>

<h2 id="add-token-authentication-to-the-api">Add token authentication to the API</h2>

<p>When the Okta Vue SDK handles a login via Okta, it saves a token called an <strong>access token</strong> in your frontend app. You can attach this access token to calls to your backend API to make them secure. Before you do that, you have to tell your ASP.NET Core project to use token authentication. Open up the <code class="highlighter-rouge">Startup.cs</code> file and add this code to the <code class="highlighter-rouge">ConfigureServices</code> method:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddAuthentication</span><span class="p">(</span><span class="n">JwtBearerDefaults</span><span class="p">.</span><span class="n">AuthenticationScheme</span><span class="p">)</span>
<span class="p">.</span><span class="nf">AddJwtBearer</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">options</span><span class="p">.</span><span class="n">Authority</span> <span class="p">=</span> <span class="s">"<span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default"</span><span class="p">;</span>
    <span class="n">options</span><span class="p">.</span><span class="n">Audience</span> <span class="p">=</span> <span class="s">"api://default"</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Make sure you replace <code class="highlighter-rouge">yourOktaDomain</code> with your Okta Org URL (find it in the top-right of your Okta developer console’s Dashboard).</p>

<p>You’ll need to add this using statement at the top of the file:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Authentication.JwtBearer</span><span class="p">;</span>
</code></pre></div></div>

<p>And this line down in the <code class="highlighter-rouge">Configure</code> method:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="nf">UseStaticFiles</span><span class="p">();</span>

<span class="c1">// Add this:</span>
<span class="n">app</span><span class="p">.</span><span class="nf">UseAuthentication</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseMvc</span><span class="p">(...</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">Configure</code> method defines the middleware pipeline for an ASP.NET Core project, or the list of handlers that modify incoming requests. Adding <code class="highlighter-rouge">UseAuthentication()</code> makes it possible for you to require authentication for your controllers.</p>

<p>Controllers need to opt-in to an authentication check, by adding the <code class="highlighter-rouge">[Authorize]</code> attribute at the top of the controller. Add this in the <code class="highlighter-rouge">TodoController</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">[Route("api/[controller]</span><span class="s">")]
</span><span class="c1">// Add this attribute:</span>
<span class="na">[Authorize]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">TodoController</span> <span class="p">:</span> <span class="n">Controller</span>
<span class="p">{</span>
    <span class="c1">// Existing code...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With the code you’ve added to the <code class="highlighter-rouge">Startup</code> class, plus the <code class="highlighter-rouge">[Authorize]</code> attribute on the controller, requests to <code class="highlighter-rouge">/api/todo</code> now require a valid access token to succeed. If you tried running the app now and looking at your browser’s network console, you’d see a failed API request:</p>

<p><img src="/assets/blog/build-secure-todo-app-vuejs-aspnetcore/api-request-401-18625416b3147f1e502dd9ea958c3f69e976a9573d950f7459a186191ece3804.png" alt="API request returns 401" width="700" class="center-image" /></p>

<p>Since your frontend code isn’t yet attaching a token to the request, the <code class="highlighter-rouge">TodoController</code> is responding with 401 Unauthorized (access denied).</p>

<p>Open up <code class="highlighter-rouge">actions.js</code> once more and add a small function at the top that attaches the user’s token to the HTTP <code class="highlighter-rouge">Authorization</code> header:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">addAuthHeader</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">auth</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'Authorization'</span><span class="p">:</span> <span class="s1">'Bearer '</span> <span class="o">+</span> <span class="kr">await</span> <span class="nx">auth</span><span class="p">.</span><span class="nx">getAccessToken</span><span class="p">()</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Then, update the code that calls the backend in the <code class="highlighter-rouge">getAllTodos</code> function:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/api/todo'</span><span class="p">,</span> <span class="kr">await</span> <span class="nx">addAuthHeader</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span><span class="p">))</span>
</code></pre></div></div>

<p>The Okta Vue SDK (the <code class="highlighter-rouge">$auth</code> plugin) isn’t available in the context of the store, so it’s being passed in as part of the <code class="highlighter-rouge">data</code> payload when the action is dispatched. You can see how this works in <code class="highlighter-rouge">App.vue</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">justLoggedIn</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">,</span> <span class="p">{</span> <span class="na">$auth</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$auth</span> <span class="p">})</span>
  <span class="c1">// ...</span>
</code></pre></div></div>

<p>Refresh the browser (or start the server) and the request will succeed once again, because the frontend is passing a valid token.</p>

<h3 id="add-the-okta-net-sdk">Add the Okta .NET SDK</h3>

<p>Almost done! The final task is to store and retrieve the user’s to-do items in the Okta custom profile attribute you set up earlier. You’ll use the <a href="https://www.nuget.org/packages/Okta.Sdk">Okta .NET SDK</a> to do this in a few lines of backend code.</p>

<p>Stop the <code class="highlighter-rouge">dotnet</code> server (if it’s running), and install the Okta .NET SDK in your project:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet add package Okta.Sdk <span class="nt">--version</span> 1.0.0-alpha4
</code></pre></div></div>

<p>Open the <code class="highlighter-rouge">Startup.cs</code> file again and add this code anywhere in the <code class="highlighter-rouge">ConfigureServices</code> method:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">IOktaClient</span><span class="p">&gt;(</span><span class="k">new</span> <span class="nf">OktaClient</span><span class="p">(</span><span class="k">new</span> <span class="n">OktaClientConfiguration</span>
<span class="p">{</span>
    <span class="n">OrgUrl</span> <span class="p">=</span> <span class="s">"<span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>"</span><span class="p">,</span>
    <span class="n">Token</span> <span class="p">=</span> <span class="n">Configuration</span><span class="p">[</span><span class="s">"okta:token"</span><span class="p">]</span>
<span class="p">}));</span>
</code></pre></div></div>

<p>This makes the Okta .NET SDK available to the whole project as a service. You’ll also need to add these lines to the top of the file:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Okta.Sdk</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Okta.Sdk.Configuration</span><span class="p">;</span>
</code></pre></div></div>

<p>Remember to replace <code class="highlighter-rouge">yourOktaDomain</code> with your Okta Org URL.</p>

<h3 id="get-an-okta-api-token">Get an Okta API token</h3>
<p>The Okta SDK needs an Okta API token to call the Okta API. This is used for management tasks (like storing and retrieving user profile data), and is separate from the Bearer tokens you’re using for user authentication.</p>

<p>Generate an Okta API token in the Okta developer console by hovering on API and clicking Tokens. Create a token and copy the value.</p>

<p>The Okta API token is sensitive and should be protected, because it allows you to do any action in the Okta API (including deleting users and applications). You shouldn’t store it in code that gets checked into source control. Instead, use the <a href="https://docs.microsoft.com/en-us/aspnet/core/security/app-secrets">.NET Secret Manager</a> tool.</p>

<p>Tip: If you’re using Visual Studio 2017 on Windows, you can right-click the project in the Solution Explorer and choose <strong>Manage user secrets</strong>. Then you can skip the installation steps and jump down to adding the secret value with <code class="highlighter-rouge">dotnet user-secrets set</code>.</p>

<p>Open up the <code class="highlighter-rouge">Vue2Spa.csproj</code> file and add this line near the existing <code class="highlighter-rouge">DotNetCliToolReference</code> line:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;DotNetCliToolReference</span> <span class="na">Include=</span><span class="s">"Microsoft.Extensions.SecretManager.Tools"</span> <span class="na">Version=</span><span class="s">"2.0.0"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">.csproj</code> file is the main project file for any ASP.NET Core application. It defines the packages that are installed in the project, and some other metadata. Adding this line installs the Secret Manager tool in this project. Run a package restore to make sure the tool gets installed, and test it out:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet restore
dotnet user-secrets <span class="nt">-h</span>
</code></pre></div></div>

<p>Next, add another line near the top of the <code class="highlighter-rouge">Vue2Spa.csproj</code> file, right under <code class="highlighter-rouge">&lt;TargetFramework&gt;</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;UserSecretsId&gt;</span>(some random value)<span class="nt">&lt;/UserSecretsId&gt;</span>
</code></pre></div></div>

<p>Generate a <a href="https://www.guidgenerator.com/">random GUID</a> as the ID value, and save the project file.</p>

<p>Grab the Okta API token value and store it using the Secret Manager:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet user-secrets <span class="nb">set </span>okta:token <span class="o">{{</span>oktaApiToken<span class="o">}}</span>
</code></pre></div></div>

<p>To make the values stored in the Secret Manager available to your application, you need to add it as a configuration source in <code class="highlighter-rouge">Startup.cs</code>. At the top of the file, in the <code class="highlighter-rouge">Startup</code> (constructor) method, add this code:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ... existing code</span>
<span class="p">.</span><span class="nf">AddEnvironmentVariables</span><span class="p">();</span>

<span class="c1">// Add this:</span>
<span class="k">if</span> <span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="nf">IsDevelopment</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">AddUserSecrets</span><span class="p">&lt;</span><span class="n">Startup</span><span class="p">&gt;();</span>
<span class="p">}</span>

<span class="c1">// Existing code continues... </span>
<span class="n">Configuration</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>
</code></pre></div></div>

<p>With that, the Okta .NET SDK will have an API token it can use to call the Okta API. You’ll use the SDK to store and retrieve the user’s to-do items.</p>

<h3 id="use-okta-for-user-data-storage">Use Okta for user data storage</h3>
<p>Remember the <code class="highlighter-rouge">FakeTodoItemService</code> you created? It’s time to replace it with a new service that uses Okta to store the user’s to-do items. Create <code class="highlighter-rouge">OktaTodoItemService.cs</code> in the Services folder:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Okta.Sdk</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Vue2Spa.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Vue2Spa.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">OktaTodoItemService</span> <span class="p">:</span> <span class="n">ITodoItemService</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">TodoProfileKey</span> <span class="p">=</span> <span class="s">"todos"</span><span class="p">;</span>

        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IOktaClient</span> <span class="n">_oktaClient</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">OktaTodoItemService</span><span class="p">(</span><span class="n">IOktaClient</span> <span class="n">oktaClient</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_oktaClient</span> <span class="p">=</span> <span class="n">oktaClient</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TodoItemModel</span><span class="p">&gt;</span> <span class="nf">GetItemsFromProfile</span><span class="p">(</span><span class="n">IUser</span> <span class="n">oktaUser</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">oktaUser</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">Enumerable</span><span class="p">.</span><span class="n">Empty</span><span class="p">&lt;</span><span class="n">TodoItemModel</span><span class="p">&gt;();</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">json</span> <span class="p">=</span> <span class="n">oktaUser</span><span class="p">.</span><span class="n">Profile</span><span class="p">.</span><span class="n">GetProperty</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="n">TodoProfileKey</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">Enumerable</span><span class="p">.</span><span class="n">Empty</span><span class="p">&lt;</span><span class="n">TodoItemModel</span><span class="p">&gt;();</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">DeserializeObject</span><span class="p">&lt;</span><span class="n">TodoItemModel</span><span class="p">[</span><span class="k">]&gt;</span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">SaveItemsToProfile</span><span class="p">(</span><span class="n">IUser</span> <span class="n">user</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TodoItemModel</span><span class="p">&gt;</span> <span class="n">todos</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">json</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">todos</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">());</span>

            <span class="n">user</span><span class="p">.</span><span class="n">Profile</span><span class="p">[</span><span class="n">TodoProfileKey</span><span class="p">]</span> <span class="p">=</span> <span class="n">json</span><span class="p">;</span>
            <span class="k">await</span> <span class="n">user</span><span class="p">.</span><span class="nf">UpdateAsync</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">AddItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">text</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_oktaClient</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="nf">GetUserAsync</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">existingItems</span> <span class="p">=</span> <span class="nf">GetItemsFromProfile</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ToList</span><span class="p">();</span>

            <span class="n">existingItems</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">TodoItemModel</span>
            <span class="p">{</span>
                <span class="n">Id</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">(),</span>
                <span class="n">Completed</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                <span class="n">Text</span> <span class="p">=</span> <span class="n">text</span>
            <span class="p">});</span>

            <span class="k">await</span> <span class="nf">SaveItemsToProfile</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">existingItems</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">DeleteItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_oktaClient</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="nf">GetUserAsync</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">updatedItems</span> <span class="p">=</span> <span class="nf">GetItemsFromProfile</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">item</span> <span class="p">=&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">Id</span> <span class="p">!=</span> <span class="n">id</span><span class="p">);</span>

            <span class="k">await</span> <span class="nf">SaveItemsToProfile</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">updatedItems</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TodoItemModel</span><span class="p">&gt;&gt;</span> <span class="nf">GetItems</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_oktaClient</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="nf">GetUserAsync</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
            <span class="k">return</span> <span class="nf">GetItemsFromProfile</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">UpdateItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">,</span> <span class="n">TodoItemModel</span> <span class="n">updatedData</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_oktaClient</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="nf">GetUserAsync</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">existingItems</span> <span class="p">=</span> <span class="nf">GetItemsFromProfile</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ToList</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">itemToUpdate</span> <span class="p">=</span> <span class="n">existingItems</span>
                <span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">item</span> <span class="p">=&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">itemToUpdate</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// Update the item with the new data</span>
            <span class="n">itemToUpdate</span><span class="p">.</span><span class="n">Completed</span> <span class="p">=</span> <span class="n">updatedData</span><span class="p">.</span><span class="n">Completed</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">updatedData</span><span class="p">.</span><span class="n">Text</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">itemToUpdate</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">updatedData</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">await</span> <span class="nf">SaveItemsToProfile</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">existingItems</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Okta custom profile fields only store primitives likes strings and numbers, but you’re using the <code class="highlighter-rouge">TodoModel</code> type to represent to-do items. This service serializes the <code class="highlighter-rouge">TodoModel</code> items to a JSON array and stores them as a string. It’s not the fastest data storage mechanism, but it works!</p>

<p>Since you’ve created a new service class, update the line in the <code class="highlighter-rouge">Startup.cs</code> file to use the <code class="highlighter-rouge">OktaTodoItemService</code> instead of the <code class="highlighter-rouge">FakeTodoItemService</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">ITodoItemService</span><span class="p">,</span> <span class="n">OktaTodoItemService</span><span class="p">&gt;();</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">TodoController</code> will now use the new service when it interacts with the <code class="highlighter-rouge">ITodoItemService</code> interface. Update the controller with some new code and methods:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// GET /api/todo</span>
<span class="na">[HttpGet]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">GetAllTodos</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"uid"</span><span class="p">)?.</span><span class="n">Value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">userId</span><span class="p">))</span> <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">();</span>

    <span class="kt">var</span> <span class="n">todos</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_todoItemService</span><span class="p">.</span><span class="nf">GetItems</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">todosInReverseOrder</span> <span class="p">=</span> <span class="n">todos</span><span class="p">.</span><span class="nf">Reverse</span><span class="p">();</span>

    <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">todosInReverseOrder</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// POST /api/todo</span>
<span class="na">[HttpPost]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">AddTodo</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="n">TodoItemModel</span> <span class="n">newTodo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">newTodo</span><span class="p">?.</span><span class="n">Text</span><span class="p">))</span> <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">();</span>

    <span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"uid"</span><span class="p">)?.</span><span class="n">Value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">userId</span><span class="p">))</span> <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">();</span>

    <span class="k">await</span> <span class="n">_todoItemService</span><span class="p">.</span><span class="nf">AddItem</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">newTodo</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>

    <span class="k">return</span> <span class="nf">Ok</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// POST /api/todo/{id}</span>
<span class="na">[HttpPost("{id}")]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">UpdateTodo</span><span class="p">(</span><span class="n">Guid</span> <span class="n">id</span><span class="p">,</span> <span class="p">[</span><span class="n">FromBody</span><span class="p">]</span><span class="n">TodoItemModel</span> <span class="n">updatedData</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"uid"</span><span class="p">)?.</span><span class="n">Value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">userId</span><span class="p">))</span> <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">();</span>

    <span class="k">await</span> <span class="n">_todoItemService</span><span class="p">.</span><span class="nf">UpdateItem</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">updatedData</span><span class="p">);</span>

    <span class="k">return</span> <span class="nf">Ok</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// DELETE /api/todo/{id}</span>
<span class="na">[HttpDelete("{id}")]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">DeleteTodo</span><span class="p">(</span><span class="n">Guid</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"uid"</span><span class="p">)?.</span><span class="n">Value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">userId</span><span class="p">))</span> <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">();</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">_todoItemService</span><span class="p">.</span><span class="nf">DeleteItem</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">Ok</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And add one more <code class="highlighter-rouge">using</code> statement at the top:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Vue2Spa.Models</span><span class="p">;</span>
</code></pre></div></div>

<p>In each method, the first step is to extract the user’s ID from the Bearer token attached to the incoming request. The ID is then passed along to the service method, and the Okta .NET SDK uses it to find the right user’s profile.</p>

<p>Finish out the frontend code by adding the last few actions to <code class="highlighter-rouge">actions.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nx">addTodo</span><span class="p">({</span> <span class="nx">dispatch</span> <span class="p">},</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
    <span class="s1">'/api/todo'</span><span class="p">,</span>
    <span class="p">{</span> <span class="na">text</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">text</span> <span class="p">},</span>
    <span class="kr">await</span> <span class="nx">addAuthHeader</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span><span class="p">))</span>

  <span class="kr">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">,</span> <span class="p">{</span> <span class="na">$auth</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span> <span class="p">})</span>
<span class="p">},</span>

<span class="k">async</span> <span class="nx">toggleTodo</span><span class="p">({</span> <span class="nx">dispatch</span> <span class="p">},</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
    <span class="s1">'/api/todo/'</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="p">{</span> <span class="na">completed</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">completed</span> <span class="p">},</span>
    <span class="kr">await</span> <span class="nx">addAuthHeader</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span><span class="p">))</span>

  <span class="kr">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">,</span> <span class="p">{</span> <span class="na">$auth</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span> <span class="p">})</span>
<span class="p">},</span>

<span class="k">async</span> <span class="nx">deleteTodo</span><span class="p">({</span> <span class="nx">dispatch</span> <span class="p">},</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">await</span> <span class="nx">axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">'/api/todo/'</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kr">await</span> <span class="nx">addAuthHeader</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span><span class="p">))</span>
  <span class="kr">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">,</span> <span class="p">{</span> <span class="na">$auth</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">$auth</span> <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Start the server once more with <code class="highlighter-rouge">dotnet run</code> and try adding a real to-do item to the list:</p>

<p><img src="/assets/blog/build-secure-todo-app-vuejs-aspnetcore/final-app-ae6521bb9cc48154a8e77d9a0419b775a1122161e6a1d4df086def669c514f9c.png" alt="Final to-do application" width="500" class="center-image" /></p>

<h2 id="build-secure-apps-with-aspnet-core-and-vuejs">Build Secure Apps with ASP.NET Core and Vue.js</h2>
<p>If you made it all the way to the end, congratulations! I’d love to hear about what you built. Shoot me a tweet <a href="https://twitter.com/nbarbettini">@nbarbettini</a> and tell me about it!</p>

<p>Feel free to download the final project’s <a href="https://github.com/oktadeveloper/okta-vuejs-aspnetcore-todo-example">code on GitHub</a>.</p>

<p>If you want to keep building, here’s what you could do next:</p>
<ul>
  <li>Add a form in Vue (and a controller on the backend) to let a new user create an account</li>
  <li>Store a timestamp when a new to-do item is added, and display it with each item</li>
  <li>Speed up the frontend by storing changes in the Vuex store immediately (before the API response arrives)</li>
</ul>

<p>For more Vue.js inspiration, check out some other recent posts:</p>

<ul>
  <li><a href="https://developer.okta.com/blog/2017/09/14/lazy-developers-guide-to-auth-with-vue">The Lazy Developer’s Guide to Authentication with Vue.js</a></li>
  <li><a href="https://developer.okta.com/blog/2017/09/06/build-a-cryptocurrency-comparison-site-with-vuejs">Build a Cryptocurrency Comparison Site with Vue.js</a></li>
</ul>

<p>Happy coding!</p>


    </div>

    
    <div id="disqus">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_title = 'Build a Secure To-Do App with Vue, ASP.NET Core, and Okta';
            var disqus_url = 'https://developer.okta.com/blog/2018/01/31/build-secure-todo-app-vuejs-aspnetcore';

            (function () {
                var dsq = document.createElement('script');
                dsq.async = true;
                dsq.type = 'text/javascript';
                dsq.src = '//oktadevblog.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>
              Please enable JavaScript to view the
              <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus</a>.
         </noscript>
    </div>
    
</article>

		
</section>

		
	</div><footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">
                <a href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">
                    <div class="Logo">
                        <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    </div>
                    <p>Visit okta.com</p>
                </a>
            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">
                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate-with-okta/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/change-log/">Change Log</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notices</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="https://developer.okta.com/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="https://developer.okta.com/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="https://developer.okta.com/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-aa397c892d9083236c5cb20732dde679021b9236c8142ce78177b8b184567a02.js"></script>
    <script type="text/javascript" src="/assets/myOkta-911cbafbbe079b7a5522d9cbe15bd2a5f44e1582531e88393934bec69f97696b.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/blog-6e32dad27404131cc8630a5282264bed2ab4c08c91ac86fa496b75c53aa4f681.js"></script>
    

  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
