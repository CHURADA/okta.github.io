<!doctype html>
<!--[if lt IE 7 ]> <html class="ie6 no-flexbox"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7 no-flexbox"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8 no-flexbox"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9 no-flexbox"> <![endif]-->
<!--[if IE 10 ]>    <html class="ie10 no-flexbox"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!--> <html class="modern wf-loading" lang="en"> <!--<![endif]-->
  <head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager
    }
  </script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="How to Secure Your .NET Web API with Token Authentication | Okta Developer">
  <meta class="swiftype" name="summary" data-type="string" content="API security can be complex. In many cases, jus..." />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-943074870de1efc80ec41db55bc8633148bcc085ddebad595e019ddc461dca51.css">
  
  
  <title>How to Secure Your .NET Web API with Token Authentication | Okta Developer</title>
  <meta name="description" content="API security can be complex. In many cases, jus...">
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#21313a">
  <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
</head>

  
    <body id="blog">
	




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first expanded">
          <a href="https://developer.okta.com/product/">Product</a>
          <ul class="menu">
            <li class="first leaf"><a href="https://developer.okta.com/product/">Overview</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authentication/">Authentication</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authorization/">Authorization</a></li>
            <li class="last leaf"><a href="https://developer.okta.com/product/user-management/">User Management</a></li>
          </ul>
        </li>
        <li class="leaf">
          <a href="https://developer.okta.com/pricing/">Pricing</a>
        </li>
        <li class="leaf">
          <a href="/blog/" class="active">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="last leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
            </g>
        </svg>
        <svg class="CloseIcon" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="ALl-Boards" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Desktop" transform="translate(-915.000000, -235.000000)" fill="#FFFFFF">
              <g id="Search-bar-Active" transform="translate(30.000000, 26.000000)">
                <polygon id="Icon/Cross" points="901 210.6 899.4 209 893 215.4 886.6 209 885 210.6 891.4 217 885 223.4 886.6 225 893 218.6 899.4 225 901 223.4 894.6 217"></polygon>
              </g>
            </g>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" rel="noopener noreferrer" href="https://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3Dhttps://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3D" class="Button--redOutline">Login</a>
        <a href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

	<div class="page-content">
		






<section class="Blog is-single">
		
	<div class="Blog-social">
		
		<a href="https://github.com/leebrandt" target="_blank"><i class="fa fa-github"></i></a>
		
		
		<a href="https://twitter.com/leebrandt" target="_blank"><i class="fa fa-twitter"></i></a>
		
		
		
		<a href="http://leebrandt.me" target="_blank"><i class="fa fa-external-link"></i></a>
		
	</div>
	
	

<article class="BlogPost">

    <header class="BlogPost-header">

        <time class="BlogPost-date" datetime="2018-02-01">February 1, 2018</time>

        <h1 class="BlogPost-title">
            
            How to Secure Your .NET Web API with Token Authentication
            
        </h1>

        <div class="BlogPost-attribution">
            
            <img src="/assets/avatar-leebrandt-23a647548f26433d031856dcef1df5204763b94283cd68c397d816a61363a94d.jpg" alt="avatar-leebrandt.jpg" class="BlogPost-avatar">
            
            <span class="BlogPost-author">Lee Brandt</span>
        </div>

    </header>

    <div class="BlogPost-content">
        
	<p>API security can be complex. In many cases, just because you’ve built an API that you want to make public, it doesn’t mean that you want just anybody accessing it. In most cases, you want fine-grained control over who can access the API, but setting up that kind of user management can be a daunting task: you’d have to create your own authorization service that can create API credentials for your users and have the ability to exchange those API credentials for an access token using OAuth 2.0. I’ve got good news! With just a few lines of code, Okta can handle all the complicated and time-consuming security elements and let you concentrate on creating a stellar API. =)</p>

<h2 id="understand-the-basic-flow">Understand the Basic Flow</h2>

<p>When handling authentication for a server-to-server API, you really only have two options: HTTP basic auth or OAuth 2.0 client credentials.</p>

<p>Because OAuth 2.0 is the most popular way to secure API services like the one we’ll be building today (and the only one that uses token authentication), we’ll be using that.</p>

<p>With OAuth 2.0 client credentials, authenticating a client app is two-step process: first, the client sends its API credentials (a client ID and secret) to an authorization server that returns an access token. Second, the client sends a request to the API with that access token and the API verifies it and either authorizes the call or rejects it with a <code class="highlighter-rouge">401 Unauthorized</code> response. In this tutorial, you’ll use Okta to manage your OAuth 2.0 server and rely on Okta’s default authorization server to create access tokens using API credentials (aka: client credentials) also created by Okta.</p>

<h2 id="install-net-core-20">Install .NET Core 2.0</h2>
<p>For this tutorial, you’ll be using version 2.0 of the .NET Core framework to create a .NET Core MVC application that will be the client, and a .NET core Web API that the client will call. To make sure you have .NET Core 2.0 installed, you can open a command window and run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet <span class="nt">--version</span>
</code></pre></div></div>

<p>Ensure that you see <code class="highlighter-rouge">2.0.0</code> in the output. If you don’t, you can install it from <a href="https://dot.net/core">here</a>.</p>

<p>I will be running everything from Visual Studio Code, but it can easily be done from Visual Studio if you have access to that.</p>

<h2 id="create-the-api">Create the API</h2>

<p>In the folder where you want to keep source code, create a folder called <code class="highlighter-rouge">webapi-okta-example</code> and change into that directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir webapi-okta-example 
<span class="nb">cd </span>webapi-okta-example
</code></pre></div></div>

<p>Create a directory to hold the API project called <code class="highlighter-rouge">api</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir api
<span class="nb">cd </span>api
dotnet new webapi
</code></pre></div></div>

<p>Create a directory in the <code class="highlighter-rouge">webapi-okta-example</code> folder to house the MVC app called <code class="highlighter-rouge">app</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir app
<span class="nb">cd </span>app
dotnet new mvc
</code></pre></div></div>

<p>For development on the same machine, you’ll also need to tell the MVC app to run on another port, because the API will be running on port 5000. To do this, go to the <code class="highlighter-rouge">Program.cs</code> file in the MVC application and add the <code class="highlighter-rouge">UseUrls()</code> method, so that your <code class="highlighter-rouge">BuildWebHost</code> method looks like this:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">static</span> <span class="n">IWebHost</span> <span class="nf">BuildWebHost</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="n">WebHost</span><span class="p">.</span><span class="nf">CreateDefaultBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                <span class="p">.</span><span class="n">UseStartup</span><span class="p">&lt;</span><span class="n">Startup</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="nf">UseUrls</span><span class="p">(</span><span class="s">"http://localhost:5050"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">Build</span><span class="p">();</span>
</code></pre></div></div>

<p>Now, you should be able to fire them both up (with <code class="highlighter-rouge">dotnet run</code> from the command prompt, or just F5 in Visual Studio or Visual Studio Code) and see them both run independently.</p>

<h2 id="set-up-the-app-in-okta">Set Up the App in Okta</h2>

<p>If you don’t already have an account with Okta, set up your free-forever developer account at <a href="https://developer.okta.com/signup/">https://developer.okta.com/signup/</a>. Once you’ve logged into the dashboard, click on the <strong>Applications</strong> menu item, then click <strong>Add Application</strong>.</p>

<p><img src="/assets/blog/webapi-token-auth/AddApplication-e7cafc6340ba1091f7cde2573375d8232f710b030232dfd723683fb8b9491478.png" alt="Add Application Screen" width="800" class="center-image" /></p>

<p>From the Create New Application screen choose <strong>Service</strong>, and click <strong>Next</strong>.</p>

<p><img src="/assets/blog/webapi-token-auth/CreateServiceScreen-b6af36dc4d327d601c7e47bad20f86f2edee040b35e7ca7c02c0fe5a4236c205.png" alt="Create Service Screen" width="800" class="center-image" /></p>

<p>Name the application “API Sample App”, and click <strong>Done</strong>.</p>

<p><img src="/assets/blog/webapi-token-auth/NameServiceScreen-3fb462bdf1cd858c4405f7e202f0cc2537a0a3235b0512b14717e41a4e32f8dd.png" alt="Name Service Screen" width="800" class="center-image" /></p>

<p>On the API Sample App’s general settings, you will see the Client Credentials box with the client ID and client secret in it. You will use these to authenticate a client wishing to call your API.</p>

<p><img src="/assets/blog/webapi-token-auth/ApplicationGeneralSettings-eb4cc70d85affc8001be173a705e73d2461592475a973d962e557c4350bbabb5.png" alt="General Settings Screen" width="800" class="center-image" /></p>

<blockquote>
  <p>For each client that you’ll want to have access to the API, you’ll need to create an Okta application for it, and give it the Client ID and Client Secret.</p>
</blockquote>

<h2 id="set-up-your-app-to-use-okta-client-credentials">Set Up Your App To Use Okta Client Credentials</h2>

<p>In this case, the client of the API is the ASP.NET MVC application. Open the <code class="highlighter-rouge">app</code> folder in your IDE. Open the <code class="highlighter-rouge">appsettings.Development.json</code> file and add your Okta client information like so:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"Logging"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"IncludeScopes"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"LogLevel"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"Default"</span><span class="p">:</span> <span class="s2">"Debug"</span><span class="p">,</span>
      <span class="s2">"System"</span><span class="p">:</span> <span class="s2">"Information"</span><span class="p">,</span>
      <span class="s2">"Microsoft"</span><span class="p">:</span> <span class="s2">"Information"</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">"Okta"</span><span class="p">:</span> <span class="p">{</span> 
    <span class="s2">"TokenUrl"</span><span class="p">:</span> <span class="s2">"https://{yourOktaDomain}/oauth2/default/v1/token"</span><span class="p">,</span> 
    <span class="s2">"ClientId"</span><span class="p">:</span> <span class="s2">"{yourClientId}"</span><span class="p">,</span> 
    <span class="s2">"ClientSecret"</span><span class="p">:</span> <span class="s2">"{yourClientSecret}"</span> 
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">TokenUrl</code> property is the url to your default Authorization Server. You can find this in Okta by going to the dashboard and hovering over the API menu item in the menu bar, then choosing Authorization Servers from the drop down menu. The Issuer URI for the “default” server is the URI used for the <code class="highlighter-rouge">TokenUrl</code> property. The <code class="highlighter-rouge">ClientId</code> and <code class="highlighter-rouge">ClientSecret</code> properties are from the General Settings page of your API application in Okta.</p>

<p>In the “Models” folder of the application add a new class file called <code class="highlighter-rouge">OktaSettings.cs</code>. The contents of the class are:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">app.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">OktaSettings</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">TokenUrl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">ClientId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">ClientSecret</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This will allow you to read those configuration values into a C# object, making it easier to use in your application. To make it even easier, add this new object to the services that can be injected by adding it to the <code class="highlighter-rouge">ConfigureServices()</code> method in the <code class="highlighter-rouge">Startup.cs</code> file.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">OktaSettings</span><span class="p">&gt;(</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetSection</span><span class="p">(</span><span class="s">"Okta"</span><span class="p">));</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddMvc</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This will add the settings object as injectable <code class="highlighter-rouge">IOptions</code> into the constructor of any class that needs them. In this case, it will be an Okta-specific token service.</p>

<h2 id="create-the-token-service">Create The Token Service</h2>

<p>What you need here is a service that can live with the application lifecycle and either get a new access token, or return one that it already has. To do this, create an <code class="highlighter-rouge">ITokenService</code> interface and an <code class="highlighter-rouge">OktaTokenService</code> implementation class inside a new folder at the root of your MVC app called “Services”.</p>

<p>The <code class="highlighter-rouge">ITokenService</code> only needs one method: a method that returns an access token, call it <code class="highlighter-rouge">GetToken()</code>.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">app.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">ITokenService</span>
    <span class="p">{</span>
         <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">GetToken</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The implementation will decide whether or not to get a <em>new</em> access token, or return one that it has previously received.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">OktaTokenService</span> <span class="p">:</span> <span class="n">ITokenService</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">OktaToken</span> <span class="n">token</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OktaToken</span><span class="p">();</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">IOptions</span><span class="p">&lt;</span><span class="n">OktaSettings</span><span class="p">&gt;</span> <span class="n">oktaSettings</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">OktaTokenService</span><span class="p">(</span><span class="n">IOptions</span><span class="p">&lt;</span><span class="n">OktaSettings</span><span class="p">&gt;</span> <span class="n">oktaSettings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">oktaSettings</span> <span class="p">=</span> <span class="n">oktaSettings</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">GetToken</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">IsValidAndNotExpiring</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">token</span> <span class="p">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetNewAccessToken</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">token</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This first pass at the Okta token service starts by getting the <code class="highlighter-rouge">oktaSettings</code> injected from the application services. It also has a class-level variable that will hold the <code class="highlighter-rouge">OktaToken</code> object (which you’ll create in a moment). The <code class="highlighter-rouge">GetToken()</code> method merely checks to see if the token is valid and not expired (or expiring soon) and either gets a new access token, or just returns the current one.</p>

<p>Next, you’ll need to implement the <code class="highlighter-rouge">OktaToken</code> object. You can just nest it inside this class, since it will be the only consumer of this object. This will serve as a container for the response from the Authorization Service.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">class</span> <span class="nc">OktaToken</span>
<span class="p">{</span>
  <span class="p">[</span><span class="nf">JsonProperty</span><span class="p">(</span><span class="n">PropertyName</span> <span class="p">=</span> <span class="s">"access_token"</span><span class="p">)]</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">AccessToken</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

  <span class="p">[</span><span class="nf">JsonProperty</span><span class="p">(</span><span class="n">PropertyName</span> <span class="p">=</span> <span class="s">"expires_in"</span><span class="p">)]</span>
  <span class="k">public</span> <span class="kt">int</span> <span class="n">ExpiresIn</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  
  <span class="k">public</span> <span class="n">DateTime</span> <span class="n">ExpiresAt</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">public</span> <span class="kt">string</span> <span class="n">Scope</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

  <span class="p">[</span><span class="nf">JsonProperty</span><span class="p">(</span><span class="n">PropertyName</span> <span class="p">=</span> <span class="s">"token_type"</span><span class="p">)]</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">TokenType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsValidAndNotExpiring</span> 
  <span class="p">{</span> 
    <span class="k">get</span> 
    <span class="p">{</span>
      <span class="k">return</span> <span class="p">!</span><span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">)</span> <span class="p">&amp;&amp;</span> 
<span class="k">this</span><span class="p">.</span><span class="n">ExpiresAt</span> <span class="p">&gt;</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="nf">AddSeconds</span><span class="p">(</span><span class="m">30</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You’ll notice the <code class="highlighter-rouge">JsonProperty</code> attributes on several of the properties here. This is because, by default the JSON deserialize will match properties from camel-case (camelCase) to pascal-cased (PascalCase), but the properties returned in the token response are snake-cased (snake_case), so this tell the serializer what’s going on. Also, there is a <code class="highlighter-rouge">IsValidAndNotExpiring</code>, read-only property that ensures there is a value for the access token and that it is not expired, or expiring in the next 30 seconds. You can vary this value base on your use case.</p>

<blockquote>
  <p>You could just always make the API called and if it comes back with a <code class="highlighter-rouge">401 Unauthorized</code> response, go and get a new access token then. The approach of checking to see if it’s expiring soon is simple and cuts down on failed calls in the logs.</p>
</blockquote>

<p>Finally, the <code class="highlighter-rouge">OktaTokenService</code> class needs the <code class="highlighter-rouge">GetNewAccessToken()</code> method, in case it either doesn’t currently have an access token, or it is expired or expiring soon. This method will call your Authorization Server’s <code class="highlighter-rouge">token</code> endpoint to get a new access token.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">OktaToken</span><span class="p">&gt;</span> <span class="nf">GetNewAccessToken</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OktaToken</span><span class="p">();</span>
  <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>
  <span class="kt">var</span> <span class="n">client_id</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">oktaSettings</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">ClientId</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">client_secret</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">oktaSettings</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">ClientSecret</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">clientCreds</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">client_id</span><span class="p">}</span><span class="s">:</span><span class="p">{</span><span class="n">client_secret</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
  <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="n">Authorization</span> <span class="p">=</span> 
  	<span class="k">new</span> <span class="nf">AuthenticationHeaderValue</span><span class="p">(</span><span class="s">"Basic"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Convert</span><span class="p">.</span><span class="nf">ToBase64String</span><span class="p">(</span><span class="n">clientCreds</span><span class="p">));</span>

  <span class="kt">var</span> <span class="n">postMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
  <span class="n">postMessage</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"grant_type"</span><span class="p">,</span> <span class="s">"client_credentials"</span><span class="p">);</span>
  <span class="n">postMessage</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"scope"</span><span class="p">,</span> <span class="s">"access_token"</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpRequestMessage</span><span class="p">(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="n">Post</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">oktaSettings</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">TokenUrl</span><span class="p">)</span>
  <span class="p">{</span> 
    <span class="n">Content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FormUrlEncodedContent</span><span class="p">(</span><span class="n">postMessage</span><span class="p">)</span>
  <span class="p">};</span>

  <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">SendAsync</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">IsSuccessStatusCode</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kt">var</span> <span class="n">json</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="n">token</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">DeserializeObject</span><span class="p">&lt;</span><span class="n">OktaToken</span><span class="p">&gt;(</span><span class="n">json</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">ExpiresAt</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="nf">AddSeconds</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">ExpiresIn</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ApplicationException</span><span class="p">(</span><span class="s">"Unable to retrieve access token from Okta"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">token</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>A lot of this method is setting up the <code class="highlighter-rouge">HttpClient</code> to make the call to the Authorization Service. The interesting parts are the <code class="highlighter-rouge">clientCreds</code> value that gets the bytes of a string that has the client ID and secret concatenated with a colon between them as <CLIENT_ID>:<CLIENT_SECRET>. That value is then base64 encoded when it's added to the `Authorization` header with "Basic " in front of it. _Note that the word "basic" is NOT encoded._</CLIENT_SECRET></CLIENT_ID></p>

<p>There are also two key-value pairs sent as <code class="highlighter-rouge">FormUrlEncodedContent</code>: the <code class="highlighter-rouge">grant_type</code> which has a value of “client_credentials”, and the <code class="highlighter-rouge">scope</code> which has a value of “access_token”. This simply tells the Authorization Server that you are sending client credentials and you want to get an access token in exchange.</p>

<p>The entire contents of the <code class="highlighter-rouge">OktaTokenService</code> <em>(with using directives)</em> should look like this:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http.Headers</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">app.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Extensions.Options</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">app.Services</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">OktaTokenService</span> <span class="p">:</span> <span class="n">ITokenService</span>
  <span class="p">{</span>
    <span class="k">private</span> <span class="n">OktaToken</span> <span class="n">token</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OktaToken</span><span class="p">();</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">IOptions</span><span class="p">&lt;</span><span class="n">OktaSettings</span><span class="p">&gt;</span> <span class="n">oktaSettings</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">OktaTokenService</span><span class="p">(</span><span class="n">IOptions</span><span class="p">&lt;</span><span class="n">OktaSettings</span><span class="p">&gt;</span> <span class="n">oktaSettings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">oktaSettings</span> <span class="p">=</span> <span class="n">oktaSettings</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">GetToken</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">IsValidAndNotExpiring</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">token</span> <span class="p">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetNewAccessToken</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">token</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">OktaToken</span><span class="p">&gt;</span> <span class="nf">GetNewAccessToken</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OktaToken</span><span class="p">();</span>
      <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>
      <span class="kt">var</span> <span class="n">client_id</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">oktaSettings</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">ClientId</span><span class="p">;</span>
      <span class="kt">var</span> <span class="n">client_secret</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">oktaSettings</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">ClientSecret</span><span class="p">;</span>
      <span class="kt">var</span> <span class="n">clientCreds</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">client_id</span><span class="p">}</span><span class="s">:</span><span class="p">{</span><span class="n">client_secret</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
      <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="n">Authorization</span> <span class="p">=</span> 
      	<span class="k">new</span> <span class="nf">AuthenticationHeaderValue</span><span class="p">(</span><span class="s">"Basic"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Convert</span><span class="p">.</span><span class="nf">ToBase64String</span><span class="p">(</span><span class="n">clientCreds</span><span class="p">));</span>

      <span class="kt">var</span> <span class="n">postMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
      <span class="n">postMessage</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"grant_type"</span><span class="p">,</span> <span class="s">"client_credentials"</span><span class="p">);</span>
      <span class="n">postMessage</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"scope"</span><span class="p">,</span> <span class="s">"access_token"</span><span class="p">);</span>
      <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpRequestMessage</span><span class="p">(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="n">Post</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">oktaSettings</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">TokenUrl</span><span class="p">)</span>
      <span class="p">{</span> 
        <span class="n">Content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FormUrlEncodedContent</span><span class="p">(</span><span class="n">postMessage</span><span class="p">)</span>
      <span class="p">};</span>

      <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">SendAsync</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">IsSuccessStatusCode</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="kt">var</span> <span class="n">json</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>
        <span class="n">token</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">DeserializeObject</span><span class="p">&lt;</span><span class="n">OktaToken</span><span class="p">&gt;(</span><span class="n">json</span><span class="p">);</span>
        <span class="n">token</span><span class="p">.</span><span class="n">ExpiresAt</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="nf">AddSeconds</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">ExpiresIn</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ApplicationException</span><span class="p">(</span><span class="s">"Unable to retrieve access token from Okta"</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="n">token</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">class</span> <span class="nc">OktaToken</span>
    <span class="p">{</span>
      <span class="p">[</span><span class="nf">JsonProperty</span><span class="p">(</span><span class="n">PropertyName</span> <span class="p">=</span> <span class="s">"access_token"</span><span class="p">)]</span>
      <span class="k">public</span> <span class="kt">string</span> <span class="n">AccessToken</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

      <span class="p">[</span><span class="nf">JsonProperty</span><span class="p">(</span><span class="n">PropertyName</span> <span class="p">=</span> <span class="s">"expires_in"</span><span class="p">)]</span>
      <span class="k">public</span> <span class="kt">int</span> <span class="n">ExpiresIn</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
      
      <span class="k">public</span> <span class="n">DateTime</span> <span class="n">ExpiresAt</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

      <span class="k">public</span> <span class="kt">string</span> <span class="n">Scope</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

      <span class="p">[</span><span class="nf">JsonProperty</span><span class="p">(</span><span class="n">PropertyName</span> <span class="p">=</span> <span class="s">"token_type"</span><span class="p">)]</span>
      <span class="k">public</span> <span class="kt">string</span> <span class="n">TokenType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

      <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsValidAndNotExpiring</span> 
      <span class="p">{</span> 
        <span class="k">get</span> 
        <span class="p">{</span>
          <span class="k">return</span> <span class="p">!</span><span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">t</span>
<span class="n">his</span><span class="p">.</span><span class="n">ExpiresAt</span> <span class="p">&gt;</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="nf">AddSeconds</span><span class="p">(</span><span class="m">30</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="register-the-token-service">Register the Token Service</h2>

<p>To make the token service available to classes that need it, add another line to your <code class="highlighter-rouge">ConfigureServices()</code> method in Startup.cs so that it now looks like this.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">OktaSettings</span><span class="p">&gt;(</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetSection</span><span class="p">(</span><span class="s">"Okta"</span><span class="p">));</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">ITokenService</span><span class="p">,</span> <span class="n">OktaTokenService</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddMvc</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="create-an-api-service">Create an API Service</h2>

<p>The token service will help you get an access token from the Authorization Server, but then you need to call the API with your newly minted token. Follow the same pattern as the token service by creating an <code class="highlighter-rouge">IApiService</code> interface and a <code class="highlighter-rouge">SimpleApiService</code> implementation class for it. The complete interface looks like:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">app.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IApiService</span>
    <span class="p">{</span>
         <span class="n">Task</span><span class="p">&lt;</span><span class="n">IList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="nf">GetValues</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This API service simply has a <code class="highlighter-rouge">GetValues()</code> method that will call the API and return a list of strings from the <code class="highlighter-rouge">/api/values</code> endpoint. The implementation class contains:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http.Headers</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">app.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">app.Services</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">SimpleApiService</span> <span class="p">:</span> <span class="n">IApiService</span>
  <span class="p">{</span>
    <span class="k">private</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">ITokenService</span> <span class="n">tokenService</span><span class="p">;</span>
    <span class="k">public</span> <span class="nf">SimpleApiService</span><span class="p">(</span><span class="n">ITokenService</span> <span class="n">tokenService</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="n">tokenService</span> <span class="p">=</span> <span class="n">tokenService</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="nf">GetValues</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">values</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
      <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="n">tokenService</span><span class="p">.</span><span class="nf">GetToken</span><span class="p">();</span>
      <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="n">Authorization</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AuthenticationHeaderValue</span><span class="p">(</span><span class="s">"Bearer"</span><span class="p">,</span> <span class="n">token</span><span class="p">);</span>
      <span class="kt">var</span> <span class="n">res</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="s">"http://localhost:5000/api/values"</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">IsSuccessStatusCode</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="kt">var</span> <span class="n">json</span> <span class="p">=</span> <span class="n">res</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">().</span><span class="n">Result</span><span class="p">;</span>
        <span class="n">values</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">DeserializeObject</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;&gt;(</span><span class="n">json</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="n">values</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;{</span><span class="n">res</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(),</span> <span class="n">res</span><span class="p">.</span><span class="n">ReasonPhrase</span><span class="p">};</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">values</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Again, much of this is setting up an <code class="highlighter-rouge">HttpClient</code> to make the API call (looks ripe for a refactor, but we’re okay for this demo). The real things of interest here are the <code class="highlighter-rouge">AuthenticationHeaderValue</code> with “Bearer” at the beginning and the access token. Also, the values returned from the API are deserialized into a list of strings to be returned.</p>

<p>As with the other services, add this to the <code class="highlighter-rouge">ConfigureServices()</code> method in <code class="highlighter-rouge">Startup.cs</code>, so that the final version of this method looks like:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">OktaSettings</span><span class="p">&gt;(</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetSection</span><span class="p">(</span><span class="s">"Okta"</span><span class="p">));</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">ITokenService</span><span class="p">,</span> <span class="n">OktaTokenService</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IApiService</span><span class="p">,</span> <span class="n">SimpleApiService</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddMvc</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="add-the-api-call-to-the-mvc-application">Add the API Call to the MVC Application</h2>

<p>Lastly for the client application, you’ll need to use the newly created services, in this case it will be in the <code class="highlighter-rouge">HomeController.cs</code>. Add the API service to the constructor, then just change the <code class="highlighter-rouge">Index()</code> action to return a <code class="highlighter-rouge">Task&lt;IActionResult&gt;</code> and call the API service to get the values.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">readonly</span> <span class="n">IApiService</span> <span class="n">apiService</span><span class="p">;</span>
<span class="k">public</span> <span class="nf">HomeController</span><span class="p">(</span><span class="n">IApiService</span> <span class="n">apiService</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="n">apiService</span> <span class="p">=</span> <span class="n">apiService</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">Index</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">values</span> <span class="p">=</span> <span class="k">await</span> <span class="n">apiService</span><span class="p">.</span><span class="nf">GetValues</span><span class="p">();</span>
  <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">values</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Then you just need to display those values in the view. Remove everything from the <code class="highlighter-rouge">Index.cshtml</code> view except the carousel and add the values to the page right below the carousel.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        @foreach(var value in Model)
        {
            <span class="nt">&lt;li&gt;</span>@value<span class="nt">&lt;/li&gt;</span>
        }
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Now you have the ASP.NET MVC application calling the API with a good access token every time.</p>

<p>The API is not receiving or doing anything to validate the access token yet, so your API is still “open”. All that is left to do is get the API to receive and validate the token!</p>

<h2 id="get-the-api-to-validate-the-access-token">Get the API to Validate the Access Token</h2>

<p>There are two main ways to validate the access token: call the Okta API’s <code class="highlighter-rouge">introspect</code> endpoint, or validate the token locally. ASP.NET already has some JWT validation stuff built in. Calling the Okta API has the advantage of being very specific, and most secure way. It does have the disadvantage that you’ll need to make another API call. Using the local JWT validation built in to .NET means you don’t have to call the API, but is less secure. For the purposes of the demo, it’s secure enough, so you that here. In the <code class="highlighter-rouge">ConfigureServices()</code> method of the API project add the following <em>before</em> the <code class="highlighter-rouge">services.AddMvc();</code> line.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddAuthentication</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
	<span class="n">options</span><span class="p">.</span><span class="n">DefaultScheme</span> <span class="p">=</span> <span class="n">JwtBearerDefaults</span><span class="p">.</span><span class="n">AuthenticationScheme</span><span class="p">;</span>
<span class="p">})</span>
<span class="p">.</span><span class="nf">AddJwtBearer</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
	<span class="n">options</span><span class="p">.</span><span class="n">Authority</span> <span class="p">=</span> <span class="s">"https://{yourOktaDomain}/oauth2/default"</span><span class="p">;</span>
	<span class="n">options</span><span class="p">.</span><span class="n">Audience</span> <span class="p">=</span> <span class="s">"api://default"</span><span class="p">;</span>
	<span class="n">options</span><span class="p">.</span><span class="n">RequireHttpsMetadata</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>The second service tells the app that you want to use JWT-based authentication and the options for the JwtBearer middleware gives the authentication scheme some information it can use to validate the token is authentic. The audience comes from the Authorization Server page in Okta.</p>

<p>Finally, add the <code class="highlighter-rouge">Authorize</code> attribute to any controller or action you want to protect.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">[Authorize]</span>
<span class="na">[Route("api/[controller]</span><span class="s">")]
</span><span class="k">public</span> <span class="k">class</span> <span class="nc">ValuesController</span> <span class="p">:</span> <span class="n">Controller</span>
<span class="p">{</span>
	<span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can now run the API and try to hit it with a browser. You’ll see a screen that says the page isn’t working with an HTTP error of 401.</p>

<p><img src="/assets/blog/webapi-token-auth/RunningApiWithValidation-5eb5fa21e726f815a7eaad27bd1b4213b4a3e60a8d5c0a56408229d7541a76aa.png" alt="API failing in Browser" width="800" class="center-image" /></p>

<p>That’s it! If you run your app you will see the application displaying the values as before. You now have an API that is protected with access tokens provided by Okta, and only the worthy shall pass.</p>

<p><img src="/assets/blog/webapi-token-auth/ProtectedService-4068c62b0cf9c9155973a91afff34587c92a5883c1ca12185c425a7fa0ba769b.png" alt="App calling protected API" width="800" class="center-image" /></p>

<h2 id="learn-more">Learn More</h2>

<p>Interested in learning more about API access management or building secure applications with Okta? Check out our <a href="https://developer.okta.com/use_cases/api_access_management/">Product Documentation</a> or any of these great resources:</p>
<ul>
  <li>Discover how the .NET Authentication middleware <a href="https://docs.microsoft.com/en-us/aspnet/core/migration/1x-to-2x/identity-2x">has changed from Core 1.0 to Core 2.0</a></li>
  <li>Learn about the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.authentication.jwtbearer?view=aspnetcore-2.0">.NET JwtBearer Namespace</a></li>
  <li>Read about <a href="/blog/2017/04/17/angular-authentication-with-oidc">Angular Authentication with OIDC</a></li>
  <li>And how to <a href="/blog/2017/03/30/react-okta-sign-in-widget">Build a React Application With Authentication</a></li>
</ul>


    </div>

    
    <div id="disqus">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_title = 'How to Secure Your .NET Web API with Token Authentication';
            var disqus_url = 'https://developer.okta.com/blog/2018/02/01/secure-aspnetcore-webapi-token-auth';

            (function () {
                var dsq = document.createElement('script');
                dsq.async = true;
                dsq.type = 'text/javascript';
                dsq.src = '//oktadevblog.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>
              Please enable JavaScript to view the
              <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus</a>.
         </noscript>
    </div>
    
</article>

		
</section>

		
	</div><footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">

                <a class="Logo" href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">
                    <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    Visit okta.com
                </a>

            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">

                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate-with-okta/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/change-log/">Change Log</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notices</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="https://developer.okta.com/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="https://developer.okta.com/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="https://developer.okta.com/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-aa397c892d9083236c5cb20732dde679021b9236c8142ce78177b8b184567a02.js"></script>
    <script type="text/javascript" src="/assets/myOkta-911cbafbbe079b7a5522d9cbe15bd2a5f44e1582531e88393934bec69f97696b.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/blog-6e32dad27404131cc8630a5282264bed2ab4c08c91ac86fa496b75c53aa4f681.js"></script>
    

  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
