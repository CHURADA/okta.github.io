<!doctype html>
<!--[if lt IE 7 ]> <html class="ie6 no-flexbox"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7 no-flexbox"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8 no-flexbox"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9 no-flexbox"> <![endif]-->
<!--[if IE 10 ]>    <html class="ie10 no-flexbox"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!--> <html class="modern wf-loading" lang="en"> <!--<![endif]-->
  <head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager

      // Start Heap Analytics
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load("3356162945");
      // End Heap Analytics
    }
  </script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="Build a CRUD app with ASP.NET Core and Angular | Okta Developer">
  <meta class="swiftype" name="summary" data-type="string" content="ASP.NET Core and Angular are powerful frameworks for backend and frontend development. Learn how to put them together to build a modern web app, and secure it with Okta." />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-914cad2dd6d069302444327ce911da52da68a3c68755f66cf5a4e92b9a38f3eb.css">
  
  
  <title>Build a CRUD app with ASP.NET Core and Angular | Okta Developer</title>
  <meta name="description" content="ASP.NET Core and Angular are powerful frameworks for backend and frontend development. Learn how to put them together to build a modern web app, and secure it with Okta.">
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#21313a">
  <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
</head>

  
    <body id="blog">
	




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first expanded">
          <a href="https://developer.okta.com/product/">Product</a>
          <ul class="menu">
            <li class="first leaf"><a href="https://developer.okta.com/product/">Overview</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authentication/">Authentication</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authorization/">Authorization</a></li>
            <li class="last leaf"><a href="https://developer.okta.com/product/user-management/">User Management</a></li>
          </ul>
        </li>
        <li class="leaf">
          <a href="https://developer.okta.com/pricing/">Pricing</a>
        </li>
        <li class="leaf">
          <a href="/blog/" class="active">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="last leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
            </g>
        </svg>
        <svg class="CloseIcon" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="ALl-Boards" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Desktop" transform="translate(-915.000000, -235.000000)" fill="#FFFFFF">
              <g id="Search-bar-Active" transform="translate(30.000000, 26.000000)">
                <polygon id="Icon/Cross" points="901 210.6 899.4 209 893 215.4 886.6 209 885 210.6 891.4 217 885 223.4 886.6 225 893 218.6 899.4 225 901 223.4 894.6 217"></polygon>
              </g>
            </g>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" rel="noopener noreferrer" href="https://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3Dhttps://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3D" class="Button--redOutline">Login</a>
        <a href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

	<div class="page-content">
		
		






<section class="Blog is-single">
		
	<div class="Blog-social">
		
		<a href="https://github.com/oktadeveloper" target="_blank"><i class="fa fa-github"></i></a>
		
		
		
		
	</div>
	
	

<article class="BlogPost">

    <header class="BlogPost-header">

        <time class="BlogPost-date" datetime="2018-04-26">April 26, 2018</time>

        <h1 class="BlogPost-title">
            
            Build a CRUD app with ASP.NET Core and Angular
            
        </h1>

        <div class="BlogPost-attribution">
            
            <img src="/assets/avatar-oktadev-de250fc0e9347b4dcf0087b9ec1a0e3aee8092b2f516e45fce0529926a5cde0f.png" alt="avatar-oktadev.png" class="BlogPost-avatar">
            
            <span class="BlogPost-author">Team Okta</span>
        </div>

    </header>

    <div class="BlogPost-content">
        
	<p>A lot of applications today are built with an API on the backend, and then a single page application on the front end. This is a good approach because it allows you a ton of flexibility. For example, if you get a requirement to build a native mobile client later on: it’s easy, you already have the server side in place.</p>

<p>Today you’ll use ASP.NET Core 2.0 on the server side, and Angular 5 on the client side to build a basic CRUD app to track workouts, specifically jogging! You will create a <strong>Backend</strong> folder for the ASP.NET Core 2.0 project, and a <strong>Frontend</strong> folder for the Angular part of the project.</p>

<h2 id="create-a-rest-api-in-aspnet-core-20">Create a REST API in ASP.NET Core 2.0</h2>
<p>Let’s start by building the back end first. For my IDE I am using Visual Studio 2017, so all the screenshots will be from there. If you’re using something else, you should be able to easily find similar options.</p>

<p>Start with File &gt; New Project, and choose ASP.NET Core Web Application. Choose .NET Core, version 2.0 and the Web API template.</p>

<p><img src="/assets/blog/build-crud-app-aspnetcore-angular/new-project-6143374ca7778a0272e26470286f8bc80a2a80f64bc7049f045bd82d93d6a97b.jpg" alt="Visual Studio New Project dialog" width="600" class="center-image" /></p>

<p>Pick “No authentication”. You’ll add authentication later.</p>

<h3 id="build-a-model-for-your-aspnet-core-app">Build a Model for Your ASP.NET Core App</h3>
<p>Let’s build some data. Your application will store data about your workouts, specifically the date of the workout, the distance covered, and the time it took (in seconds).</p>

<p>So, create a folder called Models, and in there build a Workout class in a file called <code class="highlighter-rouge">Workout.cs</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Workout</span>
 <span class="p">{</span>
     <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

     <span class="k">public</span> <span class="n">DateTimeOffset</span> <span class="n">Date</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

     <span class="k">public</span> <span class="kt">int</span> <span class="n">DistanceInMeters</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

     <span class="k">public</span> <span class="kt">long</span> <span class="n">TimeInSeconds</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div></div>

<h3 id="add-a-new-controller">Add a New Controller</h3>
<p>Next, let’s add a controller. Right click the “Controllers” folder, choose “Add” and “Controller”. Visual Studio will offer the option to add an API Controller with actions using Entity Framework Core - choose that. Pick the model (the Workout class), and set the controller name to WorkoutsController. For the database context, click + for a new one and call it WorkoutContext.</p>

<h3 id="check-the-database-context">Check the Database Context</h3>
<p>A Data folder has been created, and in it a file called <code class="highlighter-rouge">WorkoutContext.cs</code>. It’s contents are:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">WorkoutContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">WorkoutContext</span> <span class="p">(</span><span class="n">DbContextOptions</span><span class="p">&lt;</span><span class="n">WorkoutContext</span><span class="p">&gt;</span> <span class="n">options</span><span class="p">)</span>
            <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Backend</span><span class="p">.</span><span class="n">Models</span><span class="p">.</span><span class="n">Workout</span><span class="p">&gt;</span> <span class="n">Workout</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>It has created a database context, and added a database set of type Workout to the context. This database context provides a way for your C# code to access your database.</p>

<h3 id="add-a-workout-controller">Add a Workout Controller</h3>
<p>In the Controllers folder Visual Studio has created a <code class="highlighter-rouge">WorkoutController.cs</code> with the following code:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">Backend.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Produces</span><span class="p">(</span><span class="s">"application/json"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"api/Workouts"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">WorkoutsController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">WorkoutContext</span> <span class="n">_context</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">WorkoutsController</span><span class="p">(</span><span class="n">WorkoutContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_context</span> <span class="p">=</span> <span class="n">context</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// GET: api/Workouts</span>
        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Workout</span><span class="p">&gt;</span> <span class="nf">GetWorkout</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// GET: api/Workouts/5</span>
        <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">GetWorkout</span><span class="p">([</span><span class="n">FromRoute</span><span class="p">]</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="n">ModelState</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">workout</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">.</span><span class="nf">SingleOrDefaultAsync</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">workout</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">workout</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// PUT: api/Workouts/5</span>
        <span class="p">[</span><span class="nf">HttpPut</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">PutWorkout</span><span class="p">([</span><span class="n">FromRoute</span><span class="p">]</span> <span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="p">[</span><span class="n">FromBody</span><span class="p">]</span> <span class="n">Workout</span> <span class="n">workout</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="n">ModelState</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="p">!=</span> <span class="n">workout</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="n">_context</span><span class="p">.</span><span class="nf">Entry</span><span class="p">(</span><span class="n">workout</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Modified</span><span class="p">;</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">DbUpdateConcurrencyException</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(!</span><span class="nf">WorkoutExists</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="k">throw</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nf">NoContent</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// POST: api/Workouts</span>
        <span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">PostWorkout</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span> <span class="n">Workout</span> <span class="n">workout</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="n">ModelState</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">workout</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>

            <span class="k">return</span> <span class="nf">CreatedAtAction</span><span class="p">(</span><span class="s">"GetWorkout"</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="n">workout</span><span class="p">.</span><span class="n">Id</span> <span class="p">},</span> <span class="n">workout</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// DELETE: api/Workouts/5</span>
        <span class="p">[</span><span class="nf">HttpDelete</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">DeleteWorkout</span><span class="p">([</span><span class="n">FromRoute</span><span class="p">]</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="n">ModelState</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">workout</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">.</span><span class="nf">SingleOrDefaultAsync</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">workout</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">workout</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>

            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">workout</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">bool</span> <span class="nf">WorkoutExists</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note that methods for all CRUD (Create, Read, Update, Delete) operations were created and that they are all already populated with fully working code.</p>

<p>The class itself is annotated with two attributes: <code class="highlighter-rouge">Route</code> telling the server that this controller should be used when the route starts with <code class="highlighter-rouge">api/Workout</code>, and <code class="highlighter-rouge">Produces</code> telling the server that the output should have a header which says that the content type is <code class="highlighter-rouge">application/json</code>.</p>

<p>Most methods are annotated with the HTTP action verb (e.g. <code class="highlighter-rouge">HttpPost</code> or <code class="highlighter-rouge">HttpPut</code>), which tells the controller which action should be called for each verb. This is done following the best practices of REST APIs: GET for listing data, POST for adding new records, PUT for updating existing records and DELETE for deleting.</p>

<p>The controller receives a <code class="highlighter-rouge">WorkoutContext</code> in the constructor and it saves and gets all data through it. The specific instance of the context will be dependency injected.</p>

<p>For a large application, you’ll want to avoid using the database context directly in the controller. You can split the logic of the application into the following layers:</p>
<ul>
  <li>A data layer which has repositories that are in charge only of communicating with the database</li>
  <li>A service layer which has services that can process logic and communicate with the data layer to save and load data</li>
  <li>A presentation layer which includes the API controllers and does not have a lot of logic, it just takes in information from the API, uses the services it needs for data processing and returns the results through the API</li>
</ul>

<p>Now that you’ve created a controller, you can delete the sample <code class="highlighter-rouge">ValuesController</code> that was added to the project initially.</p>

<h3 id="configure-the-database-connection-on-startup">Configure the Database Connection on Startup</h3>
<p>Another thing the controller scaffold did was alter the <code class="highlighter-rouge">appsettings.json</code> file which holds the settings. Specifically, it added this section:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"ConnectionStrings"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"WorkoutContext"</span><span class="p">:</span> <span class="s2">"Server=(localdb)</span><span class="err">\\</span><span class="s2">mssqllocaldb;Database=WorkoutContext-96b0f43c-71bb-4887-b9e3-cf768e432412;Trusted_Connection=True;MultipleActiveResultSets=true"</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>This says that the <code class="highlighter-rouge">WorkoutContext</code> will connect to a database server and a specific database that is provided here. By default, it uses a local database on your machine called <a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-mvc-app/working-with-sql?tabs=aspnetcore2x">SQL Server LocalDB</a>. You can change this to any database you like. If you need help building connection strings, you can use a <a href="https://www.developerfusion.com/tools/sql-connection-string/">connection string generator tool</a>.</p>

<p>Also, if you open <code class="highlighter-rouge">Startup.cs</code>, in the <code class="highlighter-rouge">ConfigureServices</code> method you’ll notice this line has been added:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">WorkoutContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
  <span class="n">options</span><span class="p">.</span><span class="nf">UseSqlServer</span><span class="p">(</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"WorkoutContext"</span><span class="p">)));</span>
</code></pre></div></div>

<p>This registers the <code class="highlighter-rouge">WorkoutContext</code> as a service that can be injected, and it defines that it will use SQL Server and get the configuration from <code class="highlighter-rouge">appsettings.json</code>.</p>

<h3 id="create-the-database">Create the Database</h3>
<p>In the <code class="highlighter-rouge">WorkoutContext</code> you have defined what the tables should look like. You need to tell Entity Framework to use this information and create a database. In Visual Studio open the Package Manager Console (<strong>Tools → NuGet Package Manager → Package Manager Console</strong>).</p>

<p>Use the command:</p>

<p><code class="highlighter-rouge">Add-Migration Initial</code></p>

<p>This will create a <code class="highlighter-rouge">Migrations</code> folder in your solution and add a file called something like <code class="highlighter-rouge">2180401145609_Initial.cs</code>. If you open it, you will notice it has the <code class="highlighter-rouge">Up</code> and <code class="highlighter-rouge">Down</code> methods. The <code class="highlighter-rouge">Up</code> method contains the code used to upgrade the database to the next version, while the <code class="highlighter-rouge">Down</code> method contains the code to downgrade to the previous version. At this point you have no database, so the goal is to upgrade from nothing to the current version. In the Package Manager Console use the command:</p>

<pre><code class="language-Update-Database```">
This has now created the database with the Workout table in it. You will need to add a new migration and run a database update in this way each time you change something that changes the database structure. 

### Enable CORS
In order to call an API from JavaScript, you need to enable [CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) on the API server. Since you're building an API that will be called by an Angular app, you need CORS. 

To enable CORS on your API, edit the ```Startup.cs```. In the `ConfigureServices` method add CORS and a default policy:

```csharp
services.AddCors(options =&gt;
{
    options.AddPolicy("CorsPolicy",
        builder =&gt; builder.AllowAnyOrigin()
        .AllowAnyMethod()
        .AllowAnyHeader()
        .AllowCredentials());
});
</code></pre>

<p>In the <code class="highlighter-rouge">Configure</code> method tell the application to use the <code class="highlighter-rouge">CorsPolicy</code> on all requests. This must be placed <strong>before</strong> the <code class="highlighter-rouge">UseMvc()</code> statement:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="nf">UseCors</span><span class="p">(</span><span class="s">"CorsPolicy"</span><span class="p">);</span>
<span class="n">app</span><span class="p">.</span><span class="nf">UseMvc</span><span class="p">();</span>
</code></pre></div></div>

<p>This allows any API request from any origin. If you want to allow this only for certain controllers or methods, you need to configure the policies as above, but then add the<code class="highlighter-rouge">EnableCors</code> attribute to specific controllers or methods.</p>

<p><strong>Note:</strong> This setup leaves the API wide open for access. In production applications you might need to add more restrictions. Please check Microsoft’s documentation on enabling cross origin requests for more details.</p>

<h3 id="run-and-test-with-fiddler-or-postman">Run and Test with Fiddler or Postman</h3>
<p>Run your solution quickly and test it. Once it runs, basically nothing happens. However, the API is running and waiting for requests.</p>

<p>You can use a tool like <a href="https://www.telerik.com/fiddler">Fiddler</a> or <a href="https://www.getpostman.com/">Postman</a> to verify it works properly (note that your port may be different):</p>

<p><img src="/assets/blog/build-crud-app-aspnetcore-angular/postman-3a1dbff47753aba271d893af0e590cab292de5342d8f050f5020c5192b555298.jpg" alt="Postman" width="600" class="center-image" /></p>

<p>So as of now, your project works, right? Sort of. It works as long as the right data is submitted. However, you shouldn’t assume that will always be the case.</p>

<h3 id="validate-incoming-data">Validate Incoming Data</h3>
<p>Adding a record with empty data (e.g. <code class="highlighter-rouge">'timeInSeconds' : ''</code>) would work. But from a user point of view it’s wrong. Let’s assume that we need the Date and the TimeInSeconds to be mandatory. We can easily do this by adding data annotations in the Workout model:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Workout</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="k">public</span> <span class="n">DateTimeOffset</span> <span class="n">Date</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">DistanceInMeters</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="k">public</span> <span class="kt">long</span> <span class="n">TimeInSeconds</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>Note that in the controller each method has a section like:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(!</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="n">ModelState</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The input model is validated against all data annotations for validation and the results are stored in ModelState. If invalid, the methods will return an error message of <code class="highlighter-rouge">401 Bad Request</code>.</p>

<p>For now, let’s move on to the client side of the story, we’ll come back to the server side later on.</p>

<h2 id="build-the-angular-5-client-side-application">Build the Angular 5 Client Side Application</h2>
<p>In order to create a new Angular 5 client side application, use Angular CLI. Angular CLI is a command line utility that can generate an Angular project for you. Not only can it create new projects, but it can also generate code. It’s a convenient tool because it also offers commands that will build and optimize your project for production. It uses webpack under the covers for building. If you want to learn more about webpack, I recommend <a href="https://webpack.academy/">webpack.academy</a>.</p>

<p><img src="/assets/blog/build-crud-app-aspnetcore-angular/angular-home-46893f464d23a2544e230a752f16d1c7f0ce1e69548536885c5616a72b9ac508.jpg" alt="Angular CLI home page" width="600" class="center-image" /></p>

<p>You can find install instructions and learn the basics of Angular CLI at <a href="https://cli.angular.io">https://cli.angular.io</a>. To check if it installed correctly, you can use the <code class="highlighter-rouge">ng --version</code> command in your command prompt. The version used for this tutorial is version 1.7.3.</p>

<p><img src="/assets/blog/build-crud-app-aspnetcore-angular/angular-cli-cab09aee7df0a4cc24567cd2a6c91452c5d32b74df3919541f4f8a2fc9c406a1.jpg" alt="Angular CLI version output" width="600" class="center-image" /></p>

<p>In order to build the client side application, create a new folder called <strong>Frontend</strong> next to the <strong>Backend</strong> folder. Move to the Frontend folder and use the command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ng new JoggingDiary
</code></pre></div></div>

<p>This will create a folder called JoggingDiary and everything you need for an Angular 5 app. For the look and feel we will just use Bootstrap. Simply add the bootstrap package using npm:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd JoggingDiary
npm install bootstrap --save
</code></pre></div></div>

<p>And add it to the <code class="highlighter-rouge">styles.css</code> file:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@import</span> <span class="s2">'~bootstrap/dist/css/bootstrap.min.css'</span>
</code></pre></div></div>

<p>You can run the application directly by running the command:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ng serve
</code></pre></div></div>

<p>and visiting <strong>http://localhost:4200</strong> in your web browser. You should see the basic Angular 5 app:</p>

<p><img src="/assets/blog/build-crud-app-aspnetcore-angular/angular-initial-project-40a1a063c8e36a59b09060c67d10d3eff8a91b08cdbb97c3198d99c207dab59d.png" alt="Initial Angular project template" width="600" class="center-image" /></p>

<p>If you take a look at the <code class="highlighter-rouge">index.html</code> file, you will notice that everything looks like classic HTML:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>app<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;base</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"icon"</span> <span class="na">type=</span><span class="s">"image/x-icon"</span> <span class="na">href=</span><span class="s">"favicon.ico"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;app-root&gt;&lt;/app-root&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Except the <code class="highlighter-rouge">&lt;app-root&gt;</code> tag. This one is not in the HTML specification, and is in fact a part of Angular 5.</p>

<p>There are some Angular 5 building blocks you should understand before we go any further:</p>

<p><strong>Modules</strong> are the building blocks of the application. Each application must have at least one module we call the root module, and by default it is defined in the <code class="highlighter-rouge">app.module.ts</code>. Modules can have multiple components and services.</p>

<p><strong>Components</strong> are used to define parts of your application. A component consists of a view and a class where the view defines the look of the component (HTML) and the class defines the behavior (TypeScript). Every app must have at least one component, the root component, usually in <code class="highlighter-rouge">app.component.</code> files.</p>

<p><strong>Services</strong> are objects that are wired together using dependency injection. They allow easy reuse of parts of the application logic across multiple applications. Normally the components are not supposed to be in charge of fetching the data and saving the data, only for connecting it to the presentation layer, so all the fetching and saving is usually done inside a service.</p>

<p>In your application you will have a few components, which you’ll need to add:</p>

<ul>
  <li>Home component with the home screen</li>
  <li>Grid view of all your jogging records</li>
  <li>Component used for updating or adding a new record</li>
</ul>

<p>Components can easily be added again by using angular-cli and the <code class="highlighter-rouge">ng generate component</code> command. Move into the JoggingDiary folder and and add some components:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ng generate component Home
ng generate component GridJogging
ng generate component AddOrUpdateJogging
</code></pre></div></div>

<p>Add routing to your application in the <code class="highlighter-rouge">app.module.ts</code> file:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">RouterModule</span><span class="p">,</span> <span class="nx">Routes</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/router'</span><span class="p">;</span>


<span class="c1">// ...</span>

<span class="kd">const</span> <span class="nx">appRoutes</span><span class="p">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="na">component</span><span class="p">:</span> <span class="nx">HomeComponent</span> <span class="p">}</span>
 
<span class="p">];</span>

<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="c1">// ...</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="nx">BrowserModule</span><span class="p">,</span>
    <span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">appRoutes</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="c1">// ...</span>
</code></pre></div></div>

<p>For more details on Angular routing you can check their official documentation. For our purposes, just know that whenever a user comes to the base URL(<code class="highlighter-rouge">path == ''</code>), the router will load the <code class="highlighter-rouge">HomeComponent</code>.</p>

<p>The root component is always loaded. However, the components defined in the router are loaded into a special placeholder that is in the root component HTML, defined by the <code class="highlighter-rouge">&lt;router-outlet&gt;</code>. Change the <code class="highlighter-rouge">app.component.html</code> file to:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Jogging diary<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;hr/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;router-outlet&gt;&lt;/router-outlet&gt;</span>
</code></pre></div></div>

<p>This will make sure that the header and the horizontal rule are shown in every screen, and the <code class="highlighter-rouge">&lt;router-outlet&gt;&lt;/router-outlet&gt;</code> placeholder will be replaced by the content of the active view.</p>

<p>Let’s start with the GridJogging component first. Initially it looks like this:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'app-grid-jogging'</span><span class="p">,</span>
  <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'./grid-jogging.component.html'</span><span class="p">,</span>
  <span class="na">styleUrls</span><span class="p">:</span> <span class="p">[</span><span class="s1">'./grid-jogging.component.css'</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">GridJoggingComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>

  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

  <span class="nx">ngOnInit</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Notice that this component (and every Angular component) has a constructor and a <code class="highlighter-rouge">ngOnInit</code>. The constructor is called when a component is being created, long before any data is passed into it. <code class="highlighter-rouge">ngOnInit</code> gets called after the first data change, so the data that this component will use is already available.</p>

<p>Your components will display data from the backend, and also send changes about the data to the backend using the API we just built. This type of communication is done by using a <strong>service</strong>. Add a new service using the <strong>ng generate</strong> command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ng generate service Workout
</code></pre></div></div>

<p>This generates the <code class="highlighter-rouge">workout.service.ts</code> file and <code class="highlighter-rouge">workout.service.spec.ts</code> file. Change the <code class="highlighter-rouge">workout.service.ts</code> to:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">HttpClient</span><span class="p">,</span> <span class="nx">HttpHeaders</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/common/http'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">WorkoutService</span> <span class="p">{</span>
  <span class="kr">private</span> <span class="nx">headers</span><span class="p">:</span> <span class="nx">HttpHeaders</span><span class="p">;</span>
  <span class="kr">private</span> <span class="nx">accessPointUrl</span><span class="p">:</span> <span class="nx">string</span> <span class="o">=</span> <span class="s1">'http://localhost:53877/api/workouts'</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">http</span><span class="p">:</span> <span class="nx">HttpClient</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpHeaders</span><span class="p">({</span><span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json; charset=utf-8'</span><span class="p">});</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="kd">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Get all jogging data</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">accessPointUrl</span><span class="p">,</span> <span class="p">{</span><span class="na">headers</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">headers</span><span class="p">});</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="nx">add</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">accessPointUrl</span><span class="p">,</span> <span class="nx">payload</span><span class="p">,</span> <span class="p">{</span><span class="na">headers</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">headers</span><span class="p">});</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">accessPointUrl</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span><span class="na">headers</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">headers</span><span class="p">});</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="nx">update</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">accessPointUrl</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">payload</span><span class="p">,</span> <span class="p">{</span><span class="na">headers</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">headers</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note that we are importing <code class="highlighter-rouge">HttpClient</code> and <code class="highlighter-rouge">HttpHeaders</code> from <code class="highlighter-rouge">@angular/common/http</code>. <code class="highlighter-rouge">HttpClient</code> makes sending HTTP requests to the server easy. <code class="highlighter-rouge">HttpHeaders</code> will be used to make HTTP Header definitions for these requests easy.</p>

<p>We also need to update the <code class="highlighter-rouge">app.module.ts</code> to include the HttpClient module and the WorkoutService:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">WorkoutService</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./workout.service'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">HttpClientModule</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/common/http'</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="c1">// ...</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">BrowserModule</span><span class="p">,</span>
    <span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">appRoutes</span><span class="p">),</span>
    <span class="nx">HttpClientModule</span>
    <span class="c1">// ...</span>
  <span class="p">],</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">WorkoutService</span>
  <span class="p">],</span>

  <span class="c1">// ...</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div></div>

<p>Next, build the HTML that will display the actual data on screen. You can add a column that will display average speed. Edit the template of the GridJogging component (<code class="highlighter-rouge">grid-jogging-component.html</code>):</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">id=</span><span class="s">"new-button"</span><span class="nt">&gt;</span>New<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;table&gt;</span>
<span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;</span>Date<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Distance in meters<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Time<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Average speed<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Commands<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/thead&gt;</span>
<span class="nt">&lt;tbody&gt;</span>
    <span class="nt">&lt;tr</span> <span class="err">*</span><span class="na">ngFor=</span><span class="s">"let joggingInfo of joggingData"</span><span class="nt">&gt;</span> 
        <span class="nt">&lt;td&gt;</span>{{ joggingInfo.date | date:'shortDate' }}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>{{ joggingInfo.distanceInMeters | number: '1.2-2' }}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>{{ joggingInfo.timeInSeconds / 60 | number: '1.0-0' }}:{{ joggingInfo.timeInSeconds % 60 |number: '2.0-0' }}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>{{ (joggingInfo.distanceInMeters / joggingInfo.timeInSeconds) * 3.6 | number:'1.2-2' }}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">editRecord</span><span class="err">(</span><span class="na">this</span><span class="err">)"</span><span class="nt">&gt;</span>Edit<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">deleteRecord</span><span class="err">(</span><span class="na">this</span><span class="err">)"</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre></div></div>

<p>The `` are just a placeholder for data populated by Angular. You can also do some basic calculations in there.</p>

<p><code class="highlighter-rouge">*ngFor</code> is an Angular directive that makes this particular block repeat itself for every array member of <code class="highlighter-rouge">joggingData</code>. In each iteration, the current object will be referenced as <code class="highlighter-rouge">joggingInfo</code>. So, we are just printing a row of a table with data for each array member.</p>

<p>Filters were added for data formatting. You can read more about the <a href="https://angular.io/api/common/DatePipe">date filter</a> and the <a href="https://angular.io/api/common/DecimalPipe">number filter</a> in the Angular docs.</p>

<p>Do note we need to include Pipes in the <code class="highlighter-rouge">app.module.ts</code>:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">DecimalPipe</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/common'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">DatePipe</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/common'</span><span class="p">;</span>
</code></pre></div></div>

<p>It is necessary to have the Home component get the actual data from the <code class="highlighter-rouge">WorkoutService</code>. In the <code class="highlighter-rouge">home.component.ts</code> add the service:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">WorkoutService</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'../workout.service'</span>

<span class="c1">// ...</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">HomeComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="kr">public</span> <span class="nx">joggingData</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="kr">public</span> <span class="nx">currentJogging</span><span class="p">:</span> <span class="nx">any</span><span class="p">;</span>

  <span class="kd">constructor</span> <span class="p">(</span><span class="kr">private</span> <span class="nx">workoutService</span><span class="p">:</span> <span class="nx">WorkoutService</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">workoutService</span><span class="p">.</span><span class="kd">get</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">joggingData</span> <span class="o">=</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// ...</span>
</code></pre></div></div>

<p>HttpClient methods return observables. Here it says that you want your Home component to subscribe to any changes made by the <code class="highlighter-rouge">workoutService.get()</code> method, and when new changed data is received, to store it to <code class="highlighter-rouge">this.joggingData</code>.</p>

<p>You have defined the data in the <code class="highlighter-rouge">home.component.ts</code>, but not in the GridJogging component. However, we want the GridJogging component to get the data as an input parameter, so that whichever other component is using it can feed it with data. You’ll need to edit the GridJogging component:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Input</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="c1">// ...</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">GridJoggingComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>

  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="nx">joggingData</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now all that’s left is to edit the template of our Home component and add the GridJogging component there:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;app-grid-jogging</span> <span class="err">[</span><span class="na">joggingData</span><span class="err">]="</span><span class="na">joggingData</span><span class="err">"</span><span class="nt">&gt;&lt;/app-grid-jogging&gt;</span>
</code></pre></div></div>

<p>Note how the input parameter <code class="highlighter-rouge">[joggingData]</code> which is defined in the GridJogging component will get the value of the <code class="highlighter-rouge">joggingData</code> variable defined in the Home component. You can edit the styling of just this component without affecting the styling of any other component. Simply add some code to the <code class="highlighter-rouge">grid-jogging.component.css</code> file:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">table</span> <span class="p">{</span>
    <span class="nl">margin-top</span><span class="p">:</span> <span class="m">1.5em</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">tbody</span> <span class="nt">td</span> <span class="p">{</span>
    <span class="nl">text-align</span><span class="p">:</span> <span class="nb">right</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we need to create the component to add new data. In our <code class="highlighter-rouge">add-or-update-jogging.component.html</code> add this HTML:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;h2&gt;&lt;/h2&gt;</span>
    <span class="nt">&lt;form&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"date-input"</span><span class="nt">&gt;</span>Jogging date:<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"date"</span> <span class="na">id=</span><span class="s">"date-input"</span> <span class="err">[(</span><span class="na">ngModel</span><span class="err">)]="</span><span class="na">joggingInfo</span><span class="err">.</span><span class="na">date</span><span class="err">"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"distance-input"</span><span class="nt">&gt;</span>Distance (m)<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">id=</span><span class="s">"distance-input"</span> <span class="err">[(</span><span class="na">ngModel</span><span class="err">)]="</span><span class="na">joggingInfo</span><span class="err">.</span><span class="na">distanceInMeters</span><span class="err">"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"time-input"</span><span class="nt">&gt;</span>Time (s)<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">id=</span><span class="s">"time-input"</span> <span class="err">[(</span><span class="na">ngModel</span><span class="err">)]="</span><span class="na">joggingInfo</span><span class="err">.</span><span class="na">timeInSeconds</span><span class="err">"</span> <span class="err">(</span><span class="na">input</span><span class="err">)="</span><span class="na">joggingInfo</span><span class="err">.</span><span class="na">timeInSeconds =</span><span class="err"> </span><span class="s">$event.target.value"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">addOrUpdateJoggingRecord</span><span class="err">($</span><span class="na">event</span><span class="err">);"</span><span class="nt">&gt;</span>Save<span class="nt">&lt;/button&gt;</span>

    <span class="nt">&lt;/form&gt;</span>
   <span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>You will notice the <code class="highlighter-rouge">[(ngModel)]</code> tag. This indicates a two-way binding between the value of the HTML element and the object provided. In other words: as you type, the value of the object changes instantly and if you change the object’s value from another place, the input box value will be updated immediately.</p>

<p>For this to work, in the <code class="highlighter-rouge">app.module.ts</code> we need to import the Forms module:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">FormsModule</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/forms'</span><span class="p">;</span>

<span class="c1">//...</span>
<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="c1">//...</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
    <span class="c1">//...</span>
    <span class="nx">FormsModule</span>
  <span class="p">]</span>
<span class="p">})</span>
</code></pre></div></div>

<p>In Angular, in order to raise an event (and don’t think of these events as classic Javascript events) we need to have an output parameter. This output parameter will return an EventEmitter. Also, you’ll need a function that will emit the new data when “Save” is clicked. You’ll also need an input parameter <code class="highlighter-rouge">joggingInfo</code> because you’ll use the same component for adding and updating. So if the parameter passed here has an ID, then you are dealing with an update operation, otherwise it is a create operation. In this component code add:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">EventEmitter</span><span class="p">,</span> <span class="nx">Input</span><span class="p">,</span> <span class="nx">Output</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AddOrUpdateJoggingComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="nx">joggingCreated</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="nx">joggingInfo</span><span class="p">:</span> <span class="nx">any</span><span class="p">;</span>

  <span class="kr">public</span> <span class="nx">buttonText</span> <span class="o">=</span> <span class="s1">'Save'</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clearJoggingInfo</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">joggingInfo</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">ngOnInit</span><span class="p">()</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">clearJoggingInfo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Create an empty jogging object</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">joggingInfo</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
      <span class="na">date</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
      <span class="na">distanceInMeters</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">timeInSeconds</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">};</span>
  <span class="p">};</span>

  <span class="kr">public</span> <span class="nx">addOrUpdateJoggingRecord</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">joggingCreated</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">joggingInfo</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clearJoggingInfo</span><span class="p">();</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>When adding this component to your home component’s HTML change the <code class="highlighter-rouge">home.component.html</code> to:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;app-add-or-update-jogging</span> <span class="err">(</span><span class="na">joggingCreated</span><span class="err">)="</span><span class="na">createOrUpdateJogging</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span> <span class="err">[</span><span class="na">joggingInfo</span><span class="err">]="</span><span class="na">currentJogging</span><span class="err">"</span><span class="nt">&gt;&lt;/app-add-or-update-jogging&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;app-grid-jogging</span> <span class="err">[</span><span class="na">joggingData</span><span class="err">]="</span><span class="na">joggingData</span><span class="err">"</span> <span class="err">(</span><span class="na">editClicked</span><span class="err">)="</span><span class="na">editClicked</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span> <span class="err">(</span><span class="na">newClicked</span><span class="err">)="</span><span class="na">editClicked</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span> <span class="err">(</span><span class="na">recordDeleted</span><span class="err">)="</span><span class="na">deleteClicked</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span><span class="nt">&gt;&lt;/app-grid-jogging&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Now add a public function <code class="highlighter-rouge">createOrUpdateJogging</code> to the <code class="highlighter-rouge">home.component.ts</code> that subscribes to the <code class="highlighter-rouge">workoutService</code>. Also, add a method that creates an empty jogging record and initialize the <code class="highlighter-rouge">currentJogging</code> property in the constructor:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">constructor</span> <span class="p">(</span> <span class="kr">public</span> <span class="nx">oktaAuth</span><span class="p">:</span> <span class="nx">OktaAuthService</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">workoutService</span><span class="p">:</span> <span class="nx">WorkoutService</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentJogging</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">setInitialValuesForJoggingData</span><span class="p">();</span>
<span class="p">}</span>

<span class="kr">private</span> <span class="nx">setInitialValuesForJoggingData</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
      <span class="na">date</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
      <span class="na">distanceInMeters</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">timeInSeconds</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="kr">public</span> <span class="nx">createOrUpdateJogging</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">jogging</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// if jogging is present in joggingData, we can assume this is an update</span>
    <span class="c1">// otherwise it is adding a new element</span>
    <span class="kd">let</span> <span class="nx">joggingWithId</span><span class="p">;</span>
    <span class="nx">joggingWithId</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">joggingData</span><span class="p">,</span> <span class="p">(</span><span class="nx">el</span> <span class="o">=&gt;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">jogging</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">joggingWithId</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">updateIndex</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">joggingData</span><span class="p">,</span> <span class="p">{</span><span class="na">id</span><span class="p">:</span> <span class="nx">joggingWithId</span><span class="p">.</span><span class="nx">id</span><span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">workoutService</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">jogging</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span>
        <span class="nx">joggingRecord</span> <span class="o">=&gt;</span>  <span class="k">this</span><span class="p">.</span><span class="nx">joggingData</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">updateIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">jogging</span><span class="p">)</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">workoutService</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">jogging</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span>
        <span class="nx">joggingRecord</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">joggingData</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">jogging</span><span class="p">)</span>
      <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">currentJogging</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">setInitialValuesForJoggingData</span><span class="p">();</span>
  <span class="p">};</span>
</code></pre></div></div>
<p>This code checks if the record passed to the function exists in the <code class="highlighter-rouge">joggingData</code> array by comparing IDs. If so, it assumes that the required operation needed is an update, and then subscribes to the <code class="highlighter-rouge">workoutService.update()</code> method. Otherwise, it subscribes to the <code class="highlighter-rouge">workoutService.add()</code> method for creating a new record. Once a record is successfully created or updated, the <code class="highlighter-rouge">joggingData</code> array is updated with new information.</p>

<p>To simplify, I’m using <a href="https://lodash.com/">Lodash</a> through <code class="highlighter-rouge">npm</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install --save lodash
</code></pre></div></div>

<p>You need to add Lodash both in <code class="highlighter-rouge">app.module.ts</code> and <code class="highlighter-rouge">home.component.ts</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">_</span> <span class="k">from</span> <span class="s1">'lodash'</span><span class="p">;</span>
</code></pre></div></div>

<p>Update the <code class="highlighter-rouge">AddOrUpdateJoggingComponent</code> to change the title based on whether a record ID is provided. If there is an ID provided, the title will be “Add a record”, otherwise it will be “Update a record”.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h2</span> <span class="err">*</span><span class="na">ngIf=</span><span class="s">"!joggingInfo || joggingInfo.id === undefined"</span><span class="nt">&gt;</span>Add record<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;h2</span> <span class="err">*</span><span class="na">ngIf=</span><span class="s">"joggingInfo &amp;&amp; joggingInfo.id !== undefined"</span><span class="nt">&gt;</span>Update record (ID: )<span class="nt">&lt;/h2&gt;</span>
</code></pre></div></div>

<p>So, from your grid component there are a few more things missing. The “New” button does not do anything, nor do the links for Edit and Delete. To solve for this, add these functions:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">EventEmitter</span><span class="p">,</span> <span class="nx">Input</span><span class="p">,</span> <span class="nx">Output</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">GridJoggingComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="nx">recordDeleted</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="nx">newClicked</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="nx">editClicked</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="nx">joggingData</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="c1">// ...</span>

  <span class="kr">public</span> <span class="nx">deleteRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">recordDeleted</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
  <span class="p">}</span>
    
  <span class="kr">public</span> <span class="nx">editRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">clonedRecord</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">record</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">editClicked</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">clonedRecord</span><span class="p">);</span>

  <span class="p">}</span>

  <span class="kr">public</span> <span class="nx">newRecord</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">newClicked</span><span class="p">.</span><span class="nx">emit</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And now we just connect it to the AddOrUpdateComponent and <code class="highlighter-rouge">workoutService</code> inside the Home component, like we did earlier:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="kr">public</span> <span class="nx">editClicked</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">currentJogging</span> <span class="o">=</span> <span class="nx">record</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kr">public</span> <span class="nx">newClicked</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">currentJogging</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">setInitialValuesForJoggingData</span><span class="p">();</span> 
  <span class="p">};</span>

  <span class="kr">public</span> <span class="nx">deleteClicked</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">deleteIndex</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">joggingData</span><span class="p">,</span> <span class="p">{</span><span class="na">id</span><span class="p">:</span> <span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">workoutService</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">record</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span>
      <span class="nx">result</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">joggingData</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">deleteIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Update the <code class="highlighter-rouge">home.component.html</code> to make sure all these event handlers are properly connected to the accompanying events:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;app-grid-jogging</span> <span class="err">[</span><span class="na">joggingData</span><span class="err">]="</span><span class="na">joggingData</span><span class="err">"</span> <span class="err">(</span><span class="na">editClicked</span><span class="err">)="</span><span class="na">editClicked</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span> <span class="err">(</span><span class="na">newClicked</span><span class="err">)="</span><span class="na">newClicked</span><span class="err">()"</span> <span class="err">(</span><span class="na">recordDeleted</span><span class="err">)="</span><span class="na">deleteClicked</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span><span class="nt">&gt;&lt;/app-grid-jogging&gt;</span>
</code></pre></div></div>

<p>So, now you have a cool little application for tracking your workouts. But your app only supports your workouts, and no one else’s. Maybe that’s all you need, but we’re going to push forward and add user management, login, security… the works, with Okta.</p>

<h2 id="add-okta-for-user-authentication">Add Okta for User Authentication</h2>
<p>OpenID Connect (OIDC) is built on top of the OAuth 2.0 protocol and allows clients to verify the identity of the user as well as to obtain users’ basic profile information. Okta uses OpenID Connect to make it easy to add authentication and user management to your applications.</p>

<p>To integrate Okta for user authentication, you’ll first need to <a href="https://developer.okta.com/signup">sign up for a free developer account</a> and create an Okta application.</p>

<p>Log in to your Okta account, or create one if you don’t have one. Navigate to Applications and click on Add Application. Set your application up like this:</p>

<p><strong>App type:</strong> Single-page Application
<strong>Login redirect URI:</strong> <code class="highlighter-rouge">http://localhost:4200/implicit/callback</code></p>

<p><img src="/assets/blog/build-crud-app-aspnetcore-angular/okta-app-settings-0abb4d7d3096fd4ca0511569f5b8784dace5690af09c15f608b87051dc65dc11.jpg" alt="Okta Application settings" width="600" class="center-image" /></p>

<p>After creating the application, your client ID will be displayed on the General tab. You’ll need this client ID in a moment, so be sure to make note of it.</p>
<h3 id="connect-okta-to-your-angular-application">Connect Okta to Your Angular Application</h3>
<p>Next, you want to add the Okta Angular SDK:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install --save @okta/okta-angular
</code></pre></div></div>

<p>You need to provide the data form your application set up in Okta into your root module. Add a config object like this:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">issuer</span><span class="p">:</span> <span class="s1">'<span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default'</span><span class="p">,</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="s1">'http://localhost:4200/implicit/callback'</span><span class="p">,</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="s1">'{clientId}'</span><span class="p">,</span>
  <span class="na">scope</span><span class="p">:</span> <span class="s1">'openid profile email'</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Notice you are redirecting a successful login to the <code class="highlighter-rouge">http://localhost:4200/implicit/callback</code> route. This route does not exist yet, so you’ll need to add it along with <code class="highlighter-rouge">OktaAuthModule</code> and the <code class="highlighter-rouge">OktaCallbackComponent</code> to your <code class="highlighter-rouge">app.module.ts</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="k">import</span> <span class="p">{</span>
  <span class="nx">OktaAuthModule</span><span class="p">,</span>
  <span class="nx">OktaCallbackComponent</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="s1">'@okta/okta-angular'</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="kd">const</span> <span class="nx">appRoutes</span><span class="p">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="na">component</span><span class="p">:</span> <span class="nx">HomeCompnent</span><span class="p">},</span>
  <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="s1">'implicit/callback'</span><span class="p">,</span> <span class="na">component</span><span class="p">:</span> <span class="nx">OktaCallbackComponent</span> <span class="p">}</span>
<span class="p">];</span>

<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="nx">AddOrUpdateJoggingComponent</span><span class="p">,</span>
    
  <span class="p">],</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">BrowserModule</span><span class="p">,</span>
    <span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">appRoutes</span><span class="p">),</span>
    <span class="nx">HttpClientModule</span><span class="p">,</span>
    <span class="nx">OktaAuthModule</span><span class="p">.</span><span class="nx">initAuth</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>
  <span class="p">],</span>

  <span class="c1">// ...</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div></div>

<p>And that’s it! Your Angular application is using Okta for authentication and authorization.</p>

<p>When you are authenticated with Okta (as with any OpenID Connect provider), you need to send your token in an authorization header on each HTTP request. In order to avoid adding code to every HTTP request in every service, you can create an HTTP interceptor. This will “intercept” every HTTP request and add the authorization header to it. Create a <code class="highlighter-rouge">/src/app/auth.interceptor.ts</code> file:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">HttpRequest</span><span class="p">,</span> <span class="nx">HttpHandler</span><span class="p">,</span> <span class="nx">HttpEvent</span><span class="p">,</span> <span class="nx">HttpInterceptor</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/common/http'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/Observable'</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">'rxjs/add/observable/fromPromise'</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">'rxjs/add/operator/mergeMap'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">OktaAuthService</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@okta/okta-angular'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AuthInterceptor</span> <span class="kr">implements</span> <span class="nx">HttpInterceptor</span> <span class="p">{</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">oktaAuth</span><span class="p">:</span> <span class="nx">OktaAuthService</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="nx">intercept</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">HttpRequest</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">next</span><span class="p">:</span> <span class="nx">HttpHandler</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">HttpEvent</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">mergeMap</span><span class="p">((</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAccessToken</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">mergeMap</span><span class="p">((</span><span class="nx">accessToken</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">request</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">clone</span><span class="p">({</span>
              <span class="na">setHeaders</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">accessToken</span><span class="p">}</span><span class="s2">`</span>
              <span class="p">}</span>
            <span class="p">});</span>

            <span class="k">return</span> <span class="nx">next</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
          <span class="p">})</span>
      <span class="p">});</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">isAuthenticated</span><span class="p">()</span> <span class="p">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Observable</span><span class="p">.</span><span class="nx">fromPromise</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">oktaAuth</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">getAccessToken</span><span class="p">()</span> <span class="p">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Observable</span><span class="p">.</span><span class="nx">fromPromise</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">oktaAuth</span><span class="p">.</span><span class="nx">getAccessToken</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div>

<p>Make sure to import this interceptor in <code class="highlighter-rouge">app.module.ts</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">HTTP_INTERCEPTORS</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/common/http'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthInterceptor</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./auth.interceptor'</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="c1">// ...</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">WorkoutService</span><span class="p">,</span>
    <span class="p">{</span> <span class="na">provide</span><span class="p">:</span> <span class="nx">HTTP_INTERCEPTORS</span><span class="p">,</span> <span class="na">useClass</span><span class="p">:</span> <span class="nx">AuthInterceptor</span><span class="p">,</span> <span class="na">multi</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
  <span class="p">],</span>

  <span class="c1">// ...</span>
<span class="p">})</span>
</code></pre></div></div>

<p>In order for the authentication to work, we will make the Home component display a message with a “Log in” button if you are not authenticated, and add a “Logout” button if you are. Update the <code class="highlighter-rouge">home.component.html</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span> <span class="err">*</span><span class="na">ngIf=</span><span class="s">"!isAuthenticated"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-12"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"text-center"</span><span class="nt">&gt;</span>The coolest application for tracking jogging times you'll ever use.<span class="nt">&lt;/p&gt;</span> 
      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"text-center"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">oktaAuth</span><span class="err">.</span><span class="na">loginRedirect</span><span class="err">();"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span> <span class="err">*</span><span class="na">ngIf=</span><span class="s">"isAuthenticated"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-12 text-right"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn"</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">oktaAuth</span><span class="err">.</span><span class="na">logout</span><span class="err">();"</span><span class="nt">&gt;</span>Log out<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;app-add-or-update-jogging</span> <span class="err">(</span><span class="na">joggingCreated</span><span class="err">)="</span><span class="na">createOrUpdateJogging</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span> <span class="err">[</span><span class="na">joggingInfo</span><span class="err">]="</span><span class="na">currentJogging</span><span class="err">"</span><span class="nt">&gt;&lt;/app-add-or-update-jogging&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;app-grid-jogging</span> <span class="err">[</span><span class="na">joggingData</span><span class="err">]="</span><span class="na">joggingData</span><span class="err">"</span> <span class="err">(</span><span class="na">editClicked</span><span class="err">)="</span><span class="na">editClicked</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span> <span class="err">(</span><span class="na">newClicked</span><span class="err">)="</span><span class="na">newClicked</span><span class="err">()"</span> <span class="err">(</span><span class="na">recordDeleted</span><span class="err">)="</span><span class="na">deleteClicked</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span><span class="nt">&gt;&lt;/app-grid-jogging&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

</code></pre></div></div>

<p>In the Home component we need to import <code class="highlighter-rouge">OktaAuth</code> service. OktaAuth has a <code class="highlighter-rouge">isAuthenticated()</code> method which returns an observable. So, inside the component you need to get the initial value and subscribe to the changes. This is done in the constructor. The result of these operations will be exposed to the template through a <code class="highlighter-rouge">public isAuthenticated</code> property:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">OktaAuthService</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@okta/okta-angular'</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">HomeComponent</span> <span class="p">{</span>
  <span class="kr">public</span> <span class="nx">joggingData</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="kr">public</span> <span class="nx">currentJogging</span><span class="p">:</span> <span class="nx">any</span><span class="p">;</span>
  <span class="kr">public</span> <span class="nx">isAuthenticated</span><span class="p">:</span> <span class="kr">boolean</span><span class="p">;</span>

  <span class="kd">constructor</span> <span class="p">(</span> <span class="kr">public</span> <span class="nx">oktaAuth</span><span class="p">:</span> <span class="nx">OktaAuthService</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">workoutService</span><span class="p">:</span> <span class="nx">WorkoutService</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// get authentication state for immediate use</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">oktaAuth</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">});</span>
  
    <span class="c1">// subscribe to authentication state changes</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">oktaAuth</span><span class="p">.</span><span class="nx">$authenticationState</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
      <span class="p">(</span><span class="na">isAuthenticated</span><span class="p">:</span> <span class="kr">boolean</span><span class="p">)</span>  <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">=</span> <span class="nx">isAuthenticated</span>
    <span class="p">);</span>
    
    <span class="nx">workoutService</span><span class="p">.</span><span class="kd">get</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">((</span><span class="na">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">joggingData</span> <span class="o">=</span> <span class="nx">data</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">currentJogging</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">setInitialValuesForJoggingData</span><span class="p">();</span>
  <span class="p">}</span>

</code></pre></div></div>

<p>When you open the app and are not logged in, you’ll see the demo text and the “Log in” button:</p>

<p><img src="/assets/blog/build-crud-app-aspnetcore-angular/app-with-login-b2b474d1f40d05c2a75ae2c9f25791697b6cceb49ee1006617ef00d5cce4f956.png" alt="App running with login button" width="600" class="center-image" /></p>

<p>When you click “Login” you should get to an Okta login interface:</p>

<p><img src="/assets/blog/build-crud-app-aspnetcore-angular/okta-login-0e750400cb470fe9f712ead4b115a300170f3e5cc911607c8800cc570ff366bf.jpg" alt="Okta login screen" width="600" class="center-image" /></p>

<p>Sign in and you’re in the app and can see the grid and the component to add or update records.</p>

<p>So are you done? Almost!</p>

<h3 id="connect-okta-to-aspnet-core">Connect Okta to ASP.NET Core</h3>
<p>You want to make sure that your API can only be accessed by a user that was authenticated by Okta and has a valid token. To do that, you need to set up authorization inside the ASP.NET Core application.</p>

<p>Add the <code class="highlighter-rouge">JwtBearer</code> authentication in <code class="highlighter-rouge">Startup.cs</code>.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddAuthentication</span><span class="p">(</span><span class="n">JwtBearerDefaults</span><span class="p">.</span><span class="n">AuthenticationScheme</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">AddJwtBearer</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">options</span><span class="p">.</span><span class="n">Authority</span> <span class="p">=</span> <span class="s">"<span class="okta-preview-domain"><span class="okta-preview-domain">https://{yourOktaDomain}.com</span></span>/oauth2/default"</span><span class="p">;</span>
        <span class="n">options</span><span class="p">.</span><span class="n">Audience</span> <span class="p">=</span> <span class="s">"api://default"</span><span class="p">;</span>
    <span class="p">});</span>
</code></pre></div></div>

<p>In the configure method of the same file we need to add a <code class="highlighter-rouge">app.UseAuthentication();</code> command to tell our server application that authentication will be used. Note that this should come before <code class="highlighter-rouge">app.UseMvc();</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="nf">UseCors</span><span class="p">(</span><span class="s">"CorsPolicy"</span><span class="p">);</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseAuthentication</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseMvc</span><span class="p">();</span>
</code></pre></div></div>

<p>And thus, you have secured your API. Now you can add the <code class="highlighter-rouge">[Authorize]</code> attribute to any controller or method you wish to make unavailable to unauthorized users.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">[Produces("application/json")]</span>
<span class="na">[Route("api/Workouts")]</span>
<span class="na">[Authorize]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">WorkoutsController</span> <span class="p">:</span> <span class="n">Controller</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>So, let’s recap. You’ve now built an application that has user authentication and authorization on the server side, and can allow you to CRUD your jogging records, and those of your friends.</p>

<p>The only thing left is to make sure is that the logged in user only has access to their own records. Expand the model in <code class="highlighter-rouge">Workout.cs</code> by adding an additional property <code class="highlighter-rouge">UserId</code>. The Angular application does not need this property, so we will add a [JsonIgnore] data annotation so it is not sent to the client.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">[JsonIgnore]</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">UserId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

<p>This information needs to be stored in the database, so add another migration using the Package Manager Console, and update the database:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Add-Migration AddedUserIdToWorkout
Update-Database
</code></pre></div></div>

<p>Update the controller to make sure that all checks around the user’s ID are carried out properly.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// GET: api/Workouts</span>
<span class="na">[HttpGet]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Workout</span><span class="p">&gt;&gt;</span> <span class="nf">GetWorkout</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"uid"</span><span class="p">)?.</span><span class="n">Value</span><span class="p">;</span>

    <span class="k">return</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span>
        <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">u</span> <span class="p">=&gt;</span> <span class="n">u</span><span class="p">.</span><span class="n">UserId</span> <span class="p">==</span> <span class="n">userId</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">OrderByDescending</span><span class="p">(</span><span class="n">d</span> <span class="p">=&gt;</span> <span class="n">d</span><span class="p">.</span><span class="n">Date</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">ToArrayAsync</span><span class="p">();</span>
<span class="p">}</span>


<span class="c1">// GET: api/Workouts/5</span>
<span class="na">[HttpGet("{id}")]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">GetWorkout</span><span class="p">([</span><span class="n">FromRoute</span><span class="p">]</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="n">ModelState</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"uid"</span><span class="p">)?.</span><span class="n">Value</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">workout</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">.</span><span class="nf">SingleOrDefaultAsync</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span> <span class="p">&amp;&amp;</span> <span class="n">m</span><span class="p">.</span><span class="n">UserId</span> <span class="p">==</span> <span class="n">userId</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">workout</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">workout</span><span class="p">);</span>
        <span class="p">}</span>

<span class="c1">// PUT: api/Workouts/5</span>
<span class="na">[HttpPut("{id}")]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">PutWorkout</span><span class="p">([</span><span class="n">FromRoute</span><span class="p">]</span> <span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="p">[</span><span class="n">FromBody</span><span class="p">]</span> <span class="n">Workout</span> <span class="n">workout</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="n">ModelState</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="p">!=</span> <span class="n">workout</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"uid"</span><span class="p">)?.</span><span class="n">Value</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">UserId</span> <span class="p">==</span> <span class="n">userId</span> <span class="p">&amp;&amp;</span> <span class="n">c</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">)</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
    <span class="p">}</span>

        
    <span class="n">_context</span><span class="p">.</span><span class="nf">Entry</span><span class="p">(</span><span class="n">workout</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Modified</span><span class="p">;</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">DbUpdateConcurrencyException</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="nf">WorkoutExists</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">NoContent</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// POST: api/Workouts</span>
<span class="na">[HttpPost]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">PostWorkout</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span> <span class="n">Workout</span> <span class="n">workout</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="n">ModelState</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"uid"</span><span class="p">)?.</span><span class="n">Value</span><span class="p">;</span>
    <span class="n">workout</span><span class="p">.</span><span class="n">UserId</span> <span class="p">=</span> <span class="n">userId</span><span class="p">;</span>

    <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">workout</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>

    <span class="k">return</span> <span class="nf">CreatedAtAction</span><span class="p">(</span><span class="s">"GetWorkout"</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="n">workout</span><span class="p">.</span><span class="n">Id</span> <span class="p">},</span> <span class="n">workout</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// DELETE: api/Workouts/5</span>
<span class="na">[HttpDelete("{id}")]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">DeleteWorkout</span><span class="p">([</span><span class="n">FromRoute</span><span class="p">]</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="n">ModelState</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"uid"</span><span class="p">)?.</span><span class="n">Value</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">workout</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">.</span><span class="nf">SingleOrDefaultAsync</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span> <span class="p">&amp;&amp;</span> <span class="n">m</span><span class="p">.</span><span class="n">UserId</span> <span class="p">==</span> <span class="n">userId</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">workout</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">_context</span><span class="p">.</span><span class="n">Workout</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">workout</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>

    <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">workout</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the end you should have a basic jogging diary app:</p>

<p><img src="/assets/blog/build-crud-app-aspnetcore-angular/finished-app-918bad60a3470b33e7f26a06116b28e09c44b47d327337a24455621abc1e59ec.png" alt="Finished jogging diary app" width="600" class="center-image" /></p>

<p>Now you just need some people, and to get jogging!</p>

<h2 id="build-more-with-aspnet-core-and-angular">Build More with ASP.NET Core and Angular</h2>

<p>Interested in digging in deeper with ASP.NET Core, Angular, or Okta? We’ve got you covered. Check out the following resources for more cool projects:</p>
<ul>
  <li><a href="https://developer.okta.com/blog/2017/06/13/add-authentication-angular-pwa">Add Authentication to Your Angular PWA</a></li>
  <li><a href="https://developer.okta.com/blog/2018/03/23/token-authentication-aspnetcore-complete-guide">Token Authentication in ASP.NET Core - A Complete Guide</a></li>
  <li><a href="https://developer.okta.com/blog/2017/05/09/progressive-web-applications-with-angular-and-spring-boot">Build Your First Progressive Web App with Angular and Spring Boot</a></li>
  <li><a href="https://developer.okta.com/blog/2017/10/27/okta-oauth-zork">Play Zork, Learn OAuth</a></li>
  <li><a href="https://developer.okta.com/blog/2017/10/04/aspnet-authorization">User Authorization in ASP.NET Core with Okta</a></li>
</ul>

<p>And as always, we’d love to connect! Leave us a comment below, check out our <a href="https://devforum.okta.com/">developer forum</a>, or hit us up on Twitter <a href="https://twitter.com/OktaDev">@oktadev</a>!</p>


    </div>

    
    <div id="disqus">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_title = "Build a CRUD app with ASP.NET Core and Angular";
            var disqus_url = 'https://developer.okta.com/blog/2018/04/26/build-crud-app-aspnetcore-angular';

            (function () {
                var dsq = document.createElement('script');
                dsq.async = true;
                dsq.type = 'text/javascript';
                dsq.src = '//oktadevblog.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>
              Please enable JavaScript to view the
              <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus</a>.
         </noscript>
    </div>
    
</article>

		
</section>

		
	</div>
	<footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">
                <a href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">
                    <div class="Logo">
                        <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    </div>
                    <p>Visit okta.com</p>
                </a>
            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">
                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate-with-okta/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/change-log/">Change Log</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notices</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="https://developer.okta.com/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="https://developer.okta.com/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="https://developer.okta.com/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-aa397c892d9083236c5cb20732dde679021b9236c8142ce78177b8b184567a02.js"></script>
    <script type="text/javascript" src="/assets/myOkta-911cbafbbe079b7a5522d9cbe15bd2a5f44e1582531e88393934bec69f97696b.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/blog-6e32dad27404131cc8630a5282264bed2ab4c08c91ac86fa496b75c53aa4f681.js"></script>
    

  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
