<!doctype html>
<!--[if lt IE 7 ]> <html class="ie6 no-flexbox"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7 no-flexbox"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8 no-flexbox"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9 no-flexbox"> <![endif]-->
<!--[if IE 10 ]>    <html class="ie10 no-flexbox"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!--> <html class="modern wf-loading" lang="en"> <!--<![endif]-->
  <head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager

      // Start Heap Analytics
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load("3356162945");
      // End Heap Analytics
    }
  </script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="Simple Node Authentication | Okta Developer">
  <meta class="swiftype" name="summary" data-type="string" content="Learn how to build authentication and registration into your Node.js application with Okta." />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-914cad2dd6d069302444327ce911da52da68a3c68755f66cf5a4e92b9a38f3eb.css">
  
  
  <title>Simple Node Authentication | Okta Developer</title>
  <meta name="description" content="Learn how to build authentication and registration into your Node.js application with Okta.">
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#21313a">
  <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
</head>

  
    <body id="blog">
	




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first expanded">
          <a href="https://developer.okta.com/product/">Product</a>
          <ul class="menu">
            <li class="first leaf"><a href="https://developer.okta.com/product/">Overview</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authentication/">Authentication</a></li>
            <li class="leaf"><a href="https://developer.okta.com/product/authorization/">Authorization</a></li>
            <li class="last leaf"><a href="https://developer.okta.com/product/user-management/">User Management</a></li>
          </ul>
        </li>
        <li class="leaf">
          <a href="https://developer.okta.com/pricing/">Pricing</a>
        </li>
        <li class="leaf">
          <a href="/blog/" class="active">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="last leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
            </g>
        </svg>
        <svg class="CloseIcon" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="ALl-Boards" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Desktop" transform="translate(-915.000000, -235.000000)" fill="#FFFFFF">
              <g id="Search-bar-Active" transform="translate(30.000000, 26.000000)">
                <polygon id="Icon/Cross" points="901 210.6 899.4 209 893 215.4 886.6 209 885 210.6 891.4 217 885 223.4 886.6 225 893 218.6 899.4 225 901 223.4 894.6 217"></polygon>
              </g>
            </g>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" rel="noopener noreferrer" href="https://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3Dhttps://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3D" class="Button--redOutline">Login</a>
        <a href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

	<div class="page-content">
		
		






<section class="Blog is-single">
		
	<div class="Blog-social">
		
		<a href="https://github.com/redbmk" target="_blank"><i class="fa fa-github"></i></a>
		
		
		
		
	</div>
	
	

<article class="BlogPost">

    <header class="BlogPost-header">

        <time class="BlogPost-date" datetime="2018-04-24">April 24, 2018</time>

        <h1 class="BlogPost-title">
            
            Simple Node Authentication
            
        </h1>

        <div class="BlogPost-attribution">
            
            <img src="/assets/avatar-bkelley-a7e240c885da601328a4646dc13e036fd1124270a59cad8f77371cc7d0895c13.jpg" alt="avatar-bkelley.jpg" class="BlogPost-avatar">
            
            <span class="BlogPost-author">Braden Kelley</span>
        </div>

    </header>

    <div class="BlogPost-content">
        
	<p>Authenticating users for Node.js/Express.js web apps can be difficult. You have to set up a database, define a user schema (or use something more flexible like NoSQL), write code to handle password hashing, etc. It’s annoying.</p>

<p>Using Okta’s API service, however, you can easily register and log in users to your Node website using our OpenID Connect integration.</p>

<h2 id="set-up-your-node-environment">Set Up Your Node Environment</h2>

<p>If you’re new to Node and don’t already have it installed, you’ll need to do that first. To keep things simple, let’s assume a *nix-based environment (e.g. Mac, *nix, or <a href="https://docs.microsoft.com/en-us/windows/wsl/about">Linux on Windows</a>).</p>

<p>There’s a great tool called <code class="highlighter-rouge">nvm</code>, which makes it very simple to install various versions of Node and switch on the fly if you need to test with another version. It will also make sure you have the latest version of node installed and ready to go. Run the following command to install Node via <code class="highlighter-rouge">nvm</code> and get your environment fully set up.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.9/install.sh | bash
</span></code></pre></div></div>

<p>If you run into trouble installing, you can find more information on the <a href="https://github.com/creationix/nvm#installation">installation section of the <code class="highlighter-rouge">nvm</code> README</a>.</p>

<h2 id="create-a-simple-node-application">Create a Simple Node Application</h2>

<p>Now that you have Node installed, let’s get started writing an app.</p>

<p><strong>NOTE</strong>: If you want to skip the tutorial and jump straight to the finished product you can <a href="https://github.com/oktadeveloper/okta-node-express-example">check out this sample app on GitHub</a>.</p>

<p>In the Node ecosystem, the most popular web server is <a href="https://expressjs.com/">Express</a>. Luckily for you, the Express team has also created a nifty <a href="https://expressjs.com/en/starter/generator.html">command line tool</a> which helps bootstrap Express web applications. You can always customize the bootstrapped project <code class="highlighter-rouge">express-generator</code> generates, but let’s start with that to get up and running quickly.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm i <span class="nt">-g</span> express-generator@4.16.0
/Users/bmk/.nvm/versions/node/v9.5.0/bin/express -&gt; /Users/bmk/.nvm/versions/node/v9.5.0/lib/node_modules/express-generator/bin/expr
ess-cli.js
+ express-generator@4.16.0
added 10 packages <span class="k">in </span>4.175s

<span class="nv">$ </span>express <span class="nt">-v</span> hbs <span class="nt">--git</span> simple-node-authentication

   create : simple-node-authentication/
   create : simple-node-authentication/public/
   create : simple-node-authentication/public/javascripts/
   create : simple-node-authentication/public/images/
   create : simple-node-authentication/public/stylesheets/
   create : simple-node-authentication/public/stylesheets/style.css
   create : simple-node-authentication/routes/
   create : simple-node-authentication/routes/index.js
   create : simple-node-authentication/routes/users.js
   create : simple-node-authentication/views/
   create : simple-node-authentication/views/error.hbs
   create : simple-node-authentication/views/index.hbs
   create : simple-node-authentication/views/layout.hbs
   create : simple-node-authentication/.gitignore
   create : simple-node-authentication/app.js
   create : simple-node-authentication/package.json
   create : simple-node-authentication/bin/
   create : simple-node-authentication/bin/www

   change directory:
     <span class="nv">$ </span><span class="nb">cd </span>simple-node-authentication

   install dependencies:
     <span class="nv">$ </span>npm install

   run the app:
     <span class="nv">$ DEBUG</span><span class="o">=</span>simple-node-authentication:<span class="k">*</span> npm start

<span class="nv">$ </span><span class="nb">cd </span>simple-node-authentication/

<span class="nv">$ </span>git init
Initialized empty Git repository <span class="k">in</span> /Users/bmk/code/simple-node-authentication/.git/

<span class="nv">$ </span>npm i
npm notice created a lockfile as package-lock.json. You should commit this file.
added 81 packages <span class="k">in </span>3.09s

<span class="nv">$ </span>npm start

<span class="o">&gt;</span> simple-node-authentication@0.0.0 start /Users/bmk/code/simple-node-authentication
<span class="o">&gt;</span> node ./bin/www
</code></pre></div></div>

<ol>
  <li><code class="highlighter-rouge">npm i -g express-generator</code>: installs the Express Generator</li>
  <li><code class="highlighter-rouge">express -v hbs --git simple-node-authentication</code>: generates a skeleton for our app
    <ul>
      <li>The <code class="highlighter-rouge">-v hbs</code> option tells the generator to use <code class="highlighter-rouge">handlebars</code> as the view engine instead of <code class="highlighter-rouge">pug</code></li>
      <li>The <code class="highlighter-rouge">--git</code> option will create a <code class="highlighter-rouge">.gitignore</code> file with some useful defaults</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">cd simple-node-authentication</code>: navigate to the app folder</li>
  <li><code class="highlighter-rouge">git init &amp;&amp; git add . &amp;&amp; git commit -m 'bootstrap with express-generator'</code>: make sure to keep track of changes
    <ul>
      <li>This will set up a git repository and save all the generated files in the initial commit.
  From now on, you will just be tracking your changes</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">npm i</code>: this installs the dependencies to the <code class="highlighter-rouge">node_modules</code> directory. The <code class="highlighter-rouge">i</code> command is short for <code class="highlighter-rouge">install</code>
    <ul>
      <li><strong>Note:</strong> The <code class="highlighter-rouge">node_modules</code> directory can get notoriously large, and there is a <code class="highlighter-rouge">package-lock.json</code> filethat keeps track of the exact versions of each dependency you’re using. Because of this, best practice is to ignore this folder from source control (e.g. <code class="highlighter-rouge">echo node_modules/ &gt;&gt; .gitignore</code>). If you ever feel your <code class="highlighter-rouge">node_modules</code> is corrupted, you can simply <code class="highlighter-rouge">rm -rf node_modules &amp;&amp; npm i</code> to restore the dependencies</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">npm start</code>: This is the Node standard command to start a server
    <ul>
      <li>The <code class="highlighter-rouge">start</code> script is actually defined inside <code class="highlighter-rouge">package.json</code>. By default it would be the equivalent of running <code class="highlighter-rouge">node index.js</code>, but in our case, it is really running <code class="highlighter-rouge">node ./bin/www</code>.</li>
    </ul>
  </li>
  <li>…</li>
  <li>Profit!</li>
</ol>

<p>Your server is now running at http://localhost:3000. Right now it’s just a basic “Hello World” app, but you’re going to make it a little more useful in a moment.</p>

<h2 id="monitor-code-changes-in-your-node-application">Monitor Code Changes in Your Node Application</h2>

<p>Having your web server restart automatically each time you make a code change can save you a ton of time as you’re developing your web applications. To accomplish this, you can use <code class="highlighter-rouge">nodemon</code>. To add it to the project, type <code class="highlighter-rouge">npm i nodemon</code>. Once you’ve installed <code class="highlighter-rouge">nodemon</code>, you’ll add a <code class="highlighter-rouge">dev</code> script to your <code class="highlighter-rouge">package.json</code>:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   "scripts": {
<span class="gi">+    "dev": "nodemon node ./bin/www",
</span>     "start": "node ./bin/www"
   },
</code></pre></div></div>

<p>From now on, instead of running <code class="highlighter-rouge">npm start</code> to boot up your development server, you can run <code class="highlighter-rouge">npm run dev</code> and any code changes you make will automatically trigger a web server restart.</p>

<h2 id="configure-code-linting">Configure Code Linting</h2>

<p>Linters help catch bugs while you’re coding rather than waiting for them to crop up in production. They also help keep code styling consistent when collaborating with other contributors. One of the most common linters is <code class="highlighter-rouge">eslint</code>, which is incredibly configurable. There are many presets out there, but my favorite is called <code class="highlighter-rouge">standard</code>. They actually have their own tool, based on <code class="highlighter-rouge">eslint</code>, but it’s not possible to customize that, so in this example, I’ll go with <code class="highlighter-rouge">eslint</code> and make a few modifications to the <code class="highlighter-rouge">standard</code> config.</p>

<p>To do this, create a file in the project root named <code class="highlighter-rouge">.eslintrc</code> with the following:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"extends"</span><span class="p">:</span><span class="w"> </span><span class="s2">"standard"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"comma-dangle"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"error"</span><span class="p">,</span><span class="w"> </span><span class="s2">"always-multiline"</span><span class="p">],</span><span class="w">
    </span><span class="s2">"no-var"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"error"</span><span class="p">],</span><span class="w">
    </span><span class="s2">"prefer-const"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"error"</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Now you need to install a few dev dependencies (the <code class="highlighter-rouge">-D</code> flag is for dev dependencies).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  npm i <span class="nt">-D</span> eslint eslint-config-standard eslint-plugin-standard eslint-plugin-promise eslint-plugin-import eslint-plugin-node
</code></pre></div></div>

<p>I added a few rules I like. You can tweak these to your liking:</p>

<ul>
  <li><a href="https://eslint.org/docs/rules/comma-dangle">comma-dangle</a> is really just a style preference. I like that if I add a new line to the end of a list, the git history won’t show the previously last line as
code I modified</li>
  <li><a href="https://eslint.org/docs/rules/no-var">no-var</a> forces us to use the newer <code class="highlighter-rouge">let</code> and <code class="highlighter-rouge">const</code> keywords
for declaring variables. They have proper scoping and tend to be safer to use</li>
  <li><a href="https://eslint.org/docs/rules/prefer-const">prefer-const</a> will have you use <code class="highlighter-rouge">const</code> by default, and only use <code class="highlighter-rouge">let</code> if the variable is going to be re-assigned later</li>
</ul>

<p>You’ll want to add another script to <code class="highlighter-rouge">package.json</code> for testing:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   "scripts": {
     "dev": "nodemon node ./bin/www",
<span class="gi">+    "test": "eslint . ./bin/www",
</span>     "start": "node ./bin/www"
   },
</code></pre></div></div>

<p>You can now test your codebase at any time using <code class="highlighter-rouge">npm test</code>. The first time around, there will be quite a few errors because the code from <code class="highlighter-rouge">express-generator</code> wasn’t written using the same config. To fix them in bulk run <code class="highlighter-rouge">./node_modules/.bin/eslint . ./bin/www --fix</code> from the root of your project.</p>

<p>The <code class="highlighter-rouge">.</code> says to check the current directory tree for any <code class="highlighter-rouge">.js</code> files. Since <code class="highlighter-rouge">./bin/www</code> doesn’t have a <code class="highlighter-rouge">.js</code> extension, but is a JavaScript file as well, you need to add that for it to be scanned.</p>

<p>It turns out <code class="highlighter-rouge">bin/www</code> actually has some unreachable code that can’t be automatically fixed. Let’s go fix that real quick. Since <code class="highlighter-rouge">process.exit</code> will actually end the node process, the <code class="highlighter-rouge">break</code> keywords are a bit redundant, so you can just remove those.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -67,11 +67,9 @@ function onError (error) {
</span>     case 'EACCES':
       console.error(bind + ' requires elevated privileges')
       process.exit(1)
<span class="gd">-      break
</span>     case 'EADDRINUSE':
       console.error(bind + ' is already in use')
       process.exit(1)
<span class="gd">-      break
</span>     default:
       throw error
   }
</code></pre></div></div>

<p>There’s pretty good support for using <code class="highlighter-rouge">eslint</code> within most text editors which allows you to see the errors as you’re typing the code. Most of the time, you won’t even need to run <code class="highlighter-rouge">npm test</code>.</p>

<p>You might need to install a plugin to get this to work. To see if your editor is supported,
<a href="https://eslint.org/docs/user-guide/integrations#editors">check here</a>.</p>

<h2 id="add-authentication-with-okta">Add Authentication With Okta</h2>

<p>The Express generator created a skeleton for you to get started. Now, let’s add authentication. Traditionally, there is a lot to think about when it comes to creating a safe, secure application. For example, what are best practices for storing hashed passwords? Do these best practices change often? Should you use multi-factor authentication? To say there’s a lot of research to do this right is an understatement.</p>

<p>Luckily, Okta makes this really easy by offloading authentication and letting you focus on what makes your app unique. To get started <a href="https://developer.okta.com/signup/">sign up for a free Okta Developer account</a>.</p>

<p>You’ll get a link to your own Okta Org URL which you’ll use to sign in from now on, so you should save it for later. It’ll look something like <code class="highlighter-rouge">https://dev-123456.oktapreview.com</code>. In order to log in, check your email for a temporary password.</p>

<p>After logging into the dev console, click on the <strong>Applications</strong> tab, then click <strong>Add Application</strong>. For this example, you should use the <strong>Web</strong> option.</p>

<p>Express uses port 3000 by default. Here you should name your application and change the ports, but leave all the other settings the same for now. Eventually, you’ll want to add URIs for a custom domain, but <code class="highlighter-rouge">localhost</code> is fine for testing.</p>

<p><img src="/assets/blog/simple-node-authentication/create-web-app-settings-a97eff4b0ac34c5a601cd2f909529bf672ae21b88f5b4615f80e575e45608ad2.png" alt="Okta Create Web App Settings" width="600" class="center-image" /></p>

<p>After creating your application, you’ll get access to your client credentials. Save the client ID
and client secret for the next step.</p>

<h2 id="add-the-openid-connect-middleware-to-expressjs">Add the OpenID Connect Middleware to Express.js</h2>

<p>Now for some real code. Okta provides Express middleware to make authentication simple in Node.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i @okta/oidc-middleware@0.1.2 express-session@1.15.6
</code></pre></div></div>

<p>In your <code class="highlighter-rouge">app.js</code> file you’ll want to set up support for sessions and add the OIDC middleware. You’ll need to reference the <code class="highlighter-rouge">oidc</code> middleware in the <code class="highlighter-rouge">bin/www</code> file, so you should export that as well.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh">diff --git a/app.js b/app.js
index 1cf250f..f5ad0ab 100644
</span><span class="gd">--- a/app.js
</span><span class="gi">+++ b/app.js
</span><span class="gu">@@ -3,12 +3,22 @@ const express = require('express')
</span> const path = require('path')
 const cookieParser = require('cookie-parser')
 const logger = require('morgan')
<span class="gi">+const session = require('express-session')
+const { ExpressOIDC } = require('@okta/oidc-middleware')
</span>
 const indexRouter = require('./routes/index')
<span class="gd">-const usersRouter = require('./routes/users')
</span><span class="gi">+const dashboardRouter = require('./routes/dashboard')
</span>
 const app = express()

<span class="gi">+const oidc = new ExpressOIDC({
+  issuer: `${process.env.ORG_URL}/oauth2/default`,
+  client_id: process.env.CLIENT_ID,
+  client_secret: process.env.CLIENT_SECRET,
+  redirect_uri: `${process.env.HOST_URL}/authorization-code/callback`,
+  scope: 'openid profile',
+})
+
</span> // view engine setup
 app.set('views', path.join(__dirname, 'views'))
 app.set('view engine', 'hbs')
<span class="gu">@@ -19,8 +29,19 @@ app.use(express.urlencoded({ extended: false }))
</span> app.use(cookieParser())
 app.use(express.static(path.join(__dirname, 'public')))

<span class="gi">+app.use(session({
+  secret: process.env.APP_SECRET,
+  resave: true,
+  saveUninitialized: false,
+}))
+
+app.use(oidc.router)
</span> app.use('/', indexRouter)
<span class="gd">-app.use('/users', usersRouter)
</span><span class="gi">+app.use('/dashboard', oidc.ensureAuthenticated(), dashboardRouter)
+app.get('/logout', (req, res) =&gt; {
+  req.logout()
+  res.redirect('/')
+})
</span>
 // catch 404 and forward to error handler
 app.use(function (req, res, next) {
<span class="gu">@@ -38,4 +59,4 @@ app.use(function (err, req, res, next) {
</span>   res.render('error')
 })

<span class="gd">-module.exports = app
</span><span class="gi">+module.exports = { app, oidc }
</span></code></pre></div></div>

<p>The Okta middleware adds a <code class="highlighter-rouge">logout</code> function to the request object, so you can log users out with a call to <code class="highlighter-rouge">req.logout()</code>. That was added above as a route, so you just need a link to <code class="highlighter-rouge">/logout</code> in order to sign out, which I’ll show you a bit later.</p>

<p>For this example you’re not going to be using the <code class="highlighter-rouge">users</code> route that came with the skeleton either, so you can remove that by running <code class="highlighter-rouge">git rm routes/users.js</code>.</p>

<p>You might be wondering where all the <code class="highlighter-rouge">process.env</code> variables are coming from. It’s a best practice not to store sensitive information in source control, so you can instead use <code class="highlighter-rouge">dotenv</code>. This lets you keep things like your client secret in a file that you ignore from source control. It also lets you define different variables depending on whether you’re running in development or production.</p>

<p>For now, install the package with <code class="highlighter-rouge">npm i dotenv</code>, then create a <code class="highlighter-rouge">.env</code> file in the root of the project.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">ORG_URL</span><span class="o">=</span>https://dev-123456.oktapreview.com
<span class="nv">HOST_URL</span><span class="o">=</span>http://localhost:3000
<span class="nv">CLIENT_ID</span><span class="o">=</span>okta-application-client-id
<span class="nv">CLIENT_SECRET</span><span class="o">=</span>okta-application-client-secret
</code></pre></div></div>

<p>For <code class="highlighter-rouge">APP_SECRET</code> we just need something random, which can be generated with this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"APP_SECRET=</span><span class="sb">`</span>openssl rand <span class="nt">-base64</span> 32<span class="sb">`</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> .env
</code></pre></div></div>

<p>You still need to tell your code to use environment variables via <code class="highlighter-rouge">dotenv</code>, and change the way you start the server to work with Okta’s middleware. You need the <code class="highlighter-rouge">dotenv</code> import to be the first code your app comes across to make sure the environment variables are set up properly.</p>

<p>These are the changes you need to make in <code class="highlighter-rouge">bin/www</code>:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh">diff --git a/bin/www b/bin/www
index 48c4fc5..414ca9a 100755
</span><span class="gd">--- a/bin/www
</span><span class="gi">+++ b/bin/www
</span><span class="gu">@@ -4,7 +4,8 @@
</span>  * Module dependencies.
  */

<span class="gd">-const app = require('../app')
</span><span class="gi">+require('dotenv').config()
+const { app, oidc } = require('../app')
</span> const debug = require('debug')('simple-node-authentication:server')
 const http = require('http')

<span class="gu">@@ -25,7 +26,10 @@ const server = http.createServer(app)
</span>  * Listen on provided port, on all network interfaces.
  */

<span class="gd">-server.listen(port)
</span><span class="gi">+oidc.on('ready', () =&gt; {
+  server.listen(port)
+})
+oidc.on('error', onError)
</span> server.on('error', onError)
 server.on('listening', onListening)
</code></pre></div></div>

<h2 id="add-a-dashboard-and-login-page">Add a Dashboard and Login Page</h2>

<p>Let’s create a private dashboard that’s only accessible for logged in users. In <code class="highlighter-rouge">app.js</code> you already added the reference to your dashboard’s router, so you’ll need to add that in <code class="highlighter-rouge">routes/dashboard.js</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">startCase</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'lodash'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">()</span>

<span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">descriptionList</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">userinfo</span><span class="p">).</span><span class="nx">sort</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">key</span> <span class="o">=&gt;</span> <span class="p">({</span>
      <span class="na">term</span><span class="p">:</span> <span class="nx">startCase</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span>
      <span class="na">details</span><span class="p">:</span> <span class="p">(</span><span class="nx">key</span> <span class="o">===</span> <span class="s1">'updated_at'</span> <span class="p">?</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">userinfo</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">userinfo</span><span class="p">[</span><span class="nx">key</span><span class="p">]),</span>
    <span class="p">}))</span>

  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'dashboard'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="s1">'Dashboard'</span><span class="p">,</span>
    <span class="nx">descriptionList</span><span class="p">,</span>
    <span class="nx">userinfo</span><span class="p">,</span>
  <span class="p">})</span>
<span class="p">})</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span>
</code></pre></div></div>

<p>I added <code class="highlighter-rouge">lodash</code>, so you’ll need to install that as a dependency with <code class="highlighter-rouge">npm i lodash@4.17.5</code>. You’ll also want to add a view to describe how to render the data in <code class="highlighter-rouge">views/dashboard.hbs</code>.</p>

<div class="language-hbs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;h1&gt;</span><span class="k">{{</span><span class="nv">userinfo</span><span class="p">.</span><span class="nv">given_name</span><span class="k">}}</span>'s Dashboard<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span>Here's where you would put something useful. How about your profile info?<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;dl&gt;</span>
  <span class="k">{{#</span><span class="nn">each</span> <span class="nv">descriptionList</span><span class="k">}}</span>
    <span class="nt">&lt;dt&gt;</span><span class="k">{{</span><span class="nv">this</span><span class="p">.</span><span class="nv">term</span><span class="k">}}</span><span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="k">{{</span><span class="nv">this</span><span class="p">.</span><span class="nv">details</span><span class="k">}}</span><span class="nt">&lt;/dd&gt;</span>
  <span class="k">{{/</span><span class="nn">each</span><span class="k">}}</span>
<span class="nt">&lt;/dl&gt;</span>

</code></pre></div></div>

<h2 id="clean-up-the-styling">Clean Up the Styling</h2>

<p>You can add a header in <code class="highlighter-rouge">views/layout.hbs</code> that will be visible on every page. As long as the routers pass in <code class="highlighter-rouge">userinfo</code> to the <code class="highlighter-rouge">render</code> function, you’ll know if the user is signed in. You also want to pass in <code class="highlighter-rouge">title</code> to set the page’s title and set the header.</p>

<div class="language-hbs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="k">{{</span><span class="nv">title</span><span class="k">}}</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">'stylesheet'</span> <span class="na">href=</span><span class="s">'/stylesheets/style.css'</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;header&gt;</span>
      <span class="nt">&lt;h1&gt;</span><span class="k">{{</span><span class="nv">title</span><span class="k">}}</span><span class="nt">&lt;/h1&gt;</span>
      <span class="k">{{#if</span> <span class="nv">userinfo</span><span class="k">}}</span>
        <span class="nt">&lt;div&gt;</span>
          Signed in as <span class="k">{{</span><span class="nv">userinfo</span><span class="p">.</span><span class="nv">name</span><span class="k">}}</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="k">{{/if}}</span>
      <span class="k">{{#if</span> <span class="nv">userinfo</span><span class="k">}}</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/logout"</span><span class="nt">&gt;</span>Sign out<span class="nt">&lt;/a&gt;</span>
      <span class="k">{{else}}</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/login"</span><span class="nt">&gt;</span>Sign in<span class="nt">&lt;/a&gt;</span>
      <span class="k">{{/if}}</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;main&gt;</span>
      <span class="k">{{{</span><span class="nv">body</span><span class="k">}}}</span>
    <span class="nt">&lt;/main&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

</code></pre></div></div>

<p>The CSS lives in <code class="highlighter-rouge">public/stylesheets/style.css</code>. Here’s how mine looks after making a few changes.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">body</span> <span class="p">{</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">font</span><span class="p">:</span> <span class="m">14px</span> <span class="s1">"Lucida Grande"</span><span class="p">,</span> <span class="n">Helvetica</span><span class="p">,</span> <span class="n">Arial</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">a</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#208075</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">header</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="n">space-between</span><span class="p">;</span>
  <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#208075</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">16px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">header</span> <span class="o">&gt;</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#d1e5e1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">header</span><span class="o">,</span>
<span class="nt">main</span> <span class="p">{</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">50px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">dt</span> <span class="p">{</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">4px</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">bold</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="add-a-login-page">Add a Login Page</h2>

<p>It turns out there’s not really much to do here. Okta’s middleware adds a <code class="highlighter-rouge">/login</code> route for you, so all you really need to do is add a link. In fact, you don’t even need to link to the <code class="highlighter-rouge">/login</code> page directly. Since your dashboard page uses the <code class="highlighter-rouge">oidc.ensureAuthenticated()</code> middleware, any time a user tries to go to the dashboard, they will first be directed to log in. After logging in, they’ll be redirected back to the intended page.</p>

<p>In <code class="highlighter-rouge">routes/index.js</code> you want to know if the user’s authenticated or not, so you can pass that info to the view with <code class="highlighter-rouge">req.userinfo</code>. While you’re at it, go ahead and change the default title from <code class="highlighter-rouge">Express</code> to the name of your app.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="gd">-  res.render('index', { title: 'Express' })
</span><span class="gi">+  res.render('index', {
+    title: 'Simple Node Authentication',
+    userinfo: req.userinfo,
+  })
</span>
</code></pre></div></div>

<p>In <code class="highlighter-rouge">views/index.hbs</code>, let’s add a link to the dashboard.</p>

<div class="language-hbs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;p&gt;</span>Welcome to <span class="k">{{</span><span class="nv">title</span><span class="k">}}</span><span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>
  To access your dashboard,
  <span class="k">{{#if</span> <span class="nv">userinfo</span><span class="k">}}</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/dashboard"</span><span class="nt">&gt;</span>click here<span class="nt">&lt;/a&gt;</span>.
  <span class="k">{{else}}</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/dashboard"</span><span class="nt">&gt;</span>sign in<span class="nt">&lt;/a&gt;</span>.
  <span class="k">{{/if}}</span>
<span class="nt">&lt;/p&gt;</span>

</code></pre></div></div>

<p>Now when you run the app, you get a page that looks like this:</p>

<p><img src="/assets/blog/simple-node-authentication/simple-node-auth-homepage-ab0991d295b1edd137414262fe99ae6c803c8fa3dfc950d99354d18a763f1ab1.png" alt="Simple Node Auth Homepage" width="600" class="center-image" /></p>

<p>Clicking the <code class="highlighter-rouge">log in</code> link will take you to Okta’s sign in page. After signing in, you’ll be directed to a dashboard page with your profile info.</p>

<p><img src="/assets/blog/simple-node-authentication/simple-node-auth-dashboard-98c19578b5fcab1ac996a498fe8137ec26f70a58f259a6adb6afd6b09fddc055.png" alt="Simple Node Auth Dashboard" width="600" class="center-image" /></p>

<h2 id="add-user-registration">Add User Registration</h2>

<p>You should have a functional app now with authentication and protected pages, created with only a few additions to the basic skeleton app. You don’t have any way to add new users though.</p>

<p>Let’s create a simple registration page. For this, we’ll be using the <a href="https://github.com/okta/okta-sdk-nodejs">Okta Node.js SDK</a>, which you can install with <code class="highlighter-rouge">npm i @okta/okta-sdk-nodejs@1.1.0</code>.</p>

<p>You’ll also need an API token from Okta to be able to create a user. After logging in to your developer console, select <strong>API</strong> &gt; <strong>Tokens</strong> from the menu.</p>

<p><img src="/assets/blog/simple-node-authentication/okta-api-tokens-0f71c43a9ce1919444a99d2e5bf88eafad75374d1f3f809ba44ee8af44926729.png" alt="Okta API Tokens" width="600" class="center-image" /></p>

<p>Create a token with a useful name, like <code class="highlighter-rouge">registration</code>, then save the value in <code class="highlighter-rouge">.env</code> as <code class="highlighter-rouge">REGISTRATION_TOKEN</code>. The value of the token will only be displayed once, so if you lose it you’ll need to create a new one.</p>

<p>Now you’ll need to create a view and a router for the registration page.</p>

<p><strong><code class="highlighter-rouge">routes/register.js</code></strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">okta</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'@okta/okta-sdk-nodejs'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">()</span>

<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">okta</span><span class="p">.</span><span class="nx">Client</span><span class="p">({</span>
  <span class="na">orgUrl</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ORG_URL</span><span class="p">,</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REGISTRATION_TOKEN</span><span class="p">,</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="s1">'Create an account'</span>

<span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">userinfo</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Logged in users shouldn't be able to register</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'register'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kr">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">createUser</span><span class="p">({</span>
      <span class="na">profile</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">firstName</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
        <span class="na">lastName</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
        <span class="na">email</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
        <span class="na">login</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">password</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">value</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">})</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/dashboard'</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">({</span> <span class="nx">errorCauses</span> <span class="p">})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nx">errorCauses</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">summary</span><span class="p">,</span> <span class="p">{</span> <span class="nx">errorSummary</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="sr">/Password/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">errorSummary</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({</span> <span class="na">password</span><span class="p">:</span> <span class="nx">errorSummary</span> <span class="p">})</span>
      <span class="p">}</span>

      <span class="kd">const</span> <span class="p">[</span> <span class="p">,</span> <span class="nx">field</span><span class="p">,</span> <span class="nx">error</span> <span class="p">]</span> <span class="o">=</span> <span class="sr">/^</span><span class="se">(</span><span class="sr">.+</span><span class="se">?)</span><span class="sr">: </span><span class="se">(</span><span class="sr">.+</span><span class="se">)</span><span class="sr">$/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">errorSummary</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({</span> <span class="p">[</span><span class="nx">field</span><span class="p">]:</span> <span class="nx">error</span> <span class="p">},</span> <span class="nx">summary</span><span class="p">)</span>
    <span class="p">},</span> <span class="p">{})</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'register'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">errors</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span>
</code></pre></div></div>

<p>When initially loading the page, the fields will be blank. If the <code class="highlighter-rouge">createUser</code> function throws an error, you’ll want to keep the user on the page and display those errors inline. You can pre-populate the fields with the data they entered last time, so they don’t have to type everything in again.</p>

<p><strong><code class="highlighter-rouge">views/register.hbs</code></strong></p>
<div class="language-hbs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;h4&gt;</span>After creating your account, you will be asked to sign in and provide a security question.<span class="nt">&lt;/h4&gt;</span>
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"firstname"</span><span class="nt">&gt;</span>
    First Name
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"firstname"</span> <span class="na">name=</span><span class="s">"firstName"</span> <span class="na">required</span> <span class="na">value=</span><span class="s">"</span><span class="k">{{</span><span class="nv">body</span><span class="p">.</span><span class="nv">firstName</span><span class="k">}}</span><span class="s">"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"error"</span><span class="nt">&gt;</span><span class="k">{{</span><span class="nv">errors</span><span class="p">.</span><span class="nv">firstName</span><span class="k">}}</span><span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"lastname"</span><span class="nt">&gt;</span>
    Last Name
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"lastname"</span> <span class="na">name=</span><span class="s">"lastName"</span> <span class="na">required</span> <span class="na">value=</span><span class="s">"</span><span class="k">{{</span><span class="nv">body</span><span class="p">.</span><span class="nv">lastName</span><span class="k">}}</span><span class="s">"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"error"</span><span class="nt">&gt;</span><span class="k">{{</span><span class="nv">errors</span><span class="p">.</span><span class="nv">lastName</span><span class="k">}}</span><span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"email"</span><span class="nt">&gt;</span>
    Email address
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">id=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">required</span> <span class="na">value=</span><span class="s">"</span><span class="k">{{</span><span class="nv">body</span><span class="p">.</span><span class="nv">email</span><span class="k">}}</span><span class="s">"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"error"</span><span class="nt">&gt;</span><span class="k">{{</span><span class="nv">errors</span><span class="p">.</span><span class="nv">email</span><span class="k">}}</span><span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"error"</span><span class="nt">&gt;</span><span class="k">{{</span><span class="nv">errors</span><span class="p">.</span><span class="nv">login</span><span class="k">}}</span><span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"password"</span><span class="nt">&gt;</span>
    Password
    <span class="nt">&lt;input</span>
      <span class="na">name=</span><span class="s">"password"</span>
      <span class="na">type=</span><span class="s">"password"</span>
      <span class="na">required</span>
      <span class="na">value=</span><span class="s">"</span><span class="k">{{</span><span class="nv">body</span><span class="p">.</span><span class="nv">password</span><span class="k">}}</span><span class="s">"</span>
    <span class="nt">/&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"error"</span><span class="nt">&gt;</span><span class="k">{{</span><span class="nv">errors</span><span class="p">.</span><span class="nv">password</span><span class="k">}}</span><span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;/label&gt;</span>

  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>

</code></pre></div></div>

<p>You can now add a link to the homepage in <code class="highlighter-rouge">views/index.hbs</code>.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
     &lt;a href="/dashboard"&gt;click here&lt;/a&gt;.
   {{else}}
     &lt;a href="/dashboard"&gt;sign in&lt;/a&gt;.
<span class="gi">+  &lt;/p&gt;
+  &lt;p&gt;
+    If you don't have an account, you can
+    &lt;a href="/register"&gt;register for free&lt;/a&gt;.
</span>   {{/if}}
 &lt;/p&gt;

</code></pre></div></div>

<p>Now if you navigate to http://localhost:3000/register, you’ll find a registration page.</p>

<p><img src="/assets/blog/simple-node-authentication/create-account-40e52df68da95026259677ab53d2924772bdf1557e1704f331041f857f75a4ad.png" alt="Create Account" width="400" class="center-image" /></p>

<p>If Okta returns any errors, they will be shown in the form.</p>

<p><img src="/assets/blog/simple-node-authentication/account-already-exists-3a66750f1fd70c7311e0f1c4ad6478bae834e11ea4c805a2a23b3fa0a6032796.png" alt="Account Already Exists" width="400" class="center-image" />
<img src="/assets/blog/simple-node-authentication/account-password-requirements-c6538ce7d0b4bd57237019373d9af966bfacbdf82ba8e97f9c0b317eb56b160f.png" alt="Account Password Requirements" width="400" class="center-image" /></p>

<h2 id="add-credential-recovery">Add Credential Recovery</h2>

<p>If a user forgets their password, they will need a way to reset it. Okta’s API allows you to send a recovery link to a user’s email address. You just need a simple page to ask the user for their email address.</p>

<p><strong><code class="highlighter-rouge">views/reset-password.hbs</code></strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="p">{{</span><span class="err">#</span><span class="k">if</span> <span class="nx">success</span><span class="p">}}</span>
  <span class="o">&lt;</span><span class="nx">h4</span><span class="o">&gt;</span><span class="nx">Please</span> <span class="nx">check</span> <span class="nx">your</span> <span class="nx">inbox</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">recovery</span> <span class="nx">email</span><span class="o">!&lt;</span><span class="sr">/h4</span><span class="err">&gt;
</span><span class="p">{{</span><span class="k">else</span><span class="p">}}</span>
  <span class="o">&lt;</span><span class="nx">h4</span><span class="o">&gt;</span><span class="nx">Enter</span> <span class="nx">your</span> <span class="nx">email</span> <span class="nx">address</span> <span class="nx">to</span> <span class="nx">have</span> <span class="nx">a</span> <span class="nx">password</span> <span class="nx">recovery</span> <span class="nx">email</span> <span class="nx">sent</span> <span class="nx">to</span> <span class="nx">you</span><span class="p">.</span><span class="o">&lt;</span><span class="sr">/h4</span><span class="err">&gt;
</span><span class="p">{{</span><span class="sr">/if}</span><span class="err">}
</span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">"post"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">"email"</span><span class="o">&gt;</span>
    <span class="nx">Email</span> <span class="nx">address</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">autofocus</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"email"</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"email"</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"email"</span> <span class="nx">required</span> <span class="nx">value</span><span class="o">=</span><span class="s2">"{{body.email}}"</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nx">label</span> <span class="kd">class</span><span class="o">=</span><span class="s2">"error"</span><span class="o">&gt;</span><span class="p">{{</span><span class="nx">error</span><span class="p">}}</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>
  <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"submit"</span><span class="o">&gt;</span><span class="nx">Send</span> <span class="nx">Recovery</span> <span class="nx">Link</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>
</code></pre></div></div>

<p><strong><code class="highlighter-rouge">routes/reset-password.js</code></strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">okta</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'@okta/okta-sdk-nodejs'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">()</span>

<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">okta</span><span class="p">.</span><span class="nx">Client</span><span class="p">({</span>
  <span class="na">orgUrl</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ORG_URL</span><span class="p">,</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REGISTRATION_TOKEN</span><span class="p">,</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="s1">'Password Recovery'</span>

<span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'reset-password'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">getUser</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span>

    <span class="kr">await</span> <span class="nx">user</span><span class="p">.</span><span class="nx">resetPassword</span><span class="p">()</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'reset-password'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span><span class="p">,</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'reset-password'</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">title</span><span class="p">,</span>
      <span class="na">error</span><span class="p">:</span> <span class="s1">'Could not find an account with that email address'</span><span class="p">,</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span>
</code></pre></div></div>

<p><strong><code class="highlighter-rouge">views/index.hbs</code></strong></p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
   &lt;p&gt;
     If you don't have an account, you can
     &lt;a href="/register"&gt;register for free&lt;/a&gt;.
<span class="gi">+  &lt;/p&gt;
+  &lt;p&gt;
+    If you have an account, but forgot your password,
+    &lt;a href="/reset-password"&gt;click here&lt;/a&gt; to
+    send a recovery link to your email address.
</span>   {{/if}}
 &lt;/p&gt;

</code></pre></div></div>

<p><strong><code class="highlighter-rouge">app.js</code></strong></p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">@@ -9,6 +9,7 @@ const { ExpressOIDC } = require('@okta/oidc-middleware')
</span> const indexRouter = require('./routes/index')
 const dashboardRouter = require('./routes/dashboard')
 const registrationRouter = require('./routes/register')
<span class="gi">+const resetPassword = require('./routes/reset-password')
</span>
 const app = express()

<span class="gu">@@ -40,6 +41,7 @@ app.use(oidc.router)
</span> app.use('/', indexRouter)
 app.use('/dashboard', oidc.ensureAuthenticated(), dashboardRouter)
 app.use('/register', registrationRouter)
<span class="gi">+app.use('/reset-password', resetPassword)
</span> app.get('/logout', (req, res) =&gt; {
   req.logout()
   res.redirect('/')
</code></pre></div></div>

<p><img src="/assets/blog/simple-node-authentication/password-recovery-59ee56373bf6c0c251a066856ed92b0cc3894165175853a49869d82ad2d32b7c.png" alt="Password Recovery" width="400" class="center-image" />
<img src="/assets/blog/simple-node-authentication/password-recovery-invalid-email-282e9ed6c78ede7da05e2cc2cb0cb64020a8809bac00075d44045eecaa7ba572.png" alt="Password Recovery Invalid Email" width="400" class="center-image" /></p>

<h2 id="learn-more-about-node-and-secure-user-management-with-okta">Learn More About Node and Secure User Management with Okta</h2>

<p>Now you have a fully functioning web application with user registration, authentication, and credential recovery, without having to has a single password or manage a single user. You can have your cake, and eat it too!</p>

<p>OK, the cake is a lie, but you can now focus on what makes your application great and unique while offloading the complications of user management to Okta. If you’d like to learn more about Node, Okta, authentication, or application security, I’d encourage you to check out the rest of the Okta developer blog, and specifically these great resources:</p>

<ul>
  <li><a href="https://developer.okta.com/code/nodejs/">Our Node SDK Documentation</a></li>
  <li><a href="https://github.com/okta/okta-oidc-js/tree/master/packages/oidc-middleware">Okta OIDC Middleware Documentation</a></li>
  <li><a href="/blog/2018/02/06/build-user-registration-with-node-react-and-okta">Build User Registration with Node, React, and Okta</a></li>
  <li><a href="/blog/2018/02/15/build-crud-app-vuejs-node">Build a Basic CRUD App with Vue.js and Node</a></li>
  <li><a href="/blog/2017/06/21/what-the-heck-is-oauth">What the Heck is OAuth?</a></li>
  <li><a href="https://www.youtube.com/watch?v=0VWkQMr7r_c&amp;t=4276s">VIDEO: OAuth 2.0 and OpenID Connect in Plain English</a></li>
</ul>

<p>And as always, we’d love to hear from you. Hit us up with questions or feedback in the comments, or on Twitter <a href="https://twitter.com/OktaDev">@oktadev</a>.</p>


    </div>

    
    <div id="disqus">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_title = "Simple Node Authentication";
            var disqus_url = 'https://developer.okta.com/blog/2018/04/24/simple-node-authentication';

            (function () {
                var dsq = document.createElement('script');
                dsq.async = true;
                dsq.type = 'text/javascript';
                dsq.src = '//oktadevblog.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>
              Please enable JavaScript to view the
              <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus</a>.
         </noscript>
    </div>
    
</article>

		
</section>

		
	</div>
	<footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">
                <a href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">
                    <div class="Logo">
                        <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    </div>
                    <p>Visit okta.com</p>
                </a>
            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">
                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate-with-okta/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/change-log/">Change Log</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notices</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="https://developer.okta.com/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="https://developer.okta.com/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="https://developer.okta.com/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-aa397c892d9083236c5cb20732dde679021b9236c8142ce78177b8b184567a02.js"></script>
    <script type="text/javascript" src="/assets/myOkta-911cbafbbe079b7a5522d9cbe15bd2a5f44e1582531e88393934bec69f97696b.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/blog-6e32dad27404131cc8630a5282264bed2ab4c08c91ac86fa496b75c53aa4f681.js"></script>
    

  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
